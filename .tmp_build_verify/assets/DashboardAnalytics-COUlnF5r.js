import{r as d,j as e,k as fe,i as ge}from"./react-core-BcR2_z_l.js";import{D as je}from"./DashboardShell-BZQMplB5.js";import{B as we}from"./badge-CX6RuieY.js";import{B as ve}from"./button-C7iHbTqw.js";import{C as k,b as S,c as $,a as _}from"./card-VD61BBwz.js";import{S as K,a as z,b as G,c as X,d as g}from"./select-BOMyCGLP.js";import{T as be,a as ye,b as Z,c as I,d as Ne,e as M}from"./table-DMhxaLRi.js";import{c as b,g as Ce,d as P}from"./index-ntR5v_s2.js";import{T as ke,R as Se,L as $e,C as _e,X as Le,Y as Te,a as qe}from"./charts-cG-yiWQd.js";import{u as Re}from"./use-page-meta-ewLab265.js";import"./ThemedSvgLogo-CGFMwyp6.js";import"./createLucideIcon-M1JG7EBz.js";import"./url-safety-Py24cS-5.js";import"./Footer-C9y59CM9.js";import"./avatar-CVZSwVae.js";import"./index-Xj-Q384k.js";import"./shield-DlmGTLiS.js";import"./index-BMIt2_cw.js";import"./index-DZ2Ey5_7.js";import"./index-CHWtszJ3.js";import"./chevron-right-CrdESc7p.js";import"./check-Cyy403AY.js";import"./users-ok7q4J4c.js";import"./info-BTb-jBiG.js";import"./book-open-CG_mViAI.js";import"./ThemedSvgMaskIcon-B_IYD_H5.js";import"./globe-CRGpuS2E.js";import"./message-circle-qqsIJunn.js";import"./x-BpqL4Bns.js";import"./use-toast-DeMRPCeJ.js";import"./index-CwaKb5FF.js";import"./mui-WkDK9qS1.js";import"./input-BfSJiKKQ.js";import"./separator-CDy1CE57.js";import"./skeleton-DbpZ9Rjt.js";import"./search-ranking-cq4don08.js";import"./use-dynamic-synopsis-clamp-DpjBDBPb.js";import"./access-control-C6qZ0ZhA.js";import"./chevron-down-Mfh0mWaz.js";const Ae={light:"",dark:".dark"},te=d.createContext(null);function re(){const s=d.useContext(te);if(!s)throw new Error("useChart must be used within a <ChartContainer />");return s}const ae=d.forwardRef(({id:s,className:a,children:i,config:n,...o},p)=>{const l=d.useId(),m=`chart-${s||l.replace(/:/g,"")}`;return e.jsx(te.Provider,{value:{config:n},children:e.jsxs("div",{"data-chart":m,ref:p,className:b("flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-hidden [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-hidden [&_.recharts-surface]:outline-hidden",a),...o,children:[e.jsx(De,{id:m,config:n}),e.jsx(Se,{children:i})]})})});ae.displayName="Chart";const De=({id:s,config:a})=>{const i=Object.entries(a).filter(([n,o])=>o.theme||o.color);return i.length?e.jsx("style",{dangerouslySetInnerHTML:{__html:Object.entries(Ae).map(([n,o])=>`
${o} [data-chart=${s}] {
${i.map(([p,l])=>{const m=l.theme?.[n]||l.color;return m?`  --color-${p}: ${m};`:null}).join(`
`)}
}
`).join(`
`)}}):null},Pe=ke,ie=d.forwardRef(({active:s,payload:a,className:i,indicator:n="dot",hideLabel:o=!1,hideIndicator:p=!1,label:l,labelFormatter:m,labelClassName:j,formatter:h,color:R,nameKey:E,labelKey:L},T)=>{const{config:y}=re(),A=d.useMemo(()=>{if(o||!a?.length)return null;const[r]=a,q=`${L||r.dataKey||r.name||"value"}`,D=Y(y,r,q),x=!L&&typeof l=="string"?y[l]?.label||l:D?.label;return m?e.jsx("div",{className:b("font-medium",j),children:m(x,a)}):x?e.jsx("div",{className:b("font-medium",j),children:x}):null},[l,m,a,o,j,y,L]);if(!s||!a?.length)return null;const N=a.length===1&&n!=="dot";return e.jsxs("div",{ref:T,className:b("grid min-w-32 items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl",i),children:[N?null:A,e.jsx("div",{className:"grid gap-1.5",children:a.map((r,q)=>{const D=`${E||r.name||r.dataKey||"value"}`,x=Y(y,r,D),V=R||r.payload.fill||r.color;return e.jsx("div",{className:b("flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground",n==="dot"&&"items-center"),children:h&&r?.value!==void 0&&r.name?h(r.value,r.name,r,q,r.payload):e.jsxs(e.Fragment,{children:[x?.icon?e.jsx(x.icon,{}):!p&&e.jsx("div",{className:b("shrink-0 rounded-[2px] border-border bg-(--color-bg)",{"h-2.5 w-2.5":n==="dot","w-1":n==="line","w-0 border-[1.5px] border-dashed bg-transparent":n==="dashed","my-0.5":N&&n==="dashed"}),style:{"--color-bg":V,"--color-border":V}}),e.jsxs("div",{className:b("flex flex-1 justify-between leading-none",N?"items-end":"items-center"),children:[e.jsxs("div",{className:"grid gap-1.5",children:[N?A:null,e.jsx("span",{className:"text-muted-foreground",children:x?.label||r.name})]}),r.value&&e.jsx("span",{className:"font-mono font-medium tabular-nums text-foreground",children:r.value.toLocaleString()})]})]})},r.dataKey)})})]})});ie.displayName="ChartTooltip";const Ee=d.forwardRef(({className:s,hideIcon:a=!1,payload:i,verticalAlign:n="bottom",nameKey:o},p)=>{const{config:l}=re();return i?.length?e.jsx("div",{ref:p,className:b("flex items-center justify-center gap-4",n==="top"?"pb-3":"pt-3",s),children:i.map(m=>{const j=`${o||m.dataKey||"value"}`,h=Y(l,m,j);return e.jsxs("div",{className:b("flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground"),children:[h?.icon&&!a?e.jsx(h.icon,{}):e.jsx("div",{className:"h-2 w-2 shrink-0 rounded-[2px]",style:{backgroundColor:m.color}}),h?.label]},m.value)})}):null});Ee.displayName="ChartLegend";function Y(s,a,i){if(typeof a!="object"||a===null)return;const n="payload"in a&&typeof a.payload=="object"&&a.payload!==null?a.payload:void 0;let o=i;return i in a&&typeof a[i]=="string"?o=a[i]:n&&i in n&&typeof n[i]=="string"&&(o=n[i]),o in s?s[o]:s[i]}const v=s=>Number(s||0).toLocaleString("pt-BR"),Ve=s=>`${(s*100).toFixed(1).replace(".",",")}%`,Ue=s=>{const a=String(s||"").toLowerCase();return a==="project"?"Projeto":a==="post"?"Post":"Outro"},ee=s=>{const a=String(s||"").toLowerCase();return a==="(internal)"?"(interno)":a==="(direct)"?"(direto)":s},se=s=>s==="unique_views"?"Views únicas":s==="chapter_views"?"Leituras de capítulos":s==="download_clicks"?"Cliques em downloads":"Views",Ie=s=>{const a=String(s||"").split("-");if(a.length!==3)return s;const[,i,n]=a;return!i||!n?s:`${n}/${i}`},Me=s=>s==="7d"||s==="30d"||s==="90d"?s:"30d",Fe=s=>s==="post"||s==="project"||s==="all"?s:"all",Be=s=>s==="unique_views"||s==="chapter_views"||s==="download_clicks"||s==="views"?s:"views",_s=()=>{Re({title:"Analytics",noIndex:!0});const s=Ce(),a=fe(),[i,n]=ge(),o=Me(i.get("range")),p=Fe(i.get("type")),l=Be(i.get("metric")),[m,j]=d.useState({}),[h,R]=d.useState({series:[]}),[E,L]=d.useState({entries:[]}),[T,y]=d.useState({}),[A,N]=d.useState(""),[r,q]=d.useState(!0),[D,x]=d.useState(null),[V,ne]=d.useState(!0);d.useEffect(()=>{(async()=>{try{const c=await P(s,"/api/me",{auth:!0});if(!c.ok){x(null);return}const w=await c.json();x(w)}catch{x(null)}finally{ne(!1)}})()},[s]),d.useEffect(()=>{let t=!0;return(async()=>{q(!0),N("");const w=new URLSearchParams({range:o,type:p});try{const[C,u,J,Q]=await Promise.all([P(s,`/api/analytics/overview?${w.toString()}`,{auth:!0}),P(s,`/api/analytics/timeseries?${w.toString()}&metric=${l}`,{auth:!0}),P(s,`/api/analytics/top-content?${w.toString()}&limit=10`,{auth:!0}),P(s,`/api/analytics/acquisition?${w.toString()}`,{auth:!0})]);if(!t)return;if(!C.ok||!u.ok||!J.ok||!Q.ok){N("Não foi possível carregar analytics."),j({}),R({series:[]}),L({entries:[]}),y({});return}const[ue,pe,xe,he]=await Promise.all([C.json(),u.json(),J.json(),Q.json()]);if(!t)return;j(ue||{}),R(pe||{}),L(xe||{}),y(he||{})}catch{if(!t)return;N("Erro de conexão ao carregar analytics."),j({}),R({series:[]}),L({entries:[]}),y({})}finally{t&&q(!1)}})(),()=>{t=!1}},[s,o,p,l]);const F=d.useMemo(()=>Array.isArray(h.series)?h.series.map(t=>({...t})):[],[h.series]),f=m.metrics||{},B=Array.isArray(E.entries)?E.entries:[],H=Array.isArray(T.referrerHost)?T.referrerHost:[],oe=Array.isArray(T.utmSource)?T.utmSource:[],U=Number(f.commentsCreated||0),O=Number(f.commentsApproved||0),W=U>0?O/U:null,ce=t=>{const c=new URLSearchParams(i);c.set("range",t),c.set("type",p),c.set("metric",l),n(c)},le=t=>{const c=new URLSearchParams(i);c.set("range",o),c.set("type",t),c.set("metric",l),n(c)},de=t=>{const c=new URLSearchParams(i);c.set("range",o),c.set("type",p),c.set("metric",t),n(c)},me=()=>{const t=[];t.push("section,key,value"),t.push(`kpi,views,${Number(f.views||0)}`),t.push(`kpi,unique_views,${Number(f.uniqueViews||0)}`),t.push(`kpi,chapter_views,${Number(f.chapterViews||0)}`),t.push(`kpi,download_clicks,${Number(f.downloadClicks||0)}`),t.push(`kpi,comments_created,${U}`),t.push(`kpi,comments_approved,${O}`),t.push("timeseries,date,value"),F.forEach(u=>t.push(`timeseries,${u.date},${Number(u.value||0)}`)),t.push("top_content,type,title,views,unique_views"),B.forEach(u=>t.push(["top_content",u.resourceType,`"${String(u.title||"").replace(/"/g,'""')}"`,Number(u.views||0),Number(u.uniqueViews||0)].join(","))),t.push("acquisition_referrer,host,count"),H.forEach(u=>t.push(`acquisition_referrer,${u.key},${u.count}`)),t.push("acquisition_source,source,count"),oe.forEach(u=>t.push(`acquisition_source,${u.key},${u.count}`));const c=new Blob([`\uFEFF${t.join(`
`)}`],{type:"text/csv;charset=utf-8;"}),w=window.URL.createObjectURL(c),C=document.createElement("a");C.href=w,C.download=`analytics-${o}-${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild(C),C.click(),document.body.removeChild(C),window.URL.revokeObjectURL(w)};return e.jsx(je,{currentUser:D,isLoadingUser:V,onUserCardClick:()=>a("/dashboard/usuarios?edit=me"),children:e.jsx("main",{className:"pt-24",children:e.jsxs("section",{className:"mx-auto w-full max-w-6xl space-y-6 px-6 pb-20 md:px-10",children:[e.jsxs("header",{className:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"inline-flex animate-fade-in items-center gap-3 rounded-full border border-border/60 bg-card/60 px-4 py-2 text-xs uppercase tracking-[0.3em] text-muted-foreground",children:"Analytics"}),e.jsx("h1",{className:"mt-3 animate-slide-up text-3xl font-semibold lg:text-4xl",children:"Performance e aquisição"}),e.jsx("p",{className:"mt-2 animate-slide-up text-sm text-muted-foreground opacity-0",style:{animationDelay:"0.2s"},children:"Foco em consumo de conteúdo, retenção e tendências de audiência."})]}),e.jsxs("div",{className:"flex flex-col gap-3 animate-slide-up opacity-0 lg:flex-row lg:items-center",style:{animationDelay:"0.24s"},children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3 lg:flex-nowrap",children:[e.jsxs(K,{value:o,onValueChange:t=>ce(t),children:[e.jsx(z,{className:"w-[130px]",children:e.jsx(G,{placeholder:"Período"})}),e.jsxs(X,{children:[e.jsx(g,{value:"7d",children:"7 dias"}),e.jsx(g,{value:"30d",children:"30 dias"}),e.jsx(g,{value:"90d",children:"90 dias"})]})]}),e.jsxs(K,{value:p,onValueChange:t=>le(t),children:[e.jsx(z,{className:"w-[150px]",children:e.jsx(G,{placeholder:"Tipo"})}),e.jsxs(X,{children:[e.jsx(g,{value:"all",children:"Todos"}),e.jsx(g,{value:"post",children:"Posts"}),e.jsx(g,{value:"project",children:"Projetos"})]})]}),e.jsxs(K,{value:l,onValueChange:t=>de(t),children:[e.jsx(z,{className:"w-[210px]",children:e.jsx(G,{placeholder:"Métrica do gráfico"})}),e.jsxs(X,{children:[e.jsx(g,{value:"views",children:"Views"}),e.jsx(g,{value:"unique_views",children:"Views únicas"}),e.jsx(g,{value:"chapter_views",children:"Leituras de capítulos"}),e.jsx(g,{value:"download_clicks",children:"Cliques em downloads"})]})]})]}),e.jsx(ve,{className:"self-start lg:ml-auto lg:self-auto",variant:"outline",onClick:me,children:"Exportar"})]})]}),A?e.jsx("div",{className:"animate-slide-up rounded-2xl border border-red-500/30 bg-red-500/10 px-4 py-3 text-sm text-red-200 opacity-0",style:{animationDelay:"0.28s"},children:A}):null,e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(k,{className:"animate-slide-up opacity-0",style:{animationDelay:"40ms"},children:[e.jsx(S,{className:"pb-2",children:e.jsx($,{className:"text-sm text-muted-foreground",children:"Views"})}),e.jsx(_,{className:`text-3xl font-semibold ${r?"animate-pulse":""}`,children:r?"-":v(f.views||0)})]}),e.jsxs(k,{className:"animate-slide-up opacity-0",style:{animationDelay:"80ms"},children:[e.jsx(S,{className:"pb-2",children:e.jsx($,{className:"text-sm text-muted-foreground",children:"Views únicas"})}),e.jsx(_,{className:`text-3xl font-semibold ${r?"animate-pulse":""}`,children:r?"-":v(f.uniqueViews||0)})]}),e.jsxs(k,{className:"animate-slide-up opacity-0",style:{animationDelay:"120ms"},children:[e.jsx(S,{className:"pb-2",children:e.jsx($,{className:"text-sm text-muted-foreground",children:"Leituras de capítulos"})}),e.jsx(_,{className:`text-3xl font-semibold ${r?"animate-pulse":""}`,children:r?"-":v(f.chapterViews||0)})]}),e.jsxs(k,{className:"animate-slide-up opacity-0",style:{animationDelay:"160ms"},children:[e.jsx(S,{className:"pb-2",children:e.jsx($,{className:"text-sm text-muted-foreground",children:"Cliques em downloads"})}),e.jsx(_,{className:`text-3xl font-semibold ${r?"animate-pulse":""}`,children:r?"-":v(f.downloadClicks||0)})]})]}),e.jsxs(k,{className:"animate-slide-up opacity-0",style:{animationDelay:"190ms"},children:[e.jsx(S,{children:e.jsx($,{children:"Comunidade e moderação"})}),e.jsxs(_,{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"rounded-xl border border-border/60 bg-card/60 p-4",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Comentários criados"}),e.jsx("p",{className:`mt-2 text-2xl font-semibold ${r?"animate-pulse":""}`,children:r?"-":v(U)})]}),e.jsxs("div",{className:"rounded-xl border border-border/60 bg-card/60 p-4",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Comentários aprovados"}),e.jsx("p",{className:`mt-2 text-2xl font-semibold ${r?"animate-pulse":""}`,children:r?"-":v(O)})]}),e.jsxs("div",{className:"rounded-xl border border-border/60 bg-card/60 p-4",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Taxa de aprovação"}),e.jsx("p",{className:`mt-2 text-2xl font-semibold ${r?"animate-pulse":""}`,children:r?"-":W===null?"0,0%":Ve(W)})]})]})]}),e.jsxs("div",{className:"grid min-w-0 gap-6 lg:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]",children:[e.jsxs(k,{className:"min-w-0 animate-slide-up opacity-0",style:{animationDelay:"220ms"},children:[e.jsx(S,{children:e.jsxs($,{children:["Série temporal (",se(l),")"]})}),e.jsx(_,{className:"min-w-0",children:r?e.jsx("p",{className:"animate-pulse text-sm text-muted-foreground",children:"Carregando série temporal..."}):F.length?e.jsx(ae,{className:"min-w-0 w-full max-w-full h-52 sm:h-60 lg:h-[280px]",config:{metric:{label:se(l),color:"hsl(var(--accent))"}},children:e.jsxs($e,{data:F,margin:{left:12,right:12,top:12,bottom:8},children:[e.jsx(_e,{vertical:!1}),e.jsx(Le,{dataKey:"date",tickLine:!1,axisLine:!1,tickFormatter:Ie,interval:"preserveStartEnd",minTickGap:18,tickMargin:8}),e.jsx(Te,{tickLine:!1,axisLine:!1,width:32,tickMargin:8}),e.jsx(Pe,{content:e.jsx(ie,{})}),e.jsx(qe,{type:"monotone",dataKey:"value",stroke:"var(--color-metric)",strokeWidth:2,dot:!1})]})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Sem dados para o período selecionado."})})]}),e.jsxs(k,{className:"min-w-0 animate-slide-up opacity-0",style:{animationDelay:"260ms"},children:[e.jsx(S,{children:e.jsx($,{children:"Aquisição (origens)"})}),e.jsx(_,{className:"min-w-0 space-y-3",children:r?e.jsx("p",{className:"animate-pulse text-sm text-muted-foreground",children:"Carregando origens..."}):H.length?H.slice(0,8).map(t=>e.jsxs("div",{className:"flex min-w-0 items-center gap-2 text-sm",children:[e.jsx("span",{title:ee(t.key),className:"min-w-0 flex-1 truncate text-muted-foreground",children:ee(t.key)}),e.jsx(we,{variant:"secondary",className:"shrink-0",children:v(t.count)})]},t.key)):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Sem dados de aquisição."})})]})]}),e.jsxs(k,{className:"animate-slide-up opacity-0",style:{animationDelay:"300ms"},children:[e.jsx(S,{children:e.jsx($,{children:"Top conteúdos"})}),e.jsx(_,{children:r?e.jsx("p",{className:"animate-pulse text-sm text-muted-foreground",children:"Carregando conteúdos..."}):B.length?e.jsxs(be,{children:[e.jsx(ye,{children:e.jsxs(Z,{children:[e.jsx(I,{children:"Tipo"}),e.jsx(I,{children:"Título"}),e.jsx(I,{className:"text-right",children:"Views"}),e.jsx(I,{className:"text-right",children:"Únicas"})]})}),e.jsx(Ne,{children:B.map(t=>e.jsxs(Z,{children:[e.jsx(M,{children:Ue(t.resourceType)}),e.jsx(M,{children:t.title}),e.jsx(M,{className:"text-right",children:v(t.views)}),e.jsx(M,{className:"text-right",children:v(t.uniqueViews)})]},`${t.resourceType}:${t.resourceId}`))})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum conteúdo com views no período."})})]})]})})})};export{_s as default};
