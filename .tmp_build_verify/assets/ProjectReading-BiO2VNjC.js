const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/LexicalViewer-Dm1E6taJ.js","assets/react-core-BcR2_z_l.js","assets/lexical-CVusBMfS.js","assets/playground-overrides-BL6rcNro.js","assets/ContentEditable-BX3pcmlG.js","assets/ContentEditable-CWrSnP84.css","assets/PlaygroundNodes-ChCl_XRL.js","assets/index-ntR5v_s2.js","assets/mui-WkDK9qS1.js","assets/index-yv2-JTMp.css","assets/PlaygroundNodes-CkHyeEbx.css","assets/PollContext-CEXjjzNp.js","assets/PollContext-DlEuYIz7.css","assets/ImageLibraryDialog-BbbI0q6f.js","assets/index-CHWtszJ3.js","assets/index-BMIt2_cw.js","assets/createLucideIcon-M1JG7EBz.js","assets/index-DZ2Ey5_7.js","assets/chevron-right-CrdESc7p.js","assets/check-Cyy403AY.js","assets/accordion-DHuEXPng.js","assets/chevron-down-Mfh0mWaz.js","assets/button-C7iHbTqw.js","assets/index-Xj-Q384k.js","assets/index-CwaKb5FF.js","assets/dialog-CLWEkP9q.js","assets/input-BfSJiKKQ.js","assets/x-BpqL4Bns.js","assets/label-BwT1z_RF.js","assets/use-toast-DeMRPCeJ.js","assets/ImageLibraryDialog-B3TEaj-8.css","assets/index-DVZfbOhf.js","assets/trash-2-CSrjaLTp.js","assets/color-picker-Q1yTfexr.js","assets/color-picker-BOQRvWTA.css","assets/floating-ui.react-BugR93ss.js","assets/playground-overrides-K-LXsPQt.css","assets/PlaygroundEditorTheme-nA-I7k_h.js","assets/PlaygroundEditorTheme-BJ5jN8EW.css"])))=>i.map(i=>d[i]);
import{g as T,d as g,_ as B}from"./index-ntR5v_s2.js";import{h as E,i as I,r as a,j as e,L as N}from"./react-core-BcR2_z_l.js";import{B as V}from"./badge-CX6RuieY.js";import{B as y}from"./button-C7iHbTqw.js";import{C as D,a as M}from"./card-VD61BBwz.js";import{L as R,W as z,D as A}from"./DiscordInviteCard-DqV3HUmW.js";import{b as O}from"./project-utils-BfxKnQDe.js";import{C as W}from"./CommentsSection-DQcUB_pi.js";import{u as H}from"./use-page-meta-ewLab265.js";import $ from"./NotFound-D66Ced63.js";import{C as J}from"./chevron-left-BKEfFFqA.js";import{B as Q}from"./book-open-CG_mViAI.js";import"./mui-WkDK9qS1.js";import"./index-CwaKb5FF.js";import"./index-Xj-Q384k.js";import"./skeleton-DbpZ9Rjt.js";import"./date-D79tpn1j.js";import"./sparkles-CtpH76yt.js";import"./createLucideIcon-M1JG7EBz.js";import"./clock--Oqs7kqe.js";import"./message-circle-qqsIJunn.js";import"./users-ok7q4J4c.js";import"./avatar-CVZSwVae.js";import"./alert-dialog-ugflDUIb.js";import"./input-BfSJiKKQ.js";import"./index-CHWtszJ3.js";import"./separator-CDy1CE57.js";import"./textarea-BwWmg86h.js";import"./use-toast-DeMRPCeJ.js";const q=a.lazy(()=>B(()=>import("./LexicalViewer-Dm1E6taJ.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38]))),G=()=>e.jsx("div",{className:"min-h-[320px] w-full rounded-xl border border-border/60 bg-background/60 p-6 text-sm text-muted-foreground",children:"Carregando conteúdo..."}),we=()=>{const{slug:x,chapter:b}=E(),[L]=I(),d=T(),[t,v]=a.useState(null),[s,j]=a.useState(null),[F,C]=a.useState(!1),w=a.useRef(new Set),P=a.useMemo(()=>{if(!t)return"Leitura";const r=s?.number??b,i=r?`Capítulo ${r}`:"Capítulo";return`${s?.title?`${i} - ${s.title}`:i} - ${t.title}`},[b,s?.number,s?.title,t]);H({title:P,description:s?.synopsis||t?.synopsis||"",image:t?.cover,type:"article"}),a.useEffect(()=>{if(!x){C(!0);return}let r=!0;return(async()=>{try{const n=await g(d,`/api/public/projects/${x}`);if(!n.ok){r&&v(null);return}const c=await n.json();r&&v(c.project||null)}catch{r&&v(null)}finally{r&&C(!0)}})(),()=>{r=!1}},[d,x]);const l=Number(b),u=Number(L.get("volume")),k=O(t?.type||""),m=a.useMemo(()=>t?(t.episodeDownloads||[]).filter(r=>typeof r.content=="string"&&r.content.trim().length>0).sort((r,i)=>{const n=(r.number||0)-(i.number||0);return n!==0?n:(r.volume||0)-(i.volume||0)}):[],[t]),o=a.useMemo(()=>!t||!Number.isFinite(l)?null:m.find(r=>r.number!==l?!1:Number.isFinite(u)?(r.volume||0)===u:!0),[t,m,l,u]),p=a.useMemo(()=>o?m.findIndex(r=>r.number!==o.number?!1:(r.volume||0)===(o.volume||0)):-1,[m,o]),f=p>0?m[p-1]:null,h=p>=0&&p<m.length-1?m[p+1]:null;a.useEffect(()=>{let r=!0;return(async()=>{if(!t||!Number.isFinite(l))return;const n=Number.isFinite(u)?`?volume=${u}`:"";try{const c=await g(d,`/api/public/projects/${t.id}/chapters/${l}${n}`);if(!c.ok){r&&j(null);return}const _=await c.json();r&&j(_.chapter||null)}catch{r&&j(null)}})(),()=>{r=!1}},[d,t,l,u]),a.useEffect(()=>{if(!t?.id||!Number.isFinite(s?.number))return;const r=Number(s.number),i=Number(s.volume),n=`${t.id}:${r}:${Number.isFinite(i)?i:0}`;if(w.current.has(n))return;w.current.add(n);const c={eventType:"chapter_view",resourceType:"chapter",resourceId:n,meta:{projectId:t.id,chapterNumber:r}};Number.isFinite(i)&&(c.meta.volume=i),g(d,"/api/public/analytics/event",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)})},[d,t?.id,s?.number,s?.volume]);const S=s?.content||"";return!x||!t&&F?e.jsx($,{}):t?k?e.jsx("div",{className:"flex min-h-screen flex-col",children:e.jsx("main",{className:"flex-1 bg-background",children:e.jsxs("section",{className:"mx-auto w-full max-w-6xl px-6 pb-16 pt-10 md:px-10",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsx(y,{asChild:!0,variant:"ghost",size:"sm",className:"gap-2",children:e.jsxs(N,{to:`/projeto/${t.id}`,children:[e.jsx(J,{className:"h-4 w-4"}),"Voltar ao projeto"]})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[f?e.jsx(y,{asChild:!0,size:"sm",variant:"outline",children:e.jsx(N,{to:`/projeto/${t.id}/leitura/${f.number}${f.volume?`?volume=${f.volume}`:""}`,children:"Capítulo anterior"})}):null,h?e.jsx(y,{asChild:!0,size:"sm",children:e.jsx(N,{to:`/projeto/${t.id}/leitura/${h.number}${h.volume?`?volume=${h.volume}`:""}`,children:"Próximo capítulo"})}):null]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(V,{variant:"secondary",className:"text-xs uppercase",children:["Cap ",o?.number??l,o?.volume?` • Vol. ${o.volume}`:""]}),e.jsx("h1",{className:"text-2xl font-semibold text-foreground md:text-3xl",children:s?.title||o?.title||t.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t.title," • Leitura de Light Novel"]})]})]}),e.jsxs("section",{className:"mt-8 grid gap-8 lg:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]",children:[e.jsxs("article",{className:"min-w-0 space-y-6",children:[e.jsx(D,{className:"group border-border/60 bg-card/80 shadow-lg transition-all duration-300 hover:-translate-y-1 hover:border-primary/40 hover:bg-card/90 hover:shadow-lg",children:e.jsxs(M,{className:"min-w-0 space-y-6 p-6",children:[s?.synopsis||o?.synopsis?e.jsx("p",{className:"text-sm text-muted-foreground transition-colors duration-300 group-hover:text-foreground/80",children:s?.synopsis||o?.synopsis}):null,s?.content?e.jsx(a.Suspense,{fallback:e.jsx(G,{}),children:e.jsx(q,{value:S,className:"post-content reader-content min-w-0 w-full space-y-4 text-sm text-muted-foreground",pollTarget:t?.id&&Number.isFinite(l)?{type:"chapter",projectId:t.id,chapterNumber:o?.number??l,volume:o?.volume??(Number.isFinite(u)?u:void 0)}:void 0})}):e.jsx("div",{className:"rounded-xl border border-dashed border-border/60 bg-background/60 p-6 text-center text-sm text-muted-foreground",children:"Conteúdo ainda não disponível."})]})}),e.jsx(W,{targetType:"chapter",targetId:t.id,chapterNumber:o?.number??l,volume:o?.volume??(Number.isFinite(u)?u:void 0)}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(Q,{className:"h-4 w-4 text-primary/70"}),"Capítulos publicados diretamente no site."]})]}),e.jsxs("aside",{className:"min-w-0 space-y-6",children:[e.jsx(R,{}),e.jsx(z,{}),e.jsx(A,{})]})]})]})})}):e.jsx($,{}):null};export{we as default};
