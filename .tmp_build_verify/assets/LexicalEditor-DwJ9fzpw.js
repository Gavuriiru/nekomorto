import{r as o,j as t}from"./react-core-BcR2_z_l.js";import{f as y,o as R,D as x,j as h,at as S,g as b}from"./lexical-CVusBMfS.js";import{S as P,F as N,T as C,E as T}from"./playground-overrides-BL6rcNro.js";import{P as v,T as L}from"./PlaygroundNodes-ChCl_XRL.js";import{t as M}from"./PlaygroundEditorTheme-nA-I7k_h.js";import{S as V}from"./ContentEditable-BX3pcmlG.js";import{P as k}from"./PollContext-CEXjjzNp.js";import"./index-ntR5v_s2.js";import"./mui-WkDK9qS1.js";import"./ImageLibraryDialog-BbbI0q6f.js";import"./index-CHWtszJ3.js";import"./index-BMIt2_cw.js";import"./createLucideIcon-M1JG7EBz.js";import"./index-DZ2Ey5_7.js";import"./chevron-right-CrdESc7p.js";import"./check-Cyy403AY.js";import"./accordion-DHuEXPng.js";import"./chevron-down-Mfh0mWaz.js";import"./button-C7iHbTqw.js";import"./index-Xj-Q384k.js";import"./index-CwaKb5FF.js";import"./dialog-CLWEkP9q.js";import"./input-BfSJiKKQ.js";import"./x-BpqL4Bns.js";import"./label-BwT1z_RF.js";import"./use-toast-DeMRPCeJ.js";import"./index-DVZfbOhf.js";import"./trash-2-CSrjaLTp.js";import"./color-picker-Q1yTfexr.js";import"./floating-ui.react-BugR93ss.js";const q=e=>{e.blur(),e.update(()=>{b(null)},{discrete:!0});const r=e.getRootElement();r&&document.activeElement===r&&r.blur()},E=o.forwardRef((e,r)=>{const[i]=R();return o.useImperativeHandle(r,()=>({focus:()=>i.focus(),blur:()=>q(i)})),null});E.displayName="EditorBridge";const g=e=>{if(!e)return null;try{const r=JSON.parse(e);if(r&&typeof r=="object")return e}catch{return null}return null},J=({value:e,onChange:r})=>{const[i]=R(),c=o.useRef(!1),u=o.useRef(null),p=o.useRef(r),l=o.useRef(null),a=o.useRef(!1),f=o.useRef(null),m=o.useRef(!1);return o.useEffect(()=>{p.current=r},[r]),o.useEffect(()=>{if(e===u.current||(f.current=e,m.current))return;m.current=!0,(typeof queueMicrotask=="function"?queueMicrotask:n=>Promise.resolve().then(n))(()=>{m.current=!1;const n=f.current;if(f.current=null,n==null||n===u.current)return;if(!n){try{c.current=!0,i.update(()=>{const s=x();s.clear(),s.append(h())},{discrete:!0})}finally{u.current=n,c.current=!1}return}const d=g(n);if(!d){try{c.current=!0,i.update(()=>{const s=x();s.clear(),s.append(h())},{discrete:!0}),u.current=n}finally{c.current=!1}return}try{c.current=!0;const s=i.parseEditorState(d);i.setEditorState(s),u.current=n}catch{i.update(()=>{const s=x();s.clear(),s.append(h())},{discrete:!0})}finally{c.current=!1}})},[i,e]),t.jsx(S,{onChange:j=>{if(c.current)return;const n=JSON.stringify(j.toJSON());if(n!==u.current&&(u.current=n,l.current=n,!a.current)){a.current=!0;const d=()=>{a.current=!1;const s=l.current;l.current=null,s!=null&&p.current(s)};typeof queueMicrotask=="function"?queueMicrotask(d):Promise.resolve().then(d)}}})},w=({readOnly:e})=>{const[r]=R();return o.useEffect(()=>{r.setEditable(!e)},[r,e]),null},B=o.forwardRef(({value:e,onChange:r,placeholder:i,className:c,readOnly:u,imageLibraryOptions:p},l)=>{const a=o.useRef({namespace:"RainbowLexicalPlayground",theme:M,nodes:v,onError:f=>{console.error(f)},editable:!u,editorState:g(e)||void 0}).current;return t.jsx(P,{children:t.jsx(N,{children:t.jsx(k,{value:{},children:t.jsx(y,{initialConfig:a,children:t.jsx(V,{children:t.jsx(C,{children:t.jsxs(L,{children:[t.jsx("div",{className:`lexical-playground ${c||""}`,children:t.jsx("div",{className:"editor-shell",children:t.jsx(T,{hideToolbar:!!u,placeholder:i,imageLibraryOptions:p})})}),t.jsx(J,{value:e,onChange:r}),t.jsx(w,{readOnly:u}),t.jsx(E,{ref:l})]})})})})})})})});B.displayName="LexicalEditor";export{B as default};
