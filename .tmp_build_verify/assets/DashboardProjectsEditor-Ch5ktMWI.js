const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/LexicalEditor-DwJ9fzpw.js","assets/react-core-BcR2_z_l.js","assets/lexical-CVusBMfS.js","assets/playground-overrides-BL6rcNro.js","assets/ContentEditable-BX3pcmlG.js","assets/ContentEditable-CWrSnP84.css","assets/PlaygroundNodes-ChCl_XRL.js","assets/index-ntR5v_s2.js","assets/mui-WkDK9qS1.js","assets/index-yv2-JTMp.css","assets/PlaygroundNodes-CkHyeEbx.css","assets/PollContext-CEXjjzNp.js","assets/PollContext-DlEuYIz7.css","assets/ImageLibraryDialog-BbbI0q6f.js","assets/index-CHWtszJ3.js","assets/index-BMIt2_cw.js","assets/createLucideIcon-M1JG7EBz.js","assets/index-DZ2Ey5_7.js","assets/chevron-right-CrdESc7p.js","assets/check-Cyy403AY.js","assets/accordion-DHuEXPng.js","assets/chevron-down-Mfh0mWaz.js","assets/button-C7iHbTqw.js","assets/index-Xj-Q384k.js","assets/index-CwaKb5FF.js","assets/dialog-CLWEkP9q.js","assets/input-BfSJiKKQ.js","assets/x-BpqL4Bns.js","assets/label-BwT1z_RF.js","assets/use-toast-DeMRPCeJ.js","assets/ImageLibraryDialog-B3TEaj-8.css","assets/index-DVZfbOhf.js","assets/trash-2-CSrjaLTp.js","assets/color-picker-Q1yTfexr.js","assets/color-picker-BOQRvWTA.css","assets/floating-ui.react-BugR93ss.js","assets/playground-overrides-K-LXsPQt.css","assets/PlaygroundEditorTheme-nA-I7k_h.js","assets/PlaygroundEditorTheme-BJ5jN8EW.css"])))=>i.map(i=>d[i]);
import{g as vr,b as Nr,d as Z,_ as Ns}from"./index-ntR5v_s2.js";import{k as yr,r as c,i as Sr,j as t,L as wr}from"./react-core-BcR2_z_l.js";import{D as Dr}from"./DashboardShell-BZQMplB5.js";import{D as Cr,a as Er,d as et,E as Ir}from"./DashboardPageHeader-B1rVFloq.js";import{T as Ar,L as kr}from"./ThemedSvgLogo-CGFMwyp6.js";import{B as k}from"./badge-CX6RuieY.js";import{B as N}from"./button-C7iHbTqw.js";import{C as It,a as At}from"./card-VD61BBwz.js";import{A as ms,a as G,b as q,c as W}from"./accordion-DHuEXPng.js";import{D as kt,a as $t,b as Tt,c as Pt,d as Mt}from"./dialog-CLWEkP9q.js";import{I as y}from"./input-BfSJiKKQ.js";import{L as w}from"./label-BwT1z_RF.js";import{S as je,a as be,b as ve,c as Ne,d as O}from"./select-BOMyCGLP.js";import{T as $r}from"./textarea-BwWmg86h.js";import{S as Tr}from"./switch-D-C3W2Iz.js";import{P as Pr,a as Mr,b as Lt,c as Lr,d as Fr,e as Rr}from"./pagination-DtDLAEll.js";import{t as E}from"./use-toast-DeMRPCeJ.js";import{c as Br}from"./post-content-pZXP5BxF.js";import{b as Ft,s as Te,t as ye,a as tt,d as Or,c as zr}from"./project-taxonomy-jSQkF-Xh.js";import{a as ys,b as Ur,i as _r}from"./project-utils-BfxKnQDe.js";import{p as ps,f as Vr}from"./file-size-BTsg2_fJ.js";import{u as Hr}from"./use-page-meta-ewLab265.js";import{P as Gr}from"./plus-93D78Kzx.js";import{C as qr}from"./copy-DDizKV-Q.js";import{T as gs}from"./trash-2-CSrjaLTp.js";import{D as fs,H as Wr,C as Qr,S as Yr}from"./send-MS8NRuAC.js";import"./mui-WkDK9qS1.js";import"./Footer-C9y59CM9.js";import"./createLucideIcon-M1JG7EBz.js";import"./avatar-CVZSwVae.js";import"./index-Xj-Q384k.js";import"./shield-DlmGTLiS.js";import"./index-BMIt2_cw.js";import"./index-DZ2Ey5_7.js";import"./index-CHWtszJ3.js";import"./chevron-right-CrdESc7p.js";import"./check-Cyy403AY.js";import"./users-ok7q4J4c.js";import"./info-BTb-jBiG.js";import"./book-open-CG_mViAI.js";import"./ThemedSvgMaskIcon-B_IYD_H5.js";import"./url-safety-Py24cS-5.js";import"./globe-CRGpuS2E.js";import"./message-circle-qqsIJunn.js";import"./x-BpqL4Bns.js";import"./index-CwaKb5FF.js";import"./separator-CDy1CE57.js";import"./skeleton-DbpZ9Rjt.js";import"./search-ranking-cq4don08.js";import"./use-dynamic-synopsis-clamp-DpjBDBPb.js";import"./access-control-C6qZ0ZhA.js";import"./chevron-down-Mfh0mWaz.js";import"./chevron-left-BKEfFFqA.js";import"./lexical-CVusBMfS.js";import"./PlaygroundNodes-ChCl_XRL.js";const Jr=c.lazy(()=>Ns(()=>import("./LexicalEditor-DwJ9fzpw.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38]))),Xr=c.lazy(()=>Ns(()=>import("./ImageLibraryDialog-BbbI0q6f.js"),__vite__mapDeps([13,1,14,7,8,9,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30]))),Zr=()=>t.jsx("div",{className:"min-h-[380px] w-full rounded-2xl border border-border/60 bg-card/60 p-4 text-sm text-muted-foreground",children:"Carregando editor..."}),Rt={id:"",anilistId:null,title:"",titleOriginal:"",titleEnglish:"",synopsis:"",description:"",type:"Anime",status:"Em andamento",year:"",studio:"",episodes:"",tags:[],genres:[],cover:"",banner:"",season:"",schedule:"",rating:"",country:"",source:"",producers:[],score:null,startDate:"",endDate:"",relations:[],staff:[],animeStaff:[],trailerUrl:"",forceHero:!1,heroImageUrl:"",episodeDownloads:[]},Kr=["Anime","Mangá","Webtoon","Light Novel","Filme","OVA","ONA","Especial","Spin-off"],ea=["Em andamento","Finalizado","Pausado","Cancelado"],Ss=[{id:"aguardando-raw",label:"Aguardando Raw"},{id:"traducao",label:"Tradução"},{id:"revisao",label:"Revisão"},{id:"timing",label:"Timing"},{id:"typesetting",label:"Typesetting"},{id:"quality-check",label:"Quality Check"},{id:"encode",label:"Encode"}],ws=[{id:"aguardando-raw",label:"Aguardando Raw"},{id:"traducao",label:"Tradução"},{id:"limpeza",label:"Limpeza"},{id:"redrawing",label:"Redrawing"},{id:"revisao",label:"Revisão"},{id:"typesetting",label:"Typesetting"},{id:"quality-check",label:"Quality Check"}],Bt=(h,i)=>{const v=ys(h)?ws:Ss,b=new Set((i||[]).filter(Boolean));return v.find(C=>!b.has(C.id))?.id||v[v.length-1]?.id||"aguardando-raw"},ta=(h,i)=>{if(!h&&!i)return"";const g=h?h.toLowerCase().replace("winter","Inverno").replace("spring","Primavera").replace("summer","Verão").replace("fall","Outono"):"";return`${g?`${g} `:""}${i||""}`.trim()},hs=h=>{switch(h){case"FINISHED":return"Finalizado";case"RELEASING":return"Em andamento";case"NOT_YET_RELEASED":return"Em andamento";case"CANCELLED":return"Cancelado";case"HIATUS":return"Pausado";default:return""}},xs=h=>{switch(h){case"TV":return"Anime";case"MOVIE":return"Filme";case"OVA":return"OVA";case"ONA":return"ONA";case"SPECIAL":return"Especial";case"MANGA":return"Mangá";case"NOVEL":return"Light Novel";case"ONE_SHOT":return"One-shot";case"MUSIC":return"Música";default:return""}},sa=h=>h?h.replace(/<br\s*\/?>/gi,`
`).replace(/<[^>]*>/g,"").replace(/\n{3,}/g,`

`).trim():"",se=h=>h.replace(/\D/g,""),js=h=>{const i=se(h).slice(0,8);return i?i.length<=2?i:i.length<=4?`${i.slice(0,2)}/${i.slice(2)}`:`${i.slice(0,2)}/${i.slice(2,4)}/${i.slice(4)}`:""},bs=h=>{const i=se(h).slice(0,9);return i?i.length<=2?i:i.length<=4?`${i.slice(0,i.length-2)}:${i.slice(-2)}`:`${i.slice(0,i.length-4)}:${i.slice(-4,-2)}:${i.slice(-2)}`:""},st=h=>{const i=String(h||"").trim();if(!i)return"";const g=se(i).slice(0,8);if(g.length!==8)return"";const v=Number(g.slice(0,2)),b=Number(g.slice(2,4)),x=Number(g.slice(4,8));if(!Number.isFinite(v)||!Number.isFinite(b)||!Number.isFinite(x)||b<1||b>12||v<1||v>31||x<1e3)return"";const C=`${String(x).padStart(4,"0")}-${String(b).padStart(2,"0")}-${String(v).padStart(2,"0")}`,$=new Date(`${C}T00:00`);return Number.isNaN($.getTime())||$.getFullYear()!==x||$.getMonth()+1!==b||$.getDate()!==v?"":C},ra=h=>{const i=String(h||"").trim();if(!i)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(i))return`${i.slice(8,10)}/${i.slice(5,7)}/${i.slice(0,4)}`;if(/^\d{2}-\d{2}-\d{4}$/.test(i))return i.replace(/-/g,"/");if(/^\d{2}\/\d{2}\/\d{4}$/.test(i))return i;if(/^\d{4}-\d{2}-\d{2}[T\s]\d{2}:\d{2}/.test(i))return`${i.slice(8,10)}/${i.slice(5,7)}/${i.slice(0,4)}`;const g=new Date(i);if(Number.isNaN(g.getTime()))return"";const v=String(g.getDate()).padStart(2,"0"),b=String(g.getMonth()+1).padStart(2,"0"),x=String(g.getFullYear()).padStart(4,"0");return`${v}/${b}/${x}`},rt=h=>{const i=String(h||"").trim();if(!i)return"";const g=se(i).slice(0,9);if(g.length<3)return"";let v=0,b=0,x=0;return g.length<=4?(b=Number(g.slice(0,g.length-2)),x=Number(g.slice(-2))):(v=Number(g.slice(0,g.length-4)),b=Number(g.slice(-4,-2)),x=Number(g.slice(-2))),!Number.isFinite(v)||!Number.isFinite(b)||!Number.isFinite(x)||v<0||b<0||b>59||x<0||x>59?"":`${String(v).padStart(2,"0")}:${String(b).padStart(2,"0")}:${String(x).padStart(2,"0")}`},Ds=h=>{const i=String(h||"").trim();if(!i)return"";let g="";if(/^\d{1,}:\d{2}:\d{2}$/.test(i)){const[$,T,z]=i.split(":"),M=Number($),de=Number(T),Q=Number(z);Number.isFinite(M)&&Number.isFinite(de)&&Number.isFinite(Q)&&M>=0&&de>=0&&de<=59&&Q>=0&&Q<=59&&(g=`${String(M).padStart(2,"0")}:${String(de).padStart(2,"0")}:${String(Q).padStart(2,"0")}`)}else if(/^\d{1,}:\d{2}$/.test(i)){const[$,T]=i.split(":"),z=Number($),M=Number(T);Number.isFinite(z)&&Number.isFinite(M)&&z>=0&&M>=0&&M<=59&&(g=`${String(z).padStart(2,"0")}:${String(M).padStart(2,"0")}:00`)}else g=rt(i);if(!g)return"";const[v,b,x]=g.split(":"),C=Number(v);return Number.isFinite(C)?C===0?`${b}:${x}`:`${C}:${b}:${x}`:g},aa=h=>{const i=String(h||"").trim();if(!i)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(i))return i;if(/^\d{2}-\d{2}-\d{4}$/.test(i)||/^\d{2}\/\d{2}\/\d{4}$/.test(i))return st(i);if(/^\d{4}-\d{2}-\d{2}[T\s]\d{2}:\d{2}/.test(i))return i.slice(0,10);const g=new Date(i);if(Number.isNaN(g.getTime()))return"";const v=String(g.getFullYear()).padStart(4,"0"),b=String(g.getMonth()+1).padStart(2,"0"),x=String(g.getDate()).padStart(2,"0");return`${v}-${b}-${x}`},na=h=>{const i=String(h||"").trim();if(!i)return"";if(/^\d{1,}:\d{2}:\d{2}$/.test(i)){const[g,v,b]=i.split(":"),x=Number(g),C=Number(v),$=Number(b);return Number.isFinite(x)&&Number.isFinite(C)&&Number.isFinite($)&&x>=0&&C>=0&&C<=59&&$>=0&&$<=59?`${String(x).padStart(2,"0")}:${String(C).padStart(2,"0")}:${String($).padStart(2,"0")}`:""}if(/^\d{1,}:\d{2}$/.test(i)){const[g,v]=i.split(":"),b=Number(g),x=Number(v);return Number.isFinite(b)&&Number.isFinite(x)&&b>=0&&x>=0&&x<=59?`${String(b).padStart(2,"0")}:${String(x).padStart(2,"0")}:00`:""}return rt(i)},oa=(h,i)=>{const g=aa(h);if(!g)return String(h||"");const v=na(i),b=new Date(`${g}T00:00`);if(Number.isNaN(b.getTime()))return g;const x=new Intl.DateTimeFormat("pt-BR",{dateStyle:"short"}).format(b);if(!v)return x;const C=Ds(v);return C?`${x} · ${C}`:x},Pe=(h,i)=>{const g={};return Object.entries(h).forEach(([v,b])=>{const x=Number(v);!Number.isFinite(x)||x===i||(g[x>i?x-1:x]=b)}),g},ia=(h,i)=>{const g={};return Object.entries(h).forEach(([v,b])=>{const x=Number(v);!Number.isFinite(x)||x===i||(g[x>i?x-1:x]=!!b)}),g},Ot=h=>`episode-${h}`,la=["[data-no-toggle]","button","a","input","select","textarea","label",'[role="button"]','[role="link"]','[contenteditable="true"]'].join(", "),ca=h=>h instanceof Element?!!h.closest(la):!1,da=(h,i)=>{const g=String(h||"").trim(),v=Br(String(i||"").trim()),x=`projects/${g||v||"draft"}`;return{projectRootFolder:x,projectEpisodesFolder:`${x}/episodes`}},ua=()=>{const h=String.fromCharCode(97+Math.floor(Math.random()*26)),i=Math.random().toString(36).slice(2,9),g=Date.now().toString(36).slice(-3);return`${h}${i}${g}`},vs=h=>{const i=Number(h);return!Number.isFinite(i)||i<1?1:Math.floor(i)},Me=(h,i)=>JSON.stringify({form:h,anilistIdInput:i.trim()}),ma=({value:h,onChange:i,onRegister:g,imageLibraryOptions:v})=>{const b=c.useRef(null);return c.useEffect(()=>{g&&g(b.current)},[g]),t.jsx(c.Suspense,{fallback:t.jsx(Zr,{}),children:t.jsx(Jr,{ref:b,value:h,onChange:i,placeholder:"Escreva o capítulo...",className:"lexical-playground--modal",imageLibraryOptions:v})})},jn=()=>{Hr({title:"Projetos",noIndex:!0});const h=yr(),i=vr(),{settings:g}=Nr(),v=4320*60*1e3,[b,x]=c.useState(null),[C,$]=c.useState(!1),[T,z]=c.useState([]),[M,de]=c.useState(!0),[Q,Cs]=c.useState(""),[B,Le]=Sr(),[L,zt]=c.useState(()=>{const e=B.get("sort");return e==="alpha"||e==="status"||e==="views"||e==="comments"||e==="recent"?e:"alpha"}),[K,ue]=c.useState(()=>vs(B.get("page"))),[Fe,me]=c.useState(!1),[Es,Ut]=c.useState(!1),Is=c.useMemo(()=>{const s=(g?.downloads?.sources?.map(r=>({label:String(r.label||"").trim(),icon:r.icon,color:r.color||"#7C3AED",tintIcon:r.tintIcon!==!1}))??[]).filter(r=>r.label);return s.length?s:[{label:"Google Drive",icon:"google-drive",color:"#34A853"},{label:"MEGA",icon:"mega",color:"#D9272E"},{label:"Torrent",icon:"torrent",color:"#7C3AED"},{label:"Mediafire",icon:"mediafire",color:"#2563EB"},{label:"Telegram",icon:"telegram",color:"#0EA5E9"},{label:"Outro",icon:"link",color:"#64748B"}]},[g?.downloads?.sources]),As=(e,s,r,a=!0)=>{if(e&&(e.startsWith("http")||e.startsWith("data:")||e.startsWith("/uploads/")))return a?t.jsx(Ar,{url:e,label:r||"Fonte de download",className:"h-4 w-4",color:s}):t.jsx("img",{src:e,alt:r||"",className:"h-4 w-4"});const n=String(e||"").toLowerCase();if(n==="google-drive")return t.jsx("svg",{viewBox:"0 0 24 24","aria-hidden":"true",className:"h-4 w-4",style:{color:s},children:t.jsx("path",{fill:"currentColor",d:"M7.5 3h9l4.5 8-4.5 8h-9L3 11z"})});if(n==="mega")return t.jsxs("svg",{viewBox:"0 0 24 24","aria-hidden":"true",className:"h-4 w-4",children:[t.jsx("circle",{cx:"12",cy:"12",r:"10",fill:s}),t.jsx("path",{fill:"#fff",d:"M7.2 16.4V7.6h1.6l3.2 4.2 3.2-4.2h1.6v8.8h-1.6V10l-3.2 4.1L8.8 10v6.4z"})]});const m={telegram:Yr,mediafire:Qr,torrent:Wr,link:kr,download:fs}[n]||fs;return t.jsx(m,{className:"h-4 w-4",style:{color:s}})},[F,Se]=c.useState(null),[o,p]=c.useState(Rt),[pe,Re]=c.useState(null),[re,at]=c.useState(""),[Be,Oe]=c.useState(""),[ze,Ue]=c.useState(""),[pa,ga]=c.useState(""),[_t,Vt]=c.useState({}),[Ht,Gt]=c.useState({}),[qt,Wt]=c.useState({}),[fa,ks]=c.useState(null),[nt,ot]=c.useState(null),[it,lt]=c.useState(null),[ct,dt]=c.useState(null),[ut,$s]=c.useState({}),[Qt,ge]=c.useState({}),[Ts,we]=c.useState({}),[Ps,De]=c.useState({}),[_e,V]=c.useState({}),[mt,H]=c.useState({}),[Ms,Ls]=c.useState([]),[pt,fe]=c.useState({}),[Fs,gt]=c.useState(["dados-principais"]),[he,ft]=c.useState(!1),[U,ht]=c.useState("cover"),[ae,Yt]=c.useState(null),Jt=c.useRef({}),xe=c.useRef({}),[Rs,ne]=c.useState(!1),[Bs,Xt]=c.useState("Sair da edição?"),[Os,Zt]=c.useState("Você tem alterações não salvas. Deseja continuar?"),xt=c.useRef(null),jt=c.useRef(null),bt=c.useRef(null),vt=c.useRef(!1),Kt=c.useRef({sortMode:L,currentPage:K}),Ve=c.useRef(Me(Rt,"")),es=c.useMemo(()=>Me(o,re)!==Ve.current,[re,o]),ts=c.useMemo(()=>{const e=Array.isArray(b?.permissions)?b.permissions:[];return e.includes("*")||e.includes("projetos")},[b]),zs=e=>{if(!(!e&&he)){if(!e){if(!es){me(!1),Se(null);return}Xt("Sair da edição?"),Zt("Você tem alterações não salvas. Deseja continuar?"),xt.current=()=>{me(!1),Se(null)},jt.current=()=>{ne(!1)},ne(!0);return}me(!0)}};c.useEffect(()=>{Fe||Ut(!1)},[Fe]),c.useEffect(()=>{const e=o.episodeDownloads.length-1,s=r=>{let a=!1;const n={};return Object.entries(r).forEach(([l,m])=>{const d=Number(l);if(!Number.isFinite(d)||d<0||d>e){a=!0;return}n[d]=m}),a?n:r};V(r=>s(r)),H(r=>s(r)),Object.keys(xe.current).forEach(r=>{const a=Number(r);(!Number.isFinite(a)||a<0||a>e)&&delete xe.current[a]})},[o.episodeDownloads]);const Nt=c.useMemo(()=>{const e=g.teamRoles.map(r=>r.label).filter(Boolean);if(e.length)return e;const s=o.staff.map(r=>r.role).filter(Boolean);return Array.from(new Set(s))},[g.teamRoles,o.staff]),oe=c.useMemo(()=>Ft(_t),[_t]),Ce=c.useMemo(()=>Ft(Ht),[Ht]),Us=c.useMemo(()=>Ft(qt),[qt]),_s=c.useMemo(()=>Te(o.tags,e=>ye(e,oe)),[o.tags,oe]),Vs=c.useMemo(()=>Te(o.genres,e=>tt(e,Ce)),[o.genres,Ce]),ss=c.useMemo(()=>{const e=new Set;return T.forEach(s=>{(s.tags||[]).forEach(r=>e.add(r))}),Array.from(e).sort((s,r)=>s.localeCompare(r,"pt-BR"))},[T]),rs=c.useMemo(()=>{const e=new Set;return T.forEach(s=>{(s.genres||[]).forEach(r=>e.add(r))}),Array.from(e).sort((s,r)=>s.localeCompare(r,"pt-BR"))},[T]),as=c.useMemo(()=>{const e=Be.trim().toLowerCase();return e?ss.filter(s=>s.toLowerCase().includes(e)&&!o.tags.includes(s)).slice(0,6):[]},[Be,ss,o.tags]),ns=c.useMemo(()=>{const e=ze.trim().toLowerCase();return e?rs.filter(s=>s.toLowerCase().includes(e)&&!o.genres.includes(s)).slice(0,6):[]},[ze,rs,o.genres]);c.useEffect(()=>{(async()=>{try{const s=await Z(i,"/api/me",{auth:!0});if(!s.ok){x(null);return}const r=await s.json();x(r)}catch{x(null)}finally{$(!0)}})()},[i]),c.useEffect(()=>{Kt.current={sortMode:L,currentPage:K}},[K,L]),c.useEffect(()=>{const e=B.get("sort"),s=e==="alpha"||e==="status"||e==="views"||e==="comments"||e==="recent"?e:"alpha",r=vs(B.get("page")),{sortMode:a,currentPage:n}=Kt.current;(a!==s||n!==r)&&(vt.current=!0,zt(m=>m===s?m:s),ue(m=>m===r?m:r))},[B]),c.useEffect(()=>{const e=new URLSearchParams(B);L==="alpha"?e.delete("sort"):e.set("sort",L),K<=1?e.delete("page"):e.set("page",String(K));const s=B.toString(),r=e.toString();if(vt.current){r===s&&(vt.current=!1);return}r!==s&&Le(e,{replace:!0})},[K,B,Le,L]),c.useEffect(()=>{ue(1)},[Q,L]);const Hs=ys(o.type||""),He=Ur(o.type||""),I=_r(o.type||""),yt=I?ws:Ss,{projectRootFolder:Ee,projectEpisodesFolder:Ie}=c.useMemo(()=>da(o.id,o.title),[o.id,o.title]),Ge=c.useMemo(()=>{const e=String(o.id||"").trim();return e?[e]:[]},[o.id]),os=c.useMemo(()=>({uploadFolder:Ee,listFolders:[Ee,Ie],listAll:!1,includeProjectImages:!0,projectImageProjectIds:Ge}),[Ie,Ee,Ge]),St=c.useMemo(()=>({uploadFolder:Ie,listFolders:[Ie,Ee],listAll:!1,includeProjectImages:!0,projectImageProjectIds:Ge}),[Ie,Ee,Ge]),Ae=c.useMemo(()=>U==="episode-cover"?St:os,[St,U,os]),ee=c.useMemo(()=>I?o.episodeDownloads.map((e,s)=>({episode:e,index:s})).sort((e,s)=>{const r=(e.episode.number||0)-(s.episode.number||0);return r!==0?r:(e.episode.volume||0)-(s.episode.volume||0)}):o.episodeDownloads.map((e,s)=>({episode:e,index:s})),[o.episodeDownloads,I]),Gs=c.useMemo(()=>ee.filter(({index:e})=>!pt[e]).map(({index:e})=>Ot(e)),[pt,ee]),qs=c.useCallback(e=>{const s=new Set(e),r={};ee.forEach(({index:a})=>{r[a]=!s.has(Ot(a))}),fe(r)},[ee]),is=c.useCallback(e=>{fe(s=>({...s,[e]:!(s[e]??!1)}))},[]),Ws=c.useCallback((e,s)=>{const r=s.target;r?.closest("[data-episode-accordion-trigger]")||ca(r)||is(e)},[is]);c.useEffect(()=>{if(!I)return;const e=[...ee].map(a=>a.episode),s=o.episodeDownloads;e.some((a,n)=>s[n]!==a)&&(p(a=>({...a,episodeDownloads:e})),fe(a=>{const n={};return ee.forEach((l,m)=>{n[m]=a[l.index]??!1}),n}))},[o.episodeDownloads,I,ee]);const Qs=(e,s)=>{p(r=>{const a={...r};if(U==="cover")a.cover=e;else if(U==="banner")a.banner=e;else if(U==="hero")a.heroImageUrl=e;else if(U==="episode-cover"){if(ae===null)return r;const n=[...r.episodeDownloads];return n[ae]?(n[ae]={...n[ae],coverImageUrl:e},{...r,episodeDownloads:n}):r}return a})},wt=e=>{ht(e),ft(!0)},Ys=e=>{Yt(e),ht("episode-cover"),ft(!0)},qe=c.useCallback(async()=>{const e=await Z(i,"/api/projects",{auth:!0});if(!e.ok)throw new Error("projects_load_failed");const s=await e.json();z(Array.isArray(s.projects)?s.projects:[])},[i]);c.useEffect(()=>{let e=!0;return(async()=>{try{const[r,a,n]=await Promise.allSettled([qe(),Z(i,"/api/users",{auth:!0}),Z(i,"/api/public/tag-translations",{cache:"no-store"})]);if(a.status==="fulfilled"){const l=a.value;if(l.ok){const m=await l.json(),d=Array.isArray(m.users)?m.users.filter(u=>u.status==="active").map(u=>u.name).filter(u=>!!u):[];e&&Ls(Array.from(new Set(d)).sort((u,ie)=>u.localeCompare(ie,"pt-BR")))}}if(r.status==="rejected")throw r.reason;if(n.status==="fulfilled"){const l=n.value;if(l.ok){const m=await l.json();e&&(Vt(m?.tags||{}),Gt(m?.genres||{}),Wt(m?.staffRoles||{}))}}}catch{e&&(z([]),Vt({}),Gt({}),Wt({}))}finally{e&&de(!1)}})(),()=>{e=!1}},[i,qe]),c.useEffect(()=>{he||(ht("cover"),Yt(null))},[he]);const ls=c.useCallback(e=>{if(!e.deletedAt)return!1;const s=new Date(e.deletedAt).getTime();return Number.isFinite(s)?Date.now()-s<=v:!1},[v]),Js=e=>{if(!e.deletedAt)return"";const s=new Date(e.deletedAt).getTime();if(!Number.isFinite(s))return"";const r=v-(Date.now()-s),a=Math.max(0,Math.ceil(r/(1440*60*1e3)));return a<=1?"1 dia":`${a} dias`},Dt=c.useMemo(()=>T.filter(e=>!e.deletedAt),[T]),Ct=c.useMemo(()=>T.filter(e=>e.deletedAt&&ls(e)),[ls,T]),cs=c.useMemo(()=>{const e=Q.trim().toLowerCase();return e?Dt.filter(s=>[s.title,s.titleOriginal,s.titleEnglish,s.synopsis,s.description,s.type,s.status,s.studio,s.episodes,s.tags.join(" "),s.genres.join(" ")].filter(Boolean).join(" ").toLowerCase().includes(e)):Dt},[Dt,Q]),ds=c.useMemo(()=>U==="cover"?o.cover||"":U==="banner"?o.banner||"":U==="hero"?o.heroImageUrl||"":U==="episode-cover"&&ae!==null&&o.episodeDownloads[ae]?.coverImageUrl||"",[ae,o.banner,o.cover,o.episodeDownloads,o.heroImageUrl,U]),ke=c.useMemo(()=>{const e=[...cs];return L==="alpha"?(e.sort((s,r)=>s.title.localeCompare(r.title,"pt-BR")),e):L==="status"?(e.sort((s,r)=>s.status.localeCompare(r.status,"pt-BR")),e):L==="views"?(e.sort((s,r)=>(r.views||0)-(s.views||0)),e):L==="comments"?(e.sort((s,r)=>(r.commentsCount||0)-(s.commentsCount||0)),e):L==="recent"?(e.sort((s,r)=>new Date(r.updatedAt||r.createdAt||0).getTime()-new Date(s.updatedAt||s.createdAt||0).getTime()),e):(e.sort((s,r)=>s.title.localeCompare(r.title,"pt-BR")),e)},[cs,L]),We=10,Qe=Math.max(1,Math.ceil(ke.length/We)),us=(K-1)*We,Xs=ke.slice(us,us+We);c.useEffect(()=>{M||ue(e=>Math.min(e,Qe))},[M,Qe]);const Zs=()=>{const e={...Rt};Se(null),p(e),at(""),gt(["importacao"]),we({}),De({}),V({}),H({}),xe.current={},ge({}),Ve.current=Me(e,""),fe({}),me(!0)},Et=c.useCallback(e=>{const s=Array.isArray(e.episodeDownloads)?e.episodeDownloads.map(l=>({...l,content:l.content||"",contentFormat:"lexical"})):[],r=e.synopsis||e.description||"",a={id:e.id,anilistId:e.anilistId??null,title:e.title||"",titleOriginal:e.titleOriginal||"",titleEnglish:e.titleEnglish||"",synopsis:r,description:r,type:e.type||"",status:e.status||"",year:e.year||"",studio:e.studio||"",episodes:e.episodes||"",tags:Array.isArray(e.tags)?e.tags:[],genres:Array.isArray(e.genres)?e.genres:[],cover:e.cover||"",banner:e.banner||"",season:e.season||"",schedule:e.schedule||"",rating:e.rating||"",country:e.country||"",source:e.source||"",producers:Array.isArray(e.producers)?e.producers:[],score:e.score??null,startDate:e.startDate||"",endDate:e.endDate||"",relations:Array.isArray(e.relations)?e.relations:[],staff:Array.isArray(e.staff)?e.staff:[],animeStaff:Array.isArray(e.animeStaff)?e.animeStaff:[],trailerUrl:e.trailerUrl||"",forceHero:!!e.forceHero,heroImageUrl:e.heroImageUrl||"",episodeDownloads:s},n=e.anilistId?String(e.anilistId):"";Se(e),p(a),at(n),gt(["dados-principais"]),we({}),De({}),V({}),H({}),xe.current={},ge({}),Ve.current=Me(a,n),fe(()=>{const l={};return s.forEach((m,d)=>{l[d]=!0}),l}),me(!0)},[]);c.useEffect(()=>{const e=(B.get("edit")||"").trim();if(!e){bt.current=null;return}if(bt.current===e||M||!C)return;bt.current=e;const s=new URLSearchParams(B);s.delete("edit");const r=ts&&T.find(a=>a.id===e)||null;r&&Et(r),s.toString()!==B.toString()&&Le(s,{replace:!0})},[ts,C,M,Et,T,B,Le]);const Ye=()=>{me(!1),Se(null)},Ks=()=>{if(!es){Ye();return}Xt("Sair da edição?"),Zt("Você tem alterações não salvas. Deseja continuar?"),xt.current=()=>{Ye()},jt.current=()=>{ne(!1)},ne(!0)},er=async()=>{const e=o.title.trim(),s=o.id.trim();if(!e){E({title:"Preencha o título do projeto",description:"O título é obrigatório para salvar.",variant:"destructive"});return}const r=o.episodeDownloads.map(f=>({...f,sources:Array.isArray(f.sources)?f.sources.map(D=>({...D})):[]})),a={..._e},n={...mt};let l=null;Object.entries(_e).forEach(([f,D])=>{const S=Number(f);if(!Number.isFinite(S)){delete a[S],delete n[S];return}const P=r[S];if(!P){delete a[S],delete n[S];return}const _=String(D||"").trim();if(!_){P.sizeBytes=void 0,delete a[S],delete n[S];return}const j=ps(_);if(!j){n[S]="Use formatos como 700 MB ou 1.4 GB.",l===null&&(l=S);return}P.sizeBytes=j,delete a[S],delete n[S]});const m=Object.keys(n).map(f=>Number(f)).filter(f=>Number.isFinite(f)&&String(n[f]||"").trim().length>0);if(m.length>0){const f=l!==null?l:m[0];V(a),H(n),E({title:"Corrija os tamanhos inválidos",description:"Use valores como 700 MB ou 1.4 GB antes de salvar."}),xe.current[f]?.focus();return}V(a),H({});const d=new Date().toISOString(),u=new Map;F?.episodeDownloads?.length&&F.episodeDownloads.forEach(f=>{const D=`${f.number}-${f.volume||0}`;u.set(D,f)});const ie=o.staff.map((f,D)=>{const S=(ut[D]||"").trim();if(!S)return f;const P=f.members||[];return{...f,members:P.includes(S)?P:[...P,S]}}),Je=Number(re),le=o.anilistId??(Number.isFinite(Je)?Je:null),Xe=F?.id?F.id:le?String(le):s||ua(),Ze={...o,anilistId:le,id:Xe,title:e,titleOriginal:o.titleOriginal?.trim()||"",titleEnglish:o.titleEnglish?.trim()||"",synopsis:o.synopsis?.trim()||"",description:o.synopsis?.trim()||"",type:o.type?.trim()||"",status:o.status?.trim()||"",year:o.year?.trim()||"",studio:o.studio?.trim()||"",episodes:o.episodes?.trim()||"",tags:o.tags.filter(Boolean),genres:o.genres.filter(Boolean),cover:o.cover?.trim()||"",banner:o.banner?.trim()||"",season:o.season?.trim()||"",schedule:o.schedule?.trim()||"",rating:o.rating?.trim()||"",country:o.country?.trim()||"",source:o.source?.trim()||"",producers:o.producers.filter(Boolean),startDate:o.startDate||"",endDate:o.endDate||"",trailerUrl:o.trailerUrl?.trim()||"",forceHero:!!o.forceHero,heroImageUrl:o.heroImageUrl?.trim()||"",relations:o.relations.filter(f=>f.title||f.relation||f.projectId).filter((f,D,S)=>{const P=f.projectId||f.anilistId||f.title;return P?S.findIndex(_=>(_.projectId||_.anilistId||_.title)===P)===D:!0}),staff:ie.filter(f=>f.role||f.members.length>0),animeStaff:o.animeStaff.filter(f=>f.role||f.members.length>0),episodeDownloads:r.map(f=>{const D=`${f.number}-${f.volume||0}`,S=u.get(D),P=[String(f.title||""),String(f.releaseDate||""),String(f.content||"").trim()].join("||"),_=[String(S?.title||""),String(S?.releaseDate||""),String(S?.content||"").trim()].join("||"),j=He&&String(f.content||"").trim().length>0&&(!S||P!==_),A=String(f.hash||"").trim(),te=Number(f.sizeBytes),ce=Number.isFinite(te)&&te>0?Math.round(te):void 0;return{...f,hash:A||void 0,sizeBytes:ce,sources:(f.sources||[]).map(R=>{const jr=String(R.label||"").trim(),br=String(R.url||"").trim();return{label:jr,url:br}}).filter(R=>R.url||R.label),completedStages:f.completedStages||[],progressStage:Bt(o.type||"",f.completedStages),chapterUpdatedAt:j?d:S?.chapterUpdatedAt||f.chapterUpdatedAt||""}})},$e=await Z(i,F?`/api/projects/${F.id}`:"/api/projects",{method:F?"PUT":"POST",auth:!0,json:Ze});if(!$e.ok){const f=await $e.json().catch(()=>null),D=typeof f?.error=="string"?f.error:"";if(D==="title_and_id_required"){E({title:"Campos obrigatórios ausentes",description:"Informe título e identificador do projeto.",variant:"destructive"});return}if(D==="id_exists"){E({title:"Identificador já existe",description:"Use outro ID para criar o projeto.",variant:"destructive"});return}if(D==="forbidden"){E({title:"Acesso negado",description:"Você não tem permissão para salvar projetos.",variant:"destructive"});return}E({title:"Não foi possível salvar o projeto",description:"Tente novamente em instantes.",variant:"destructive"});return}const Ke=await $e.json();z(F?f=>f.map(D=>D.id===F.id?Ke.project:D):f=>[...f,Ke.project]),Ve.current=Me(Ze,re),E({title:F?"Projeto atualizado":"Projeto criado",description:"As alterações foram salvas com sucesso.",intent:"success"}),Ye()},tr=async()=>{if(!pe)return;if(!(await Z(i,`/api/projects/${pe.id}`,{method:"DELETE",auth:!0})).ok){E({title:"Não foi possível excluir o projeto",variant:"destructive"});return}await qe(),Re(null),F&&pe.id===F.id&&Ye(),E({title:"Projeto movido para a lixeira",description:"Você pode restaurar por 3 dias."})},sr=async e=>{const s=await Z(i,`/api/projects/${e.id}/restore`,{method:"POST",auth:!0});if(!s.ok){if(s.status===410){E({title:"Janela de restauração expirou"}),await qe();return}E({title:"Não foi possível restaurar o projeto",variant:"destructive"});return}const r=await s.json();z(a=>a.map(n=>n.id===e.id?r.project:n)),E({title:"Projeto restaurado"})},rr=e=>{const s=e.studios?.nodes?.find(j=>j.isAnimationStudio)?.name||e.studios?.nodes?.[0]?.name||"",r=e.producers?.nodes?.map(j=>j.name).filter(Boolean)||[],a=(e.tags||[]).filter(j=>!j.isMediaSpoiler).sort((j,A)=>(A.rank||0)-(j.rank||0)).slice(0,8).map(j=>j.name).filter(Boolean),n=e.relations?.edges||[],l=e.relations?.nodes||[],m=new Map;T.forEach(j=>{j.anilistId&&m.set(j.anilistId,j.id),m.set(Number(j.id),j.id)});const d=new Set,u=l.reduce((j,A,te)=>{const ce=m.get(A.id)||"",R=ce||String(A.id)||A.title?.romaji||"";return R&&d.has(R)||(R&&d.add(R),j.push({relation:zr(n[te]?.relationType||""),title:A.title?.romaji||"",format:xs(A.format||""),status:hs(A.status||""),image:A.coverImage?.large||"",anilistId:A.id,projectId:ce})),j},[]),ie=e.staff?.edges||[],Je=e.staff?.nodes||[],le=new Map;ie.forEach((j,A)=>{const te=j.role||"Equipe",ce=Je[A]?.name?.full||"";if(!ce)return;const R=le.get(te)||[];R.push(ce),le.set(te,R)});const Xe=Array.from(le.entries()).map(([j,A])=>({role:j,members:A})),Ze=e.startDate?.year?`${e.startDate.year}-${String(e.startDate.month||1).padStart(2,"0")}-${String(e.startDate.day||1).padStart(2,"0")}`:"",$e=e.endDate?.year?`${e.endDate.year}-${String(e.endDate.month||1).padStart(2,"0")}-${String(e.endDate.day||1).padStart(2,"0")}`:"",Ke=e.trailer?.id&&e.trailer?.site?e.trailer.site.toLowerCase()==="youtube"?`https://www.youtube.com/watch?v=${e.trailer.id}`:e.trailer.site.toLowerCase()==="dailymotion"?`https://www.dailymotion.com/video/${e.trailer.id}`:"":"",f=(e.tags||[]).filter(j=>!j.isMediaSpoiler).map(j=>j.name).filter(Boolean),D=(e.genres||[]).filter(Boolean),S=sa(e.description||"");p(j=>({...j,id:j.id||String(e.id),anilistId:e.id,title:e.title?.romaji||e.title?.english||e.title?.native||j.title,titleOriginal:e.title?.native||"",titleEnglish:e.title?.english||"",synopsis:S,description:S,type:xs(e.format||"")||j.type,status:hs(e.status||"")||j.status,year:e.seasonYear?String(e.seasonYear):j.year,studio:s,episodes:e.episodes?String(e.episodes):j.episodes,genres:D.length?D:j.genres,tags:a.length?a:j.tags,cover:e.coverImage?.extraLarge||e.coverImage?.large||j.cover,banner:e.bannerImage||j.banner,season:ta(e.season,e.seasonYear)||j.season,country:e.countryOfOrigin||j.country,source:e.source||j.source,producers:r,score:typeof e.averageScore=="number"&&Number.isFinite(e.averageScore)?e.averageScore:j.score??null,startDate:Ze,endDate:$e,relations:u.length?u:j.relations,animeStaff:Xe.length?Xe:j.animeStaff,trailerUrl:Ke||j.trailerUrl}));const P=f.length?f:a,_=D;(P.length||_.length)&&Z(i,"/api/tag-translations/sync",{method:"POST",headers:{"Content-Type":"application/json"},auth:!0,body:JSON.stringify({tags:P,genres:_})}).catch(()=>{})},ar=async()=>{const e=Number(re);if(!Number.isFinite(e)){E({title:"ID do AniList inválido",description:"Informe um número válido antes de importar.",variant:"destructive"});return}const s=await Z(i,`/api/anilist/${e}`,{auth:!0});if(!s.ok){const n=await s.json().catch(()=>null),l=typeof n?.error=="string"?n.error:"";if(l==="invalid_id"){E({title:"ID do AniList inválido",description:"Não foi possível buscar esse identificador.",variant:"destructive"});return}if(l==="forbidden"){E({title:"Acesso negado",description:"Você não tem permissão para usar a integração do AniList.",variant:"destructive"});return}if(l==="anilist_failed"){E({title:"Falha ao importar do AniList",description:"A API externa não respondeu como esperado.",variant:"destructive"});return}E({title:"Não foi possível importar do AniList",description:"Tente novamente em alguns instantes.",variant:"destructive"});return}const a=(await s.json())?.data?.Media;if(!a){E({title:"AniList sem resultados",description:"Nenhuma mídia foi encontrada para esse ID.",variant:"destructive"});return}rr(a),E({title:"Dados importados do AniList",description:"Campos do projeto foram preenchidos automaticamente.",intent:"success"})},nr=()=>{const e=Be.trim();e&&(p(s=>({...s,tags:s.tags.includes(e)?s.tags:[...s.tags,e]})),Oe(""))},or=()=>{const e=ze.trim();e&&(p(s=>({...s,genres:s.genres.includes(e)?s.genres:[...s.genres,e]})),Ue(""))},ir=e=>{p(s=>({...s,tags:s.tags.filter(r=>r!==e)}))},lr=e=>{p(s=>({...s,genres:s.genres.filter(r=>r!==e)}))},cr=e=>{if(nt===null||nt===e){ot(null);return}p(s=>{const r=[...s.relations],[a]=r.splice(nt,1);return r.splice(e,0,a),{...s,relations:r}}),ot(null)},dr=e=>{if(it===null||it===e){lt(null);return}p(s=>{const r=[...s.staff],[a]=r.splice(it,1);return r.splice(e,0,a),{...s,staff:r}}),lt(null)},ur=e=>{if(ct===null||ct===e){dt(null);return}p(s=>{const r=[...s.animeStaff],[a]=r.splice(ct,1);return r.splice(e,0,a),{...s,animeStaff:r}}),ge({}),dt(null)},Y="project-editor-section rounded-2xl border border-border/60 bg-card/70 px-4",J="project-editor-section-trigger py-3 text-sm font-semibold hover:no-underline",X="project-editor-section-content pb-4 px-1",mr=F?"Projeto em edição":"Novo projeto",pr=o.title.trim()||"Sem título",gr=o.id.trim()||"Será definido ao salvar",fr=o.type||"Formato",hr=o.status||"Status",xr=o.episodeDownloads.length;return t.jsxs(t.Fragment,{children:[t.jsx(Dr,{currentUser:b,onUserCardClick:()=>h("/dashboard/usuarios?edit=me"),children:t.jsxs(Cr,{children:[t.jsx(Er,{badge:"Projetos",title:"Gerenciar projetos",description:"Crie, edite e organize os projetos visíveis no site.",actions:t.jsxs(N,{className:"gap-2",onClick:Zs,children:[t.jsx(Gr,{className:"h-4 w-4"}),"Novo projeto"]})}),t.jsxs("section",{className:"mt-8 space-y-6",children:[t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 animate-slide-up opacity-0",children:[t.jsxs("div",{className:"flex flex-1 flex-wrap items-center gap-3",children:[t.jsx("div",{className:"w-full max-w-sm",children:t.jsx(y,{value:Q,onChange:e=>Cs(e.target.value),placeholder:"Buscar por título, tags, estúdio..."})}),t.jsxs(je,{value:L,onValueChange:e=>zt(e),children:[t.jsx(be,{className:"w-[210px]",children:t.jsx(ve,{placeholder:"Ordenar por"})}),t.jsxs(Ne,{children:[t.jsx(O,{value:"recent",children:"Mais recentes"}),t.jsx(O,{value:"alpha",children:"Ordem alfabética"}),t.jsx(O,{value:"status",children:"Status"}),t.jsx(O,{value:"views",children:"Visualizações"}),t.jsx(O,{value:"comments",children:"Comentários"})]})]})]}),t.jsxs(k,{variant:"secondary",className:"text-xs uppercase animate-slide-up opacity-0",children:[ke.length," projetos"]})]}),M?t.jsx("div",{className:`${et.surfaceDefault} px-6 py-10 text-sm text-muted-foreground`,children:"Carregando projetos..."}):ke.length===0?t.jsx("div",{className:`${et.surfaceMuted} border-dashed px-6 py-10 text-sm text-muted-foreground`,children:"Nenhum projeto encontrado."}):t.jsx("div",{className:"grid gap-6",children:Xs.map((e,s)=>t.jsx(It,{className:`${et.listCard} group cursor-pointer overflow-hidden transition hover:border-primary/40 animate-slide-up opacity-0`,style:{animationDelay:`${Math.min(s*35,210)}ms`},onClick:()=>Et(e),children:t.jsx(At,{className:"p-0",children:t.jsxs("div",{className:"grid gap-6 md:grid-cols-[220px_1fr]",children:[t.jsxs("div",{className:"relative aspect-2/3 w-full",children:[t.jsx("img",{src:e.cover||"/placeholder.svg",alt:e.title,className:"h-full w-full object-cover object-center",loading:"lazy"}),e.tags[0]?t.jsx(k,{className:"absolute right-3 top-3 text-[10px] uppercase bg-background/85 text-foreground",children:ye(Te(e.tags||[],r=>ye(r,oe))[0]||"",oe)}):null]}),t.jsxs("div",{className:"flex flex-1 flex-col gap-4 p-6",children:[t.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx(k,{variant:"outline",className:"text-[10px] uppercase",children:e.status}),t.jsx(k,{variant:"secondary",className:"text-[10px] uppercase",children:e.type})]}),t.jsx("h3",{className:"text-lg font-semibold text-foreground",children:e.title}),t.jsx("p",{className:"text-xs text-muted-foreground",children:e.studio})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(N,{variant:"ghost",size:"icon",title:"Visualizar",asChild:!0,onClick:r=>r.stopPropagation(),children:t.jsx(wr,{to:`/projeto/${e.id}`,children:t.jsx(Ir,{className:"h-4 w-4"})})}),t.jsx(N,{variant:"ghost",size:"icon",title:"Copiar link",onClick:r=>{r.stopPropagation();const a=`${window.location.origin}/projeto/${e.id}`;navigator.clipboard.writeText(a).catch(()=>{const n=document.createElement("textarea");n.value=a,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n)})},children:t.jsx(qr,{className:"h-4 w-4"})}),t.jsx(N,{variant:"ghost",size:"icon",title:"Excluir",onClick:r=>{r.stopPropagation(),Re(e)},children:t.jsx(gs,{className:"h-4 w-4 text-destructive"})})]})]}),t.jsx("p",{className:"text-sm text-muted-foreground line-clamp-3",children:e.synopsis}),e.tags.length>0?t.jsx("div",{className:"flex flex-wrap gap-2",children:Te(e.tags||[],r=>ye(r,oe)).slice(0,4).map(r=>t.jsx(k,{variant:"secondary",className:"text-[10px] uppercase",children:ye(r,oe)},r))}):null,e.genres?.length?t.jsx("div",{className:"flex flex-wrap gap-2",children:Te(e.genres||[],r=>tt(r,Ce)).slice(0,4).map(r=>t.jsx(k,{variant:"outline",className:"text-[10px] uppercase",children:tt(r,Ce)},r))}):null,t.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-xs text-muted-foreground",children:[t.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.views," visualizações"]}),t.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.commentsCount," comentários"]}),t.jsxs("span",{className:"ml-auto text-xs text-muted-foreground",children:["ID ",e.id]})]})]})]})})},e.id))}),ke.length>We?t.jsx("div",{className:"mt-6 flex justify-center",children:t.jsx(Pr,{children:t.jsxs(Mr,{children:[t.jsx(Lt,{children:t.jsx(Lr,{href:"#",onClick:e=>{e.preventDefault(),ue(s=>Math.max(1,s-1))}})}),Array.from({length:Qe},(e,s)=>s+1).map(e=>t.jsx(Lt,{children:t.jsx(Fr,{href:"#",isActive:e===K,onClick:s=>{s.preventDefault(),ue(e)},children:e})},e)),t.jsx(Lt,{children:t.jsx(Rr,{href:"#",onClick:e=>{e.preventDefault(),ue(s=>Math.min(Qe,s+1))}})})]})})}):null,Ct.length>0?t.jsx(It,{className:"mt-8 border-border/60 bg-card/60",children:t.jsxs(At,{className:"space-y-4 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Lixeira"}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Restaure em até 3 dias após a exclusão."})]}),t.jsxs(k,{variant:"secondary",className:"text-xs uppercase",children:[Ct.length," itens"]})]}),t.jsx("div",{className:"grid gap-3",children:Ct.map((e,s)=>t.jsxs("div",{className:`${et.surfaceDefault} flex flex-wrap items-center justify-between gap-3 px-4 py-3 animate-slide-up opacity-0`,style:{animationDelay:`${Math.min(s*35,210)}ms`},children:[t.jsxs("div",{className:"min-w-0",children:[t.jsx("p",{className:"text-sm font-medium text-foreground",children:e.title}),t.jsxs("p",{className:"text-xs text-muted-foreground",children:["ID ",e.id]})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("span",{className:"text-xs text-muted-foreground",children:["Restam ",Js(e)]}),t.jsx(N,{size:"sm",variant:"outline",onClick:()=>sr(e),children:"Restaurar"})]})]},`trash-${e.id}`))})]})}):null]})]})}),Fe?t.jsx("div",{className:"pointer-events-auto fixed inset-0 z-40 bg-black/80 backdrop-blur-xs","aria-hidden":"true"}):null,t.jsx(kt,{open:Fe,onOpenChange:zs,modal:!1,children:t.jsxs($t,{className:`project-editor-dialog max-h-[94vh] max-w-[min(1120px,calc(100vw-1.5rem))] overflow-y-auto no-scrollbar p-0 ${Es?"editor-modal-scrolled":""}`,onScroll:e=>{const s=e.currentTarget.scrollTop>0;Ut(r=>r===s?r:s)},onPointerDownOutside:e=>{if(he){e.preventDefault();return}e.target?.closest(".lexical-playground")&&e.preventDefault()},onInteractOutside:e=>{if(he){e.preventDefault();return}e.target?.closest(".lexical-playground")&&e.preventDefault()},children:[t.jsxs("div",{className:"project-editor-top sticky top-0 z-20 border-b border-border/60 bg-background/95 backdrop-blur-sm supports-backdrop-filter:bg-background/80",children:[t.jsx(Tt,{className:"space-y-0 px-4 pb-4 pt-5 text-left md:px-6",children:t.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx(k,{variant:"secondary",className:"text-[10px] uppercase tracking-[0.12em]",children:mr}),o.anilistId?t.jsxs(k,{variant:"outline",className:"text-[10px] uppercase tracking-[0.12em]",children:["AniList ",o.anilistId]}):null]}),t.jsx(Pt,{className:"text-xl md:text-2xl",children:F?"Editar projeto":"Novo projeto"}),t.jsx(Mt,{className:"max-w-2xl text-xs md:text-sm",children:"Busque no AniList para preencher automaticamente ou ajuste todos os dados manualmente."})]}),t.jsxs("div",{className:"rounded-xl border border-border/60 bg-card/65 px-3 py-2 text-right",children:[t.jsx("p",{className:"text-[11px] uppercase tracking-[0.12em] text-muted-foreground",children:"Projeto"}),t.jsx("p",{className:"max-w-[210px] truncate text-sm font-medium text-foreground",children:pr})]})]})}),t.jsxs("div",{className:"project-editor-status-bar flex flex-wrap items-center gap-2 border-t border-border/60 px-4 py-3 md:px-6",children:[t.jsxs(k,{variant:"outline",className:"text-[10px] uppercase tracking-[0.12em]",children:["ID ",gr]}),t.jsx(k,{variant:"secondary",className:"text-[10px] uppercase tracking-[0.12em]",children:fr}),t.jsx(k,{variant:"secondary",className:"text-[10px] uppercase tracking-[0.12em]",children:hr}),t.jsxs("span",{className:"text-[11px] text-muted-foreground",children:[xr," ",I?"capítulos":"episódios"]})]})]}),t.jsxs("div",{className:"project-editor-layout grid gap-6 px-4 pb-5 pt-4 md:px-6 md:pb-7",children:[t.jsxs(ms,{type:"multiple",value:Fs,onValueChange:gt,className:"project-editor-accordion space-y-3",children:[t.jsxs(G,{value:"importacao",className:Y,children:[t.jsx(q,{className:J,children:t.jsxs("div",{className:"flex w-full items-center justify-between gap-4 text-left",children:[t.jsx("span",{children:"Importação AniList"}),t.jsx("span",{className:"text-xs text-muted-foreground",children:"Preenchimento automático"})]})}),t.jsx(W,{className:X,children:t.jsxs("div",{className:"grid gap-4 md:grid-cols-[1fr_auto]",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(w,{children:"ID AniList"}),t.jsx(y,{value:re,onChange:e=>at(e.target.value),placeholder:"Ex.: 21366"})]}),t.jsx(N,{className:"self-end",onClick:ar,children:"Importar do AniList"})]})})]}),t.jsxs(G,{value:"dados-principais",className:Y,children:[t.jsx(q,{className:J,children:t.jsxs("div",{className:"flex w-full items-center justify-between gap-4 text-left",children:[t.jsx("span",{children:"Dados principais"}),t.jsx("span",{className:"text-xs text-muted-foreground",children:o.title||"ID e títulos"})]})}),t.jsx(W,{className:X,children:t.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(w,{children:"ID do projeto"}),t.jsx(y,{value:o.id,onChange:e=>{const s=e.target.value,r=!!o.anilistId||Number.isFinite(Number(re)),a=s.trim();!r&&a&&/^\d+$/.test(a)||p(n=>({...n,id:s}))},placeholder:"Mesmo ID do AniList ou slug manual"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(w,{children:"Título"}),t.jsx(y,{value:o.title,onChange:e=>p(s=>({...s,title:e.target.value}))})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(w,{children:"Título original"}),t.jsx(y,{value:o.titleOriginal,onChange:e=>p(s=>({...s,titleOriginal:e.target.value}))})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(w,{children:"Título em inglês"}),t.jsx(y,{value:o.titleEnglish,onChange:e=>p(s=>({...s,titleEnglish:e.target.value}))})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(w,{children:"Forçar no carrossel"}),t.jsxs("div",{className:"flex items-center justify-between gap-4 rounded-2xl border border-border/60 bg-card/60 px-4 py-3",children:[t.jsx("span",{className:"text-sm text-muted-foreground",children:"Exibe no carrossel da home mesmo sem lançamento recente."}),t.jsx(Tr,{checked:!!o.forceHero,onCheckedChange:e=>p(s=>({...s,forceHero:e}))})]})]}),t.jsxs("div",{className:"space-y-2 md:col-span-2",children:[t.jsx(w,{children:"Sinopse"}),t.jsx($r,{value:o.synopsis,onChange:e=>p(s=>({...s,synopsis:e.target.value})),rows:6})]})]})})]}),t.jsxs(G,{value:"midias",className:Y,children:[t.jsx(q,{className:J,children:t.jsxs("div",{className:"flex w-full items-center justify-between gap-4 text-left",children:[t.jsx("span",{children:"Mídias"}),t.jsxs("span",{className:"text-xs text-muted-foreground",children:[[o.heroImageUrl,o.cover,o.banner].filter(Boolean).length,"/3 selecionadas"]})]})}),t.jsx(W,{className:X,children:t.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(w,{children:"Imagem do carrossel"}),t.jsxs("div",{className:"flex items-center gap-3 rounded-2xl border border-border/60 bg-card/60 px-3 py-2",children:[o.heroImageUrl?t.jsx("img",{src:o.heroImageUrl,alt:"Imagem do carrossel",className:"h-12 w-12 rounded-lg object-cover"}):t.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-lg border border-dashed border-border/60 text-center text-[10px] text-muted-foreground leading-tight",children:"Sem imagem"}),t.jsx(N,{type:"button",variant:"outline",size:"sm",className:"ml-auto",onClick:()=>wt("hero"),children:"Biblioteca"})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(w,{children:"Capa"}),t.jsxs("div",{className:"flex items-center gap-3 rounded-2xl border border-border/60 bg-card/60 px-3 py-2",children:[o.cover?t.jsx("img",{src:o.cover,alt:"Capa",className:"h-12 w-12 rounded-lg object-cover"}):t.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-lg border border-dashed border-border/60 text-center text-[10px] text-muted-foreground leading-tight",children:"Sem imagem"}),t.jsx(N,{type:"button",variant:"outline",size:"sm",className:"ml-auto",onClick:()=>wt("cover"),children:"Biblioteca"})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(w,{children:"Banner"}),t.jsxs("div",{className:"flex items-center gap-3 rounded-2xl border border-border/60 bg-card/60 px-3 py-2",children:[o.banner?t.jsx("img",{src:o.banner,alt:"Banner",className:"h-12 w-12 rounded-lg object-cover"}):t.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-lg border border-dashed border-border/60 text-center text-[10px] text-muted-foreground leading-tight",children:"Sem imagem"}),t.jsx(N,{type:"button",variant:"outline",size:"sm",className:"ml-auto",onClick:()=>wt("banner"),children:"Biblioteca"})]})]})]})})]}),t.jsxs(G,{value:"metadados",className:Y,children:[t.jsx(q,{className:J,children:t.jsxs("div",{className:"flex w-full items-center justify-between gap-4 text-left",children:[t.jsx("span",{children:"Metadados"}),t.jsxs("span",{className:"text-xs text-muted-foreground",children:[o.type||"Formato"," • ",o.status||"Status"]})]})}),t.jsx(W,{className:X,children:t.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(w,{children:"Formato"}),t.jsxs(je,{value:o.type,onValueChange:e=>p(s=>({...s,type:e})),children:[t.jsx(be,{children:t.jsx(ve,{placeholder:"Formato"})}),t.jsx(Ne,{children:Kr.map(e=>t.jsx(O,{value:e,children:e},e))})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(w,{children:"Status"}),t.jsxs(je,{value:o.status,onValueChange:e=>p(s=>({...s,status:e})),children:[t.jsx(be,{children:t.jsx(ve,{placeholder:"Status"})}),t.jsx(Ne,{children:ea.map(e=>t.jsx(O,{value:e,children:e},e))})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(w,{children:"Ano"}),t.jsx(y,{value:o.year,onChange:e=>p(s=>({...s,year:e.target.value}))})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(w,{children:"Temporada"}),t.jsx(y,{value:o.season,onChange:e=>p(s=>({...s,season:e.target.value}))})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(w,{children:"Estúdio"}),t.jsx(y,{value:o.studio,onChange:e=>p(s=>({...s,studio:e.target.value}))})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(w,{children:"Episódios/Capítulos"}),t.jsx(y,{value:o.episodes,onChange:e=>p(s=>({...s,episodes:e.target.value}))})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(w,{children:"País de origem"}),t.jsx(y,{value:o.country,onChange:e=>p(s=>({...s,country:e.target.value}))})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(w,{children:"Fonte"}),t.jsx(y,{value:o.source,onChange:e=>p(s=>({...s,source:e.target.value}))})]})]})})]}),t.jsxs(G,{value:"classificacao",className:Y,children:[t.jsx(q,{className:J,children:t.jsxs("div",{className:"flex w-full items-center justify-between gap-4 text-left",children:[t.jsx("span",{children:"Classificação"}),t.jsxs("span",{className:"text-xs text-muted-foreground",children:[o.tags.length," tags • ",o.genres.length," gêneros"]})]})}),t.jsx(W,{className:X,children:t.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(w,{children:"Tags"}),t.jsx("div",{className:"flex flex-wrap items-center gap-2",children:t.jsx(y,{value:Be,onChange:e=>Oe(e.target.value),onKeyDown:e=>{e.key==="Enter"&&(e.preventDefault(),nr())},placeholder:"Adicionar tag"})}),as.length>0?t.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:as.map(e=>t.jsx(N,{type:"button",size:"sm",variant:"ghost",className:"h-7 px-2 text-xs",onClick:()=>{Oe(e),p(s=>({...s,tags:s.tags.includes(e)?s.tags:[...s.tags,e]})),Oe("")},children:e},`tag-suggestion-${e}`))}):null,t.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:_s.map((e,s)=>t.jsx(k,{variant:"secondary",onClick:()=>ir(e),className:"cursor-pointer",children:ye(e,oe)},`${e}-${s}`))})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(w,{children:"Gêneros"}),t.jsx("div",{className:"flex flex-wrap items-center gap-2",children:t.jsx(y,{value:ze,onChange:e=>Ue(e.target.value),onKeyDown:e=>{e.key==="Enter"&&(e.preventDefault(),or())},placeholder:"Adicionar gênero"})}),ns.length>0?t.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:ns.map(e=>t.jsx(N,{type:"button",size:"sm",variant:"ghost",className:"h-7 px-2 text-xs",onClick:()=>{Ue(e),p(s=>({...s,genres:s.genres.includes(e)?s.genres:[...s.genres,e]})),Ue("")},children:e},`genre-suggestion-${e}`))}):null,t.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:Vs.map((e,s)=>t.jsx(k,{variant:"secondary",onClick:()=>lr(e),className:"cursor-pointer",children:tt(e,Ce)},`${e}-${s}`))})]})]})})]}),t.jsxs(G,{value:"relacoes",className:Y,children:[t.jsx(q,{className:J,children:t.jsxs("div",{className:"flex w-full items-center justify-between gap-4 text-left",children:[t.jsx("span",{children:"Relações"}),t.jsxs("span",{className:"text-xs text-muted-foreground",children:[o.relations.length," itens"]})]})}),t.jsx(W,{className:X,children:t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"flex items-center justify-end",children:t.jsx(N,{type:"button",size:"sm",variant:"outline",onClick:()=>p(e=>({...e,relations:[...e.relations,{relation:"",title:"",format:"",status:"",image:""}]})),children:"Adicionar relação"})}),t.jsx("div",{className:"grid gap-3",children:o.relations.map((e,s)=>t.jsxs("div",{className:"grid gap-2 rounded-2xl border border-border/60 bg-card/60 p-3 md:grid-cols-[1.35fr_1fr_1fr_auto]",draggable:!0,onDragStart:()=>ot(s),onDragOver:r=>r.preventDefault(),onDrop:()=>cr(s),children:[t.jsx(y,{value:e.title,onChange:r=>p(a=>{const n=[...a.relations];return n[s]={...n[s],title:r.target.value},{...a,relations:n}}),placeholder:"Título"}),t.jsx(y,{value:e.relation,onChange:r=>p(a=>{const n=[...a.relations];return n[s]={...n[s],relation:r.target.value},{...a,relations:n}}),placeholder:"Relação"}),t.jsx(y,{value:e.projectId||e.anilistId||"",onChange:r=>p(a=>{const n=[...a.relations];return n[s]={...n[s],projectId:r.target.value},{...a,relations:n}}),placeholder:"ID relacionado"}),t.jsx(N,{type:"button",variant:"ghost",onClick:()=>p(r=>({...r,relations:r.relations.filter((a,n)=>n!==s)})),children:"Remover"})]},`${e.title}-${s}`))})]})})]}),t.jsxs(G,{value:"equipe",className:Y,children:[t.jsx(q,{className:J,children:t.jsxs("div",{className:"flex w-full items-center justify-between gap-4 text-left",children:[t.jsx("span",{children:"Equipe da fansub"}),t.jsxs("span",{className:"text-xs text-muted-foreground",children:[o.staff.length," funções"]})]})}),t.jsx(W,{className:X,children:t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"flex items-center justify-end",children:t.jsx(N,{type:"button",size:"sm",variant:"outline",onClick:()=>p(e=>({...e,staff:[...e.staff,{role:"",members:[]}]})),children:"Adicionar função"})}),t.jsx("div",{className:"grid gap-3",children:o.staff.map((e,s)=>t.jsxs("div",{className:"rounded-2xl border border-border/60 bg-card/60 p-3",draggable:!0,onDragStart:()=>lt(s),onDragOver:r=>r.preventDefault(),onDrop:()=>dr(s),children:[t.jsxs("div",{className:"grid gap-3 md:grid-cols-[1fr_auto]",children:[t.jsxs(je,{value:e.role||"",onValueChange:r=>p(a=>{const n=[...a.staff];return n[s]={...n[s],role:r},{...a,staff:n}}),children:[t.jsx(be,{children:t.jsx(ve,{placeholder:"Função"})}),t.jsx(Ne,{children:(e.role&&!Nt.includes(e.role)?[e.role,...Nt]:Nt).map(r=>t.jsx(O,{value:r,children:r},r))})]}),t.jsx(N,{type:"button",variant:"ghost",onClick:()=>p(r=>({...r,staff:r.staff.filter((a,n)=>n!==s)})),children:"Remover"})]}),t.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[t.jsx(y,{list:"staff-directory",value:ut[s]||"",onChange:r=>$s(a=>({...a,[s]:r.target.value})),placeholder:"Adicionar membro"}),t.jsx(N,{type:"button",variant:"outline",onClick:()=>p(r=>{const a=[...r.staff],n=(ut[s]||"").trim();if(!n)return r;const l=a[s].members||[];return a[s]={...a[s],members:l.includes(n)?l:[...l,n]},{...r,staff:a}}),children:"Adicionar"})]}),t.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:(e.members||[]).map(r=>t.jsx(k,{variant:"secondary",children:r},r))})]},`${e.role}-${s}`))})]})})]}),t.jsxs(G,{value:"staff-anime",className:Y,children:[t.jsx(q,{className:J,children:t.jsxs("div",{className:"flex w-full items-center justify-between gap-4 text-left",children:[t.jsx("span",{children:"Staff do anime"}),t.jsxs("span",{className:"text-xs text-muted-foreground",children:[o.animeStaff.length," funções"]})]})}),t.jsx(W,{className:X,children:t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"flex items-center justify-end",children:t.jsx(N,{type:"button",size:"sm",variant:"outline",onClick:()=>p(e=>({...e,animeStaff:[...e.animeStaff,{role:"",members:[]}]})),children:"Adicionar função"})}),t.jsx("div",{className:"grid gap-3",children:o.animeStaff.map((e,s)=>t.jsxs("div",{className:"rounded-2xl border border-border/60 bg-card/60 p-3",draggable:!0,onDragStart:()=>dt(s),onDragOver:r=>r.preventDefault(),onDrop:()=>ur(s),children:[t.jsxs("div",{className:"grid gap-3 md:grid-cols-[1fr_auto]",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsx(y,{value:e.role||"",onChange:r=>p(a=>{const n=[...a.animeStaff];return n[s]={...n[s],role:r.target.value},{...a,animeStaff:n}}),placeholder:"Função"}),String(e.role||"").trim()?t.jsx("p",{className:"text-[11px] text-muted-foreground",children:Or(e.role,Us)}):null]}),t.jsx(N,{type:"button",variant:"ghost",onClick:()=>{p(r=>({...r,animeStaff:r.animeStaff.filter((a,n)=>n!==s)})),ge(r=>Pe(r,s))},children:"Remover"})]}),t.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[t.jsx(y,{list:"staff-directory",value:Qt[s]||"",onChange:r=>ge(a=>({...a,[s]:r.target.value})),placeholder:"Adicionar membro"}),t.jsx(N,{type:"button",variant:"outline",onClick:()=>{const r=(Qt[s]||"").trim();r&&(p(a=>{const n=[...a.animeStaff],l=n[s].members||[];return n[s]={...n[s],members:l.includes(r)?l:[...l,r]},{...a,animeStaff:n}}),ge(a=>({...a,[s]:""})))},children:"Adicionar"})]}),t.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:(e.members||[]).map(r=>t.jsxs(k,{variant:"secondary",className:"flex items-center gap-1",children:[t.jsx("span",{children:r}),t.jsx("button",{type:"button",className:"rounded-sm p-0.5 text-muted-foreground transition hover:text-foreground",onClick:()=>p(a=>{const n=[...a.animeStaff];return n[s]={...n[s],members:(n[s].members||[]).filter(l=>l!==r)},{...a,animeStaff:n}}),"aria-label":`Remover ${r}`,children:"x"})]},r))})]},`${e.role}-${s}`))})]})})]}),t.jsxs(G,{value:"episodios",className:Y,children:[t.jsx(q,{className:J,children:t.jsxs("div",{className:"flex w-full items-center justify-between gap-4 text-left",children:[t.jsx("span",{children:I?"Capítulos":"Episódios"}),t.jsxs("span",{className:"text-xs text-muted-foreground",children:[o.episodeDownloads.length," ",I?"capítulos":"episódios"]})]})}),t.jsx(W,{className:X,children:t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"flex items-center justify-end",children:t.jsx(N,{type:"button",size:"sm",variant:"outline",onClick:()=>p(e=>{const s={number:e.episodeDownloads.length+1,volume:void 0,title:"",releaseDate:"",duration:"",coverImageUrl:"",sourceType:"TV",sources:[],progressStage:"aguardando-raw",completedStages:[],content:"",contentFormat:"lexical"},r=[...e.episodeDownloads,s];return{...e,episodeDownloads:r}}),children:I?"Adicionar capítulo":"Adicionar episódio"})}),t.jsx(ms,{type:"multiple",value:Gs,onValueChange:qs,className:"space-y-4",children:ee.map(({episode:e,index:s})=>{const r=pt[s]??!1;return t.jsx(G,{value:Ot(s),className:"border-none",children:t.jsx(It,{className:"project-editor-episode-card border-border/60 bg-card/70","data-testid":`episode-card-${s}`,onDragStart:()=>ks(null),children:t.jsxs(At,{className:`project-editor-episode-content space-y-3 ${r?"p-4":"p-5"}`,children:[t.jsxs("div",{className:"project-editor-episode-header flex flex-wrap items-start justify-between gap-2","data-testid":`episode-header-${s}`,onClick:a=>Ws(s,a),children:[t.jsx("div",{className:"min-w-0 flex-1",children:t.jsx(q,{"data-episode-accordion-trigger":!0,className:"project-editor-episode-trigger py-0 text-left text-base font-semibold text-foreground hover:no-underline [&>svg]:mt-0.5 [&>svg]:shrink-0",children:t.jsxs("div",{className:"flex min-w-0 items-center gap-2",children:[t.jsxs("span",{className:"rounded-full border border-border/60 bg-background/70 px-2 py-0.5 text-xs",children:[I?"Cap":"Ep"," ",e.number||s+1]}),e.title?t.jsx("span",{className:"line-clamp-1",children:e.title}):null,e.releaseDate?t.jsx("span",{className:"rounded-full border border-border/60 bg-background/50 px-2 py-0.5 text-[10px] leading-none",children:oa(e.releaseDate,e.duration)}):null]})})}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[r?t.jsxs("div",{className:"flex flex-wrap items-center gap-1",children:[He&&String(e.content||"").trim().length>0?t.jsx("span",{className:"rounded-full border border-primary/40 bg-primary/10 px-2 py-0.5 text-[10px] text-primary leading-none",children:"Conteúdo"}):null,!I&&!e.sources.some(a=>a.url)?t.jsx("span",{className:"rounded-full border border-border/60 bg-background/50 px-2 py-0.5 text-[10px] leading-none",children:yt.find(a=>a.id===Bt(o.type||"",e.completedStages))?.label||"Aguardando Raw"}):null,e.sources.some(a=>a.url)?t.jsx("span",{className:"rounded-full border border-emerald-500/40 bg-emerald-500/10 px-2 py-0.5 text-[10px] text-emerald-400 leading-none",children:"Download"}):null]}):null,t.jsx(N,{type:"button",size:"sm",variant:"ghost",className:"h-7 px-2 text-[11px] text-destructive hover:text-destructive","data-no-toggle":!0,onClick:()=>{p(a=>({...a,episodeDownloads:a.episodeDownloads.filter((n,l)=>l!==s)})),we(a=>Pe(a,s)),De(a=>Pe(a,s)),V(a=>Pe(a,s)),H(a=>Pe(a,s)),fe(a=>ia(a,s))},children:I?"Remover capítulo":"Remover episódio"})]})]}),t.jsxs(W,{className:"project-editor-episode-panel pt-3 pb-0 px-1",children:[t.jsxs("div",{className:"project-editor-episode-group project-editor-episode-basics grid gap-3 md:grid-cols-[minmax(84px,0.7fr)_minmax(84px,0.7fr)_minmax(180px,1.4fr)_minmax(150px,1fr)_minmax(110px,0.8fr)_minmax(130px,0.9fr)]",children:[t.jsx(y,{type:"number",value:e.number,onChange:a=>p(n=>{const l=[...n.episodeDownloads];return l[s]={...l[s],number:Number(a.target.value)},{...n,episodeDownloads:l}}),placeholder:"Número"}),Hs?t.jsx(y,{type:"number",value:e.volume||"",onChange:a=>p(n=>{const l=[...n.episodeDownloads];return l[s]={...l[s],volume:a.target.value?Number(a.target.value):void 0},{...n,episodeDownloads:l}}),placeholder:"Volume"}):null,t.jsx(y,{value:e.title,onChange:a=>p(n=>{const l=[...n.episodeDownloads];return l[s]={...l[s],title:a.target.value},{...n,episodeDownloads:l}}),placeholder:"Título"}),t.jsx(y,{type:"text",inputMode:"numeric",value:Ts[s]??ra(e.releaseDate),onChange:a=>{const n=js(a.target.value),l=se(n);if(we(m=>({...m,[s]:n})),l.length===8){const m=st(n);m&&p(d=>{const u=[...d.episodeDownloads];return u[s]={...u[s],releaseDate:m},{...d,episodeDownloads:u}})}else l.length===0&&p(m=>{const d=[...m.episodeDownloads];return d[s]={...d[s],releaseDate:""},{...m,episodeDownloads:d}})},onBlur:a=>{const n=js(a.target.value),l=se(n);if(l.length===8){const m=st(n);m&&p(d=>{const u=[...d.episodeDownloads];return u[s]={...u[s],releaseDate:m},{...d,episodeDownloads:u}})}else l.length===0&&p(m=>{const d=[...m.episodeDownloads];return d[s]={...d[s],releaseDate:""},{...m,episodeDownloads:d}});we(m=>{const d={...m};return delete d[s],d})},placeholder:"DD/MM/AAAA",className:"md:min-w-[150px]"}),I?null:t.jsx(y,{type:"text",inputMode:"numeric",value:Ps[s]??Ds(e.duration),onChange:a=>{const n=bs(a.target.value),l=se(n);De(d=>({...d,[s]:n}));const m=rt(n);m?p(d=>{const u=[...d.episodeDownloads];return u[s]={...u[s],duration:m},{...d,episodeDownloads:u}}):l.length===0&&p(d=>{const u=[...d.episodeDownloads];return u[s]={...u[s],duration:""},{...d,episodeDownloads:u}})},onBlur:a=>{const n=bs(a.target.value),l=se(n),m=rt(n);m?p(d=>{const u=[...d.episodeDownloads];return u[s]={...u[s],duration:m},{...d,episodeDownloads:u}}):l.length===0&&p(d=>{const u=[...d.episodeDownloads];return u[s]={...u[s],duration:""},{...d,episodeDownloads:u}}),De(d=>{const u={...d};return delete u[s],u})},placeholder:"MM:SS ou H:MM:SS",className:"md:min-w-[150px]"}),I?null:t.jsxs(je,{value:e.sourceType,onValueChange:a=>p(n=>{const l=[...n.episodeDownloads];return l[s]={...l[s],sourceType:a},{...n,episodeDownloads:l}}),children:[t.jsx(be,{children:t.jsx(ve,{placeholder:"Origem"})}),t.jsxs(Ne,{children:[t.jsx(O,{value:"TV",children:"TV"}),t.jsx(O,{value:"Web",children:"Web"}),t.jsx(O,{value:"Blu-ray",children:"Blu-ray"})]})]})]}),!e.sources.some(a=>a.url)&&!I?t.jsxs("div",{className:"project-editor-episode-group mt-3 space-y-2",children:[t.jsx(w,{className:"text-xs",children:"Etapa atual"}),t.jsx("div",{className:"rounded-md border border-border/60 bg-background/70 px-3 py-2 text-xs text-muted-foreground",children:yt.find(a=>a.id===Bt(o.type||"",e.completedStages))?.label||"Aguardando Raw"})]}):null,t.jsxs("div",{className:"project-editor-episode-group mt-3 space-y-2",children:[t.jsx(w,{className:"text-xs",children:I?"Capa do capítulo":"Capa do episódio"}),t.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.coverImageUrl?t.jsx("div",{className:"flex items-center gap-3 rounded-2xl border border-border/60 bg-card/60 px-3 py-2",children:t.jsx("img",{src:e.coverImageUrl,alt:e.title||"Capa",className:"h-12 w-12 rounded-lg object-cover"})}):t.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-lg border border-dashed border-border/60 text-center text-[10px] text-muted-foreground leading-tight",children:"Sem imagem"}),t.jsx(N,{type:"button",size:"sm",variant:"outline",onClick:()=>Ys(s),children:"Biblioteca"})]})]}),He?t.jsxs("div",{className:"project-editor-episode-group mt-4",children:[t.jsx(w,{className:"text-xs",children:"Conteúdo do capítulo"}),t.jsx("div",{className:"mt-3",onFocusCapture:a=>{if(a.target?.closest(".lexical-playground"))return;Jt.current[s]?.blur?.()},children:t.jsx(ma,{value:e.content||"",imageLibraryOptions:St,onRegister:a=>{Jt.current[s]=a},onChange:a=>p(n=>{const l=[...n.episodeDownloads];return l[s]={...l[s],content:a},{...n,episodeDownloads:l}})})})]}):null,!e.sources.some(a=>a.url)&&!I?t.jsxs("div",{className:"project-editor-episode-group mt-3",children:[t.jsx(w,{className:"text-xs",children:"Etapas concluídas"}),t.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:yt.map(a=>{const n=(e.completedStages||[]).includes(a.id);return t.jsx(N,{type:"button",size:"sm",variant:n?"default":"outline",onClick:()=>p(l=>{const m=[...l.episodeDownloads],d=m[s].completedStages||[];return m[s]={...m[s],completedStages:n?d.filter(u=>u!==a.id):[...d,a.id]},{...l,episodeDownloads:m}}),children:a.label},a.id)})})]}):null,He?null:t.jsxs("div",{className:"project-editor-episode-group mt-3 space-y-3",children:[t.jsxs("div",{children:[t.jsx(w,{className:"text-xs",children:"Arquivo do episódio"}),t.jsxs("div",{className:"mt-2 grid gap-2 md:grid-cols-2",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsx(y,{ref:a=>{xe.current[s]=a},value:_e[s]??(e.sizeBytes?Vr(e.sizeBytes):""),onChange:a=>{const n=a.target.value;V(l=>({...l,[s]:n})),H(l=>{if(!l[s])return l;const m={...l};return delete m[s],m})},onBlur:a=>{const n=_e[s]??a.target.value,l=String(n||"").trim();if(!l){p(d=>{const u=[...d.episodeDownloads];return u[s]={...u[s],sizeBytes:void 0},{...d,episodeDownloads:u}}),V(d=>{const u={...d};return delete u[s],u}),H(d=>{const u={...d};return delete u[s],u});return}const m=ps(l);if(!m){H(d=>({...d,[s]:"Use formatos como 700 MB ou 1.4 GB."})),V(d=>({...d,[s]:n}));return}p(d=>{const u=[...d.episodeDownloads];return u[s]={...u[s],sizeBytes:m},{...d,episodeDownloads:u}}),V(d=>{const u={...d};return delete u[s],u}),H(d=>{const u={...d};return delete u[s],u})},placeholder:"Tamanho (ex.: 700 MB ou 1.4 GB)"}),mt[s]?t.jsx("p",{className:"text-[11px] text-destructive",children:mt[s]}):t.jsx("p",{className:"text-[11px] text-muted-foreground",children:"Campo opcional. Valor salvo em bytes."})]}),t.jsx(y,{value:e.hash||"",onChange:a=>p(n=>{const l=[...n.episodeDownloads];return l[s]={...l[s],hash:a.target.value},{...n,episodeDownloads:l}}),placeholder:"Hash (ex.: SHA-256: ...)"})]})]}),t.jsxs("div",{children:[t.jsx(w,{className:"text-xs",children:"Fontes de download"}),t.jsxs("div",{className:"mt-2 grid gap-2",children:[(e.sources||[]).map((a,n)=>t.jsx("div",{className:"rounded-xl border border-border/60 bg-background/40 p-3",children:t.jsxs("div",{className:"grid items-start gap-2 md:grid-cols-[minmax(180px,1fr)_minmax(240px,2fr)_auto]",children:[t.jsxs(je,{value:a.label,onValueChange:l=>p(m=>{const d=[...m.episodeDownloads],u=[...d[s].sources||[]];return u[n]={...u[n],label:l},d[s]={...d[s],sources:u},{...m,episodeDownloads:d}}),children:[t.jsx(be,{children:t.jsx(ve,{placeholder:"Fonte"})}),t.jsx(Ne,{children:Is.map(l=>t.jsx(O,{value:l.label,children:t.jsxs("span",{className:"flex items-center gap-2",children:[As(l.icon,l.color,l.label,l.tintIcon),t.jsx("span",{children:l.label})]})},l.label))})]}),t.jsx(y,{value:a.url,onChange:l=>p(m=>{const d=[...m.episodeDownloads],u=[...d[s].sources||[]];return u[n]={...u[n],url:l.target.value},d[s]={...d[s],sources:u},{...m,episodeDownloads:d}}),placeholder:"URL"}),t.jsx(N,{type:"button",variant:"ghost",size:"icon",className:"h-9 w-9",onClick:()=>{p(l=>{const m=[...l.episodeDownloads],d=(m[s].sources||[]).filter((u,ie)=>ie!==n);return m[s]={...m[s],sources:d},{...l,episodeDownloads:m}})},children:t.jsx(gs,{className:"h-4 w-4"})})]})},`${a.label}-${n}`)),t.jsx(N,{type:"button",size:"sm",variant:"outline",onClick:()=>p(a=>{const n=[...a.episodeDownloads],l=n[s].sources||[];return n[s]={...n[s],sources:[...l,{label:"",url:""}]},{...a,episodeDownloads:n}}),children:"Adicionar fonte"})]})]})]})]})]})})},`${e.number}-${s}`)})})]})})]})]}),t.jsx("datalist",{id:"staff-directory",children:Ms.map(e=>t.jsx("option",{value:e},e))})]}),t.jsxs("div",{className:"project-editor-footer sticky bottom-0 z-20 flex justify-end gap-3 border-t border-border/60 bg-background/95 px-4 py-3 backdrop-blur-sm supports-backdrop-filter:bg-background/80 md:px-6 md:py-4",children:[t.jsx(N,{variant:"ghost",onClick:Ks,children:"Cancelar"}),t.jsx(N,{onClick:er,children:"Salvar projeto"})]})]})}),t.jsx(kt,{open:Rs,onOpenChange:ne,children:t.jsxs($t,{className:"max-w-md",children:[t.jsxs(Tt,{children:[t.jsx(Pt,{children:Bs}),t.jsx(Mt,{children:Os})]}),t.jsxs("div",{className:"flex justify-end gap-3",children:[t.jsx(N,{variant:"ghost",onClick:()=>{jt.current?.(),ne(!1)},children:"Continuar editando"}),t.jsx(N,{variant:"destructive",onClick:()=>{xt.current?.(),ne(!1)},children:"Sair"})]})]})}),t.jsx(kt,{open:!!pe,onOpenChange:e=>{e||Re(null)},children:t.jsxs($t,{className:"max-w-md",children:[t.jsxs(Tt,{children:[t.jsx(Pt,{children:"Excluir projeto?"}),t.jsx(Mt,{children:pe?`Excluir "${pe.title}"? Você pode restaurar por até 3 dias.`:""})]}),t.jsxs("div",{className:"flex justify-end gap-3",children:[t.jsx(N,{variant:"ghost",onClick:()=>Re(null),children:"Cancelar"}),t.jsx(N,{variant:"destructive",onClick:tr,children:"Excluir"})]})]})}),t.jsx(c.Suspense,{fallback:null,children:t.jsx(Xr,{open:he,onOpenChange:ft,apiBase:i,description:"Envie novas imagens ou selecione uma existente para usar no projeto.",uploadFolder:Ae.uploadFolder,listFolders:Ae.listFolders,listAll:Ae.listAll,includeProjectImages:Ae.includeProjectImages,projectImageProjectIds:Ae.projectImageProjectIds,allowDeselect:!0,mode:"single",currentSelectionUrls:ds?[ds]:[],onSave:({urls:e})=>Qs(e[0]||"")})})]})};export{jn as default};
