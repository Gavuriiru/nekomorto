import{r as t,u as H,j as s,L as i,O as ce}from"./react-core-BcR2_z_l.js";import{B as de}from"./badge-CX6RuieY.js";import{A as me,a as ue,b as pe}from"./avatar-CVZSwVae.js";import{B as E}from"./button-C7iHbTqw.js";import{r as he,a as xe,D as F,b as z,M as fe,c as W,g as be,e as S,f as ge,L as ve,d as je,i as we}from"./Footer-C9y59CM9.js";import{t as _}from"./use-toast-DeMRPCeJ.js";import{T as ye}from"./ThemedSvgLogo-CGFMwyp6.js";import{g as Ne,b as ke,u as Se,c as u,d as q}from"./index-ntR5v_s2.js";import{s as Me,a as Le,r as Ce,b as Ie}from"./search-ranking-cq4don08.js";import{u as Pe}from"./use-dynamic-synopsis-clamp-DpjBDBPb.js";import{r as $e,b as Ae}from"./access-control-C6qZ0ZhA.js";import{s as Ue}from"./url-safety-Py24cS-5.js";import"./index-CwaKb5FF.js";import"./mui-WkDK9qS1.js";import"./createLucideIcon-M1JG7EBz.js";import"./index-Xj-Q384k.js";import"./shield-DlmGTLiS.js";import"./index-BMIt2_cw.js";import"./index-DZ2Ey5_7.js";import"./index-CHWtszJ3.js";import"./chevron-right-CrdESc7p.js";import"./check-Cyy403AY.js";import"./users-ok7q4J4c.js";import"./info-BTb-jBiG.js";import"./book-open-CG_mViAI.js";import"./ThemedSvgMaskIcon-B_IYD_H5.js";import"./globe-CRGpuS2E.js";import"./message-circle-qqsIJunn.js";import"./x-BpqL4Bns.js";const Be=({variant:p="fixed",leading:f,className:K})=>{const[o,M]=t.useState(!1),[n,L]=t.useState(""),[G,Q]=t.useState(!1),[b,C]=t.useState(!1),[a,g]=t.useState(null),v=t.useRef(null),V=H(),j=Ne(),{settings:c}=ke(),{data:w}=Se(),I=w?.projects||[],P=w?.posts||[],$=w?.tagTranslations?.tags||{},d=(c.site.name||"Nekomata").toUpperCase(),h=he(c),Y=h.navbar.wordmarkUrl,A=h.navbar.symbolUrl,x=h.navbar.mode,J=h.navbar.showWordmark,X=x==="symbol-text"||x==="symbol",Z=x==="symbol-text"||x==="text",U=t.useMemo(()=>Array.isArray(c.navbar.links)?c.navbar.links.map(e=>({label:String(e?.label||"").trim(),href:Ue(e?.href)||"",icon:String(e?.icon||"").trim()})).filter(e=>e.label&&e.href):[],[c.navbar.links]),B="border-border/70 bg-popover/95 text-popover-foreground shadow-xl backdrop-blur-xs",y="focus:bg-accent focus:text-accent-foreground",N=e=>e.startsWith("/")&&!e.startsWith("//"),T=e=>(e.split(/[?#]/,1)[0]||"/").replace(/\/+$/,"")||"/",ee=e=>{if(!N(e))return!1;const r=T(V.pathname),l=T(e);return l==="/"?r==="/":r===l||r.startsWith(`${l}/`)},R=t.useMemo(()=>I.map(e=>({label:e.title,href:`/projeto/${e.id}`,image:e.cover,synopsis:e.synopsis,tags:Me(Le(e.tags.map(r=>$[r]||r)),2,18)})),[I,$]),O=t.useMemo(()=>P.map(e=>({label:e.title,href:`/postagem/${e.slug}`,excerpt:e.excerpt||""})),[P]),m=t.useMemo(()=>n.trim()?Ce(R,n):[],[R,n]),k=t.useMemo(()=>n.trim()?Ie(O,n):[],[O,n]),D=o&&n.trim().length>0,se=m.length>0||k.length>0,re=t.useMemo(()=>m.map(e=>e.href),[m]),{rootRef:te,lineByKey:ae}=Pe({enabled:D,keys:re,maxLines:4}),oe=e=>{const r=ae[e]??2;return r<=0?"hidden":r===1?"line-clamp-1":r===2?"line-clamp-2":r===3?"line-clamp-3":"line-clamp-4"};t.useEffect(()=>{const e=r=>{v.current&&!v.current.contains(r.target)&&(M(!1),L(""))};return o&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[o]),t.useEffect(()=>{const e=()=>{Q(window.scrollY>12)};return e(),window.addEventListener("scroll",e,{passive:!0}),()=>{window.removeEventListener("scroll",e)}},[]),t.useEffect(()=>{(async()=>{try{const r=await q(j,"/api/public/me",{auth:!0});if(!r.ok){g(null);return}const l=await r.json();g(l?.user??null)}catch{g(null)}})()},[j]);const ne=t.useMemo(()=>{if(!a)return[];const e=$e(a);return Ae(je,e)},[a]),le=async()=>{if(!b){C(!0);try{if(!(await q(j,"/api/logout",{method:"POST",auth:!0})).ok){_({title:"Não foi possível sair",description:"Tente novamente em alguns instantes.",variant:"destructive"});return}window.location.href="/"}catch{_({title:"Não foi possível sair",description:"Ocorreu um erro inesperado ao encerrar a sessão.",variant:"destructive"})}finally{C(!1)}}};return s.jsx("header",{className:u("left-0 right-0 px-6 py-4 text-foreground transition-all duration-300 md:px-12 after:pointer-events-none after:absolute after:inset-0 after:bg-linear-to-b after:from-background/70 after:via-background/25 after:to-transparent",p==="fixed"?"fixed top-0":"relative",G&&p==="fixed"?"bg-background/70 backdrop-blur-xl":"bg-transparent",f?"z-10":"z-50",f?"md:pl-(--sidebar-offset)":"",K),children:s.jsxs("nav",{className:"relative flex items-center justify-between gap-3",children:[s.jsxs("div",{"data-testid":"public-header-left-cluster",className:u("flex min-w-0 items-center gap-3 transition-all duration-300",o?"opacity-0 invisible pointer-events-none md:opacity-100 md:visible md:pointer-events-auto":"opacity-100 visible pointer-events-auto"),children:[f,s.jsx(i,{to:"/",className:"flex items-center gap-3 text-2xl md:text-3xl font-black tracking-wider text-foreground",children:J?s.jsxs(s.Fragment,{children:[s.jsx("img",{src:Y,alt:d,className:"h-8 md:h-10 w-auto max-w-[200px] md:max-w-[260px] object-contain"}),s.jsx("span",{className:"sr-only",children:d})]}):s.jsxs(s.Fragment,{children:[X?A?s.jsx(ye,{url:A,label:d,className:"h-9 w-9 rounded-full object-cover shadow-xs text-primary"}):s.jsx("span",{className:"inline-flex h-9 w-9 items-center justify-center rounded-full border border-border/70 bg-card/70 text-sm font-semibold",children:d.slice(0,1)}):null,Z?s.jsx("span",{children:d}):null]})})]}),s.jsxs("div",{className:"flex shrink-0 items-center gap-3 md:gap-6",children:[s.jsx("div",{className:"hidden lg:flex items-center gap-6 text-sm font-medium text-foreground/80",children:U.map(e=>{const r=N(e.href),ie=`transition-colors ${ee(e.href)?"text-foreground font-semibold":"text-foreground/80 hover:text-foreground"}`;return r?s.jsx(i,{to:e.href,className:ie,children:e.label},`${e.label}-${e.href}`):s.jsx("a",{href:e.href,className:"text-foreground/80 hover:text-foreground transition-colors",target:"_blank",rel:"noopener noreferrer",children:e.label},`${e.label}-${e.href}`)})}),s.jsxs("div",{ref:v,"data-testid":"public-header-search-cluster",className:u("relative z-20 flex shrink-0 items-center gap-3 transition-all duration-300",o?"absolute inset-x-0 top-1/2 z-30 mx-auto w-[min(22rem,calc(100vw-1rem))] -translate-y-1/2 md:static md:w-auto md:translate-y-0":"w-auto"),children:[s.jsxs("div",{className:`flex items-center gap-2 rounded-full border border-transparent bg-secondary/30 px-3 py-2 transition-all duration-300 ${o?"w-full border-border bg-secondary/70 md:w-72":"w-11"}`,children:[s.jsx("button",{type:"button","aria-label":"Abrir pesquisa",onClick:()=>M(e=>!e),className:"text-foreground transition-colors hover:text-primary",children:s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",children:[s.jsx("circle",{cx:"11",cy:"11",r:"8"}),s.jsx("path",{d:"m21 21-4.3-4.3"})]})}),o&&s.jsx("input",{autoFocus:!0,value:n,onChange:e=>L(e.target.value),placeholder:"Pesquisar projetos e posts",className:"w-full bg-transparent text-sm text-foreground outline-hidden placeholder:text-muted-foreground"})]}),D&&s.jsxs("div",{ref:te,"data-testid":"public-header-results",className:"search-popover-enter absolute top-12 left-0 right-0 mx-auto max-h-[78vh] w-[min(24rem,calc(100vw-1rem))] overflow-hidden rounded-xl border border-border/60 bg-background/95 p-4 shadow-lg backdrop-blur-sm md:left-auto md:right-0 md:mx-0 md:w-80",children:[m.length>0&&s.jsxs("div",{className:"mb-4",children:[s.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:"Projetos"}),s.jsx("ul",{className:"no-scrollbar mt-3 max-h-[44vh] space-y-3 overflow-y-auto overscroll-contain pr-1",children:m.map(e=>s.jsx("li",{children:s.jsxs(i,{to:e.href,className:"group flex h-36 items-start gap-4 overflow-hidden rounded-xl border border-border/60 bg-gradient-card p-4 transition hover:border-primary/40 hover:bg-primary/5",children:[s.jsx("div",{className:"w-20 shrink-0 self-start overflow-hidden rounded-lg bg-secondary",style:{aspectRatio:"46 / 65"},children:s.jsx("img",{src:e.image,alt:e.label,className:"h-full w-full object-cover transition-transform duration-300 group-hover:scale-105"})}),s.jsxs("div",{"data-synopsis-role":"column","data-synopsis-key":e.href,className:"min-w-0 h-full flex flex-col",children:[s.jsx("p",{"data-synopsis-role":"title",className:"line-clamp-1 shrink-0 text-sm font-semibold text-foreground group-hover:text-primary",children:e.label}),s.jsx("p",{className:u("mt-1 overflow-hidden text-xs leading-snug text-muted-foreground",oe(e.href)),"data-synopsis-role":"synopsis",children:e.synopsis}),e.tags.length>0&&s.jsx("div",{"data-synopsis-role":"badges",className:"mt-auto pt-2 flex min-w-0 flex-wrap gap-1.5",children:e.tags.map(r=>s.jsx(de,{variant:"secondary",className:"text-[9px] uppercase whitespace-nowrap",children:r},r))})]})]})},e.href))})]}),k.length>0&&s.jsxs("div",{children:[s.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:"Posts"}),s.jsx("ul",{className:"no-scrollbar mt-2 max-h-[26vh] space-y-2 overflow-y-auto overscroll-contain pr-1",children:k.map(e=>s.jsx("li",{children:s.jsx(i,{to:e.href,className:"text-sm text-foreground transition-colors hover:text-primary",children:e.label})},e.href))})]}),!se&&s.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum resultado encontrado para a sua pesquisa."})]})]}),s.jsxs("div",{"data-testid":"public-header-actions-cluster",className:u("flex shrink-0 items-center gap-3 transition-all duration-300 md:gap-6",o?"opacity-0 invisible pointer-events-none md:opacity-100 md:visible md:pointer-events-auto":"opacity-100 visible pointer-events-auto"),children:[s.jsx(xe,{}),s.jsxs(F,{children:[s.jsx(z,{asChild:!0,children:s.jsx(E,{variant:"ghost",size:"icon",className:"lg:hidden h-10 w-10 rounded-full border border-border/60 bg-card/50 text-foreground/85 hover:bg-accent hover:text-accent-foreground","aria-label":"Abrir menu",children:s.jsx(fe,{className:"h-5 w-5"})})}),s.jsx(W,{align:"end",className:`w-48 ${B}`,children:U.map(e=>{const r=be(e.icon);return s.jsx(S,{asChild:!0,className:y,children:N(e.href)?s.jsxs(i,{to:e.href,className:"flex items-center gap-2",children:[s.jsx(r,{className:"h-4 w-4"}),e.label]}):s.jsxs("a",{href:e.href,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2",children:[s.jsx(r,{className:"h-4 w-4"}),e.label]})},`${e.label}-${e.href}`)})})]}),a&&s.jsxs(F,{modal:!1,children:[s.jsx(z,{asChild:!0,children:s.jsxs(E,{variant:"ghost",className:"h-11 gap-2 rounded-full px-2",children:[s.jsxs(me,{className:"h-8 w-8 border border-border/70 shadow-[0_10px_24px_-18px_hsl(var(--foreground)/0.65)]",children:[a.avatarUrl?s.jsx(ue,{src:a.avatarUrl,alt:a.name}):null,s.jsx(pe,{className:"bg-secondary text-xs text-foreground",children:(a.name||"").slice(0,2).toUpperCase()})]}),s.jsx("span",{className:"hidden text-sm font-medium text-foreground lg:inline",children:a.name||""})]})}),s.jsxs(W,{align:"end",className:`w-56 ${B}`,children:[ne.map(e=>{const r=e.icon;return s.jsx(S,{asChild:!0,className:y,children:s.jsxs(i,{to:e.href,className:"flex items-center gap-2",children:[s.jsx(r,{className:"h-4 w-4"}),e.label]})},e.href)}),s.jsx(ge,{className:"bg-border/70"}),s.jsxs(S,{className:y,onClick:le,disabled:b,children:[s.jsx(ve,{className:"h-4 w-4"}),b?"Saindo...":"Sair"]})]})]})]})]})]})})},ms=()=>{const p=H();return s.jsxs("div",{className:"flex min-h-screen flex-col",children:[s.jsx(Be,{}),s.jsx("main",{className:"flex-1 page-transition",children:s.jsx(ce,{})},p.pathname),s.jsx(we,{})]})};export{ms as default};
