import{r as l,i as H,k as J,j as e,L as X}from"./react-core-BcR2_z_l.js";import{B as L}from"./badge-CX6RuieY.js";import{B as Y}from"./button-C7iHbTqw.js";import{S as E,a as O,b as W,c as $,d as F}from"./select-BOMyCGLP.js";import{P as ee,a as se,b as D,c as te,d as ae,e as ne}from"./pagination-DtDLAEll.js";import{g as re,d as _,c as oe}from"./index-ntR5v_s2.js";import{u as le}from"./use-page-meta-ewLab265.js";import{u as ie}from"./use-dynamic-synopsis-clamp-DpjBDBPb.js";import{c as K}from"./search-ranking-cq4don08.js";import"./index-CwaKb5FF.js";import"./mui-WkDK9qS1.js";import"./index-Xj-Q384k.js";import"./index-DZ2Ey5_7.js";import"./index-CHWtszJ3.js";import"./chevron-down-Mfh0mWaz.js";import"./createLucideIcon-M1JG7EBz.js";import"./check-Cyy403AY.js";import"./chevron-left-BKEfFFqA.js";import"./chevron-right-CrdESc7p.js";const U=a=>String(a||"").replace(/\s+/g," ").trim(),ce=(a,g)=>a?Array.from(a).length<=g:!1,de=({tags:a,genres:g=[],producers:m=[],tagTranslations:B,genreTranslations:w,maxVisible:P=3,maxChars:b=18,maxRowWidth:v,badgeWidths:N,overflowBadgeWidth:k=36,gapPx:c=4})=>{const y=(Array.isArray(a)?a:[]).filter(Boolean).map(t=>({key:`tag-${t}`,label:U(B[t]||t),variant:"secondary",href:`/projetos?tag=${encodeURIComponent(t)}`})).sort((t,f)=>K(t.label,f.label)),A=(Array.isArray(g)?g:[]).filter(Boolean).map(t=>({key:`genre-${t}`,label:U(w[t]||t),variant:"outline",href:`/projetos?genero=${encodeURIComponent(t)}`})).sort((t,f)=>K(t.label,f.label)),x=(Array.isArray(m)?m:[]).filter(Boolean).map(t=>({key:`producer-${t}`,label:U(t),variant:"outline"})).sort((t,f)=>K(t.label,f.label)),h=[...y,...A,...x].filter(t=>ce(t.label,b)),n=h.slice(0,Math.max(0,P));if(typeof v!="number"||!Number.isFinite(v)||v<=0||!N){const t=n,f=Math.max(0,h.length-t.length);return{allItems:h,visibleItems:t,extraCount:f,showOverflowBadge:f>0}}const d=n.length,j=t=>{const G=n.slice(0,t).reduce((q,V)=>q+Math.max(0,N[V.key]||0),0),M=t>1?c*(t-1):0,R=Math.max(0,h.length-t),I=R>0?k:0,C=R>0&&t>0?c:0;return G+M+C+I};let u=0;for(let t=0;t<=d;t+=1)j(t)<=v&&(u=t);const p=n.slice(0,u),T=Math.max(0,h.length-p.length);return{allItems:h,visibleItems:p,extraCount:T,showOverflowBadge:T>0}},ue=["Todas",..."ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("")],me=({project:a,tagTranslations:g,genreTranslations:m,navigate:B,synopsisClampClass:w})=>{const[P,b]=l.useState(0),[v,N]=l.useState({}),k=l.useRef(null),c=l.useRef(null),{allItems:y,visibleItems:A,extraCount:x,showOverflowBadge:h}=l.useMemo(()=>de({tags:a.tags,genres:a.genres||[],producers:a.producers||[],tagTranslations:g,genreTranslations:m,maxVisible:3,maxChars:18,maxRowWidth:P,badgeWidths:v,overflowBadgeWidth:36,gapPx:4}),[v,P,m,a.genres,a.producers,a.tags,g]);return l.useEffect(()=>{const n=k.current;if(!n){b(0);return}const d=()=>b(n.clientWidth);d();const j=new ResizeObserver(d);return j.observe(n),()=>j.disconnect()},[y.length,a.id]),l.useEffect(()=>{const n=c.current;if(!n||y.length===0){N({});return}const d={};n.querySelectorAll("[data-badge-key]").forEach(u=>{const p=u.dataset.badgeKey;p&&(d[p]=u.offsetWidth)}),N(u=>{const p=Object.keys(u),T=Object.keys(d);if(p.length!==T.length)return d;for(const t of T)if(u[t]!==d[t])return d;return u})},[y]),e.jsxs(X,{to:`/projeto/${a.id}`,className:"group flex h-50 w-full items-start gap-5 overflow-hidden rounded-2xl border border-border/60 bg-gradient-card p-5 shadow-[0_28px_120px_-60px_rgba(0,0,0,0.55)] transition-all duration-300 hover:-translate-y-1 hover:border-primary/40 hover:shadow-lg md:h-60",children:[e.jsx("div",{className:"h-39 w-28 shrink-0 overflow-hidden rounded-xl bg-secondary shadow-inner md:h-50 md:w-36",children:e.jsx("img",{src:a.cover,alt:a.title,className:"h-full w-full object-cover object-center transition-transform duration-300 group-hover:scale-105"})}),e.jsxs("div",{"data-synopsis-role":"column","data-synopsis-key":a.id,className:"flex h-full min-h-0 flex-1 flex-col overflow-hidden",children:[e.jsxs("div",{"data-synopsis-role":"title",className:"shrink-0",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-primary/80 transition-colors duration-300 group-hover:text-primary",children:a.type}),e.jsx("h2",{className:"line-clamp-2 text-xl font-semibold leading-snug text-foreground transition-colors duration-300 group-hover:text-primary md:text-2xl",children:a.title})]}),e.jsx("p",{"data-synopsis-role":"synopsis",className:oe("mt-2 overflow-hidden text-sm leading-snug text-muted-foreground transition-colors duration-300 group-hover:text-foreground/80 break-normal hyphens-none",w),children:a.synopsis}),e.jsxs("div",{"data-synopsis-role":"badges",className:"relative mt-auto flex shrink-0 flex-col gap-2 pt-3",children:[A.length>0||x>0?e.jsxs("div",{ref:k,className:"hidden min-w-0 flex-nowrap items-center gap-1 overflow-hidden sm:flex",children:[A.map(n=>n.href?e.jsx("button",{type:"button",className:"inline-flex shrink-0",title:n.label,onClick:d=>{d.preventDefault(),d.stopPropagation(),B(n.href)},children:e.jsx(L,{variant:n.variant,className:"h-5 shrink-0 whitespace-nowrap px-2 text-[9px] uppercase leading-none",children:n.label})},n.key):e.jsx(L,{variant:n.variant,className:"inline-flex h-5 shrink-0 whitespace-nowrap px-2 text-[9px] uppercase leading-none",title:n.label,children:n.label},n.key)),h?e.jsxs(L,{variant:"secondary",className:"inline-flex h-5 w-9 shrink-0 justify-center whitespace-nowrap px-2 text-[9px] uppercase leading-none",title:`+${x} tags`,children:["+",x]},`extra-${a.id}`):null]}):null,e.jsx("div",{ref:c,"aria-hidden":!0,className:"pointer-events-none absolute -left-[9999px] top-0 flex items-center gap-1 opacity-0",children:y.map(n=>e.jsx(L,{"data-badge-key":n.key,variant:n.variant,className:"inline-flex h-5 shrink-0 whitespace-nowrap px-2 text-[9px] uppercase leading-none",children:n.label},`measure-${n.key}`))}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs text-muted-foreground",children:[a.status?e.jsx("span",{className:"shrink-0 rounded-full bg-background/50 px-3 py-1 truncate",children:a.status}):null,a.studio?e.jsx("span",{className:"hidden shrink-0 max-w-36 rounded-full bg-background/50 px-3 py-1 truncate lg:inline-flex lg:max-w-48",title:a.studio,children:a.studio}):null,a.episodes?e.jsx("span",{className:"hidden shrink-0 rounded-full bg-background/50 px-3 py-1 truncate xl:inline-flex",children:a.episodes}):null]})]})]})]})},Re=()=>{le({title:"Projetos"});const a=re(),g=l.useRef(!1),[m,B]=l.useState([]),[w,P]=l.useState("Todas"),[b,v]=l.useState("Todos"),[N,k]=l.useState(1),[c,y]=H(),A=J(),[x,h]=l.useState({}),[n,d]=l.useState({}),j=16,u=c.get("tag")||"Todas",p=c.get("genero")||c.get("genre")||"Todos";l.useEffect(()=>{let s=!0;return(async()=>{try{const i=await _(a,"/api/public/projects");if(!i.ok)return;const o=await i.json();s&&B(Array.isArray(o.projects)?o.projects:[])}catch{s&&B([])}})(),()=>{s=!1}},[a]),l.useEffect(()=>{let s=!0;return(async()=>{try{const i=await _(a,"/api/public/tag-translations",{cache:"no-store"});if(!i.ok)return;const o=await i.json();s&&(h(o.tags||{}),d(o.genres||{}))}catch{s&&(h({}),d({}))}})(),()=>{s=!1}},[a]),l.useEffect(()=>{const s=c.get("genre");if(!s)return;const r=new URLSearchParams(c);c.get("genero")||r.set("genero",s),r.delete("genre"),r.toString()!==c.toString()&&y(r,{replace:!0})},[c,y]);const T=(s,r)=>{const i=new URLSearchParams(c);s==="Todas"?i.delete("tag"):i.set("tag",s),r==="Todos"?(i.delete("genero"),i.delete("genre")):(i.set("genero",r),i.delete("genre")),i.toString()!==c.toString()&&y(i,{replace:!0})},t=l.useMemo(()=>{const s=m.flatMap(o=>o.tags);return["Todas",...Array.from(new Set(s)).filter(Boolean).sort((o,S)=>(x[o]||o).localeCompare(x[S]||S,"pt-BR"))]},[m,x]),f=l.useMemo(()=>{const s=m.flatMap(o=>o.genres||[]);return["Todos",...Array.from(new Set(s)).filter(Boolean).sort((o,S)=>(n[o]||o).localeCompare(n[S]||S,"pt-BR"))]},[m,n]),G=l.useMemo(()=>{const s=m.map(o=>o.type).filter(Boolean);return["Todos",...Array.from(new Set(s)).sort((o,S)=>o.localeCompare(S,"pt-BR"))]},[m]),M=l.useMemo(()=>m.filter(s=>{const r=u==="Todas"||s.tags.includes(u),i=b==="Todos"||s.type===b,o=w==="Todas"||s.title.toUpperCase().startsWith(w),S=p==="Todos"||(s.genres||[]).includes(p);return r&&i&&o&&S}).sort((s,r)=>s.title.localeCompare(r.title,"pt-BR")),[m,w,u,b,p]);l.useEffect(()=>{k(1)},[w,u,b,p]),l.useEffect(()=>{if(!g.current){g.current=!0;return}window.scrollTo({top:0,behavior:"smooth"})},[N]);const R=Math.max(1,Math.ceil(M.length/j)),I=(N-1)*j,C=M.slice(I,I+j),q=l.useMemo(()=>C.map(s=>s.id),[C]),{rootRef:V,lineByKey:z}=ie({enabled:C.length>0,keys:q,maxLines:4}),Q=s=>{const r=z[s]??2;return r<=0?"hidden":r===1?"line-clamp-1":r===2?"line-clamp-2":r===3?"line-clamp-3":"line-clamp-4"},Z=()=>{P("Todas"),v("Todos"),T("Todas","Todos")};return e.jsx("div",{className:"min-h-screen bg-linear-to-b from-background via-[hsl(var(--primary)/0.12)] to-background text-foreground",children:e.jsx("main",{className:"pt-28",children:e.jsxs("section",{className:"mx-auto w-full max-w-6xl px-6 pb-20 md:px-10 reveal","data-reveal":!0,children:[e.jsxs("div",{className:"grid gap-4 rounded-2xl bg-card/70 p-6 shadow-lg md:grid-cols-4",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-xs font-semibold uppercase tracking-widest text-muted-foreground",children:"A-Z"}),e.jsxs(E,{value:w,onValueChange:P,children:[e.jsx(O,{className:"bg-background/60",children:e.jsx(W,{placeholder:"Todas as letras"})}),e.jsx($,{children:ue.map(s=>e.jsx(F,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-xs font-semibold uppercase tracking-widest text-muted-foreground",children:"Tags"}),e.jsxs(E,{value:u,onValueChange:s=>T(s,p),children:[e.jsx(O,{className:"bg-background/60",children:e.jsx(W,{placeholder:"Todas as tags"})}),e.jsx($,{children:t.map(s=>e.jsx(F,{value:s,children:x[s]||s},s))})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-xs font-semibold uppercase tracking-widest text-muted-foreground",children:"Gêneros"}),e.jsxs(E,{value:p,onValueChange:s=>T(u,s),children:[e.jsx(O,{className:"bg-background/60",children:e.jsx(W,{placeholder:"Todos os gêneros"})}),e.jsx($,{children:f.map(s=>e.jsx(F,{value:s,children:n[s]||s},s))})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-xs font-semibold uppercase tracking-widest text-muted-foreground",children:"Formato"}),e.jsxs(E,{value:b,onValueChange:v,children:[e.jsx(O,{className:"bg-background/60",children:e.jsx(W,{placeholder:"Todos os formatos"})}),e.jsx($,{children:G.map(s=>e.jsx(F,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"md:col-span-4 flex flex-wrap items-center justify-between gap-3 rounded-xl bg-background/40 px-4 py-3 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("span",{className:"font-semibold text-foreground",children:M.length}),e.jsx("span",{children:"projetos encontrados"}),e.jsx("span",{className:"hidden text-muted-foreground md:inline",children:"•"}),e.jsx("span",{className:"hidden md:inline",children:"Atualizado semanalmente"})]}),e.jsx(Y,{variant:"ghost",onClick:Z,className:"text-xs uppercase",children:"Limpar filtros"})]})]}),C.length===0?e.jsx("div",{className:"mt-10 rounded-2xl bg-card/40 px-6 py-12 text-center text-sm text-muted-foreground",children:"Nenhum projeto encontrado para os filtros selecionados."}):e.jsx("div",{ref:V,className:"mt-10 grid gap-6 md:grid-cols-2 md:auto-rows-fr",children:C.map((s,r)=>{const i=C.length%2===1&&r===C.length-1,o=e.jsx(me,{project:s,tagTranslations:x,genreTranslations:n,navigate:A,synopsisClampClass:Q(s.id)},s.id);return i?e.jsx("div",{className:"md:col-span-2 flex justify-center",children:e.jsx("div",{className:"w-full md:w-[calc(50%-0.75rem)]",children:o})},s.id):o})}),M.length>j&&e.jsx("div",{className:"mt-12 flex justify-center",children:e.jsx(ee,{children:e.jsxs(se,{children:[e.jsx(D,{children:e.jsx(te,{href:"#",onClick:s=>{s.preventDefault(),k(r=>Math.max(1,r-1))}})}),Array.from({length:R},(s,r)=>r+1).map(s=>e.jsx(D,{children:e.jsx(ae,{href:"#",isActive:s===N,onClick:r=>{r.preventDefault(),k(s)},children:s})},s)),e.jsx(D,{children:e.jsx(ne,{href:"#",onClick:s=>{s.preventDefault(),k(r=>Math.min(R,r+1))}})})]})})})]})})})};export{Re as default};
