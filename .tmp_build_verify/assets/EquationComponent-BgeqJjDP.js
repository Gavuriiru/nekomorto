import{r,j as t}from"./react-core-BcR2_z_l.js";import{w as x,o as h,ab as g,h as j,a as q,ac as N,M as p,ad as b,c as k,ae as w,af as B}from"./lexical-CVusBMfS.js";import{k as S,a as R}from"./PlaygroundNodes-ChCl_XRL.js";import"./index-ntR5v_s2.js";import"./mui-WkDK9qS1.js";function _({equation:a,setEquation:u,inline:i},e){const s=o=>{u(o.target.value)};return i&&x(e)?t.jsxs("span",{className:"EquationEditor_inputBackground",children:[t.jsx("span",{className:"EquationEditor_dollarSign",children:"$"}),t.jsx("input",{className:"EquationEditor_inlineEditor",value:a,onChange:s,autoFocus:!0,ref:e}),t.jsx("span",{className:"EquationEditor_dollarSign",children:"$"})]}):t.jsxs("div",{className:"EquationEditor_inputBackground",children:[t.jsx("span",{className:"EquationEditor_dollarSign",children:`$$
`}),t.jsx("textarea",{className:"EquationEditor_blockEditor",value:a,onChange:s,ref:e}),t.jsx("span",{className:"EquationEditor_dollarSign",children:`
$$`})]})}const v=r.forwardRef(_);function $({equation:a,inline:u,onDoubleClick:i}){const e=r.useRef(null);return r.useEffect(()=>{const s=e.current;s!==null&&S.render(a,s,{displayMode:!u,errorColor:"#cc0000",output:"html",strict:"warn",throwOnError:!1,trust:!1})},[a,u]),t.jsxs(t.Fragment,{children:[t.jsx("img",{src:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",width:"0",height:"0",alt:""}),t.jsx("span",{role:"button",tabIndex:-1,onDoubleClick:i,ref:e}),t.jsx("img",{src:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",width:"0",height:"0",alt:""})]})}function L({equation:a,inline:u,nodeKey:i}){const[e]=h(),s=g(),[o,f]=r.useState(a),[c,E]=r.useState(!1),d=r.useRef(null),m=r.useCallback(n=>{E(!1),e.update(()=>{const l=j(i);R(l)&&(l.setEquation(o),n&&l.selectNext(0,0))})},[e,o,i]);return r.useEffect(()=>{!c&&o!==a&&f(a)},[c,a,o]),r.useEffect(()=>{if(s)return c?q(e.registerCommand(b,n=>{const l=document.activeElement;return d.current!==l&&m(),!1},p),e.registerCommand(N,n=>{const l=document.activeElement;return d.current===l?(m(!0),!0):!1},p)):e.registerUpdateListener(({editorState:n})=>{n.read(()=>{const A=k();return w(A)&&A.has(i)&&A.getNodes().length===1})&&E(!0)})},[e,i,m,c,s]),t.jsx(t.Fragment,{children:c&&s?t.jsx(v,{equation:o,setEquation:f,inline:u,ref:d}):t.jsx(B,{onError:n=>e._onError(n instanceof Error?n:new Error(String(n))),fallback:null,children:t.jsx($,{equation:o,inline:u,onDoubleClick:()=>{s&&E(!0)}})})})}export{L as default};
