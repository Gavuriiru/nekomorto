import{r as a,j as n}from"./react-core-BcR2_z_l.js";import{B as ge}from"./button-C7iHbTqw.js";import{S as we}from"./switch-D-C3W2Iz.js";import{c as x,j as xe,P as _,k as ye,f as K,l as be,h as je}from"./index-ntR5v_s2.js";import{c as H}from"./createLucideIcon-M1JG7EBz.js";import{C as W}from"./circle-check-CShtuJ1s.js";import{R as Ne,I as Se,c as ee}from"./index-BMIt2_cw.js";import{u as Te}from"./index-DZ2Ey5_7.js";const Me=H("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);const X=H("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);const Y=H("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),Oe=({title:t="Autosave",status:e,enabled:r,onEnabledChange:i,lastSavedAt:c,errorMessage:l,toggleDisabled:o=!1,onManualSave:d,manualActionLabel:m="Salvar agora",manualActionDisabled:v=!1})=>{const[u,s]=a.useState(!1),[p,g]=a.useState(!1);a.useEffect(()=>{if(!r){s(!1);return}if(e!=="saved")return;s(!0);const M=window.setTimeout(()=>s(!1),1600);return()=>window.clearTimeout(M)},[r,e]),a.useEffect(()=>{if(!r){g(!1);return}if(e!=="error")return;g(!0);const M=window.setTimeout(()=>g(!1),4e3);return()=>window.clearTimeout(M)},[r,e]);const y=a.useMemo(()=>r?e==="saving"?"saving":u?"saved":"default":"default",[r,u,e]),L=a.useMemo(()=>r?e==="saving"?"bg-sky-400":e==="pending"?"bg-amber-400":e==="saved"?"bg-emerald-400":e==="error"?"bg-destructive":"bg-muted-foreground/50":"bg-muted-foreground/40",[r,e]),R=r&&e==="error",z=l?.trim()||"Falha ao salvar",N=!r||e==="pending"||e==="error",A=a.useMemo(()=>N?"shadow-md shadow-primary/20 hover:shadow-primary/30":"bg-secondary text-secondary-foreground hover:bg-secondary/80 shadow-none hover:shadow-none sm:bg-primary sm:text-primary-foreground sm:hover:bg-primary/90 sm:shadow-md sm:shadow-primary/20 sm:hover:shadow-primary/30",[N]);return n.jsxs("div",{className:x("relative flex w-full max-w-full flex-col gap-2 self-start overflow-hidden rounded-xl border bg-card/70 px-3 py-2.5 transition-[border-color,box-shadow,background-color] duration-200 sm:inline-flex sm:w-auto sm:flex-row sm:items-center sm:gap-2.5 sm:self-end",R?"border-destructive/70 ring-1 ring-destructive/35":"border-border/60"),children:[n.jsxs("div",{className:"flex w-full items-center justify-between gap-3 sm:w-auto sm:justify-start",children:[n.jsxs("div",{className:"flex min-w-0 items-center gap-1.5",children:[n.jsx("span",{className:x("h-2.5 w-2.5 rounded-full transition-colors duration-200",L,e==="saving"?"animate-pulse":""),"aria-hidden":"true"}),n.jsx("p",{className:"truncate text-xs font-semibold uppercase tracking-widest text-muted-foreground",children:t}),n.jsx("span",{className:x("inline-flex h-4 w-4 items-center justify-center text-destructive transition-opacity duration-200",p?"opacity-100":"opacity-0"),title:z,"aria-hidden":!p,children:n.jsx(Me,{className:"h-3.5 w-3.5"})})]}),n.jsxs("div",{className:"flex shrink-0 items-center gap-2",children:[n.jsx("span",{className:"text-xs text-muted-foreground",children:"Ativo"}),n.jsx(we,{checked:r,onCheckedChange:i,disabled:o,"aria-label":"Alternar autosave"})]})]}),d?n.jsx("div",{className:"w-full sm:w-auto",children:n.jsx(ge,{type:"button",variant:"default",className:x("relative h-9 w-full justify-center overflow-hidden whitespace-nowrap rounded-lg px-3 text-sm font-semibold sm:w-42",A),onClick:d,disabled:v||r&&e==="saving",children:n.jsxs("span",{className:"relative inline-grid h-5 items-center justify-items-center",children:[n.jsxs("span",{className:"invisible col-start-1 row-start-1 inline-flex items-center justify-center gap-2 whitespace-nowrap","aria-hidden":"true",children:[n.jsx(Y,{className:"h-4 w-4"}),m]}),n.jsxs("span",{className:"invisible col-start-1 row-start-1 inline-flex items-center justify-center gap-2 whitespace-nowrap","aria-hidden":"true",children:[n.jsx(X,{className:"h-4 w-4"}),"Salvando..."]}),n.jsxs("span",{className:"invisible col-start-1 row-start-1 inline-flex items-center justify-center gap-2 whitespace-nowrap","aria-hidden":"true",children:[n.jsx(W,{className:"h-4 w-4"}),"Salvo"]}),n.jsxs("span",{className:x("col-start-1 row-start-1 inline-flex items-center justify-center gap-2 transition-opacity duration-150",y==="default"?"opacity-100":"opacity-0"),"aria-hidden":y!=="default",children:[n.jsx(Y,{className:"h-4 w-4"}),m]}),n.jsxs("span",{className:x("col-start-1 row-start-1 inline-flex items-center justify-center gap-2 transition-opacity duration-150",y==="saving"?"opacity-100":"opacity-0"),"aria-hidden":y!=="saving",children:[n.jsx(X,{className:"h-4 w-4 animate-spin"}),"Salvando..."]}),n.jsxs("span",{className:x("col-start-1 row-start-1 inline-flex items-center justify-center gap-2 transition-opacity duration-150",y==="saved"?"opacity-100":"opacity-0"),"aria-hidden":y!=="saved",children:[n.jsx(W,{className:"h-4 w-4"}),"Salvo"]})]})})}):null]})};var P="Tabs",[Ce]=je(P,[ee]),te=ee(),[Re,U]=Ce(P),re=a.forwardRef((t,e)=>{const{__scopeTabs:r,value:i,onValueChange:c,defaultValue:l,orientation:o="horizontal",dir:d,activationMode:m="automatic",...v}=t,u=Te(d),[s,p]=xe({prop:i,onChange:c,defaultProp:l??"",caller:P});return n.jsx(Re,{scope:r,baseId:ye(),value:s,onValueChange:p,orientation:o,dir:u,activationMode:m,children:n.jsx(_.div,{dir:u,"data-orientation":o,...v,ref:e})})});re.displayName=P;var ae="TabsList",ne=a.forwardRef((t,e)=>{const{__scopeTabs:r,loop:i=!0,...c}=t,l=U(ae,r),o=te(r);return n.jsx(Ne,{asChild:!0,...o,orientation:l.orientation,dir:l.dir,loop:i,children:n.jsx(_.div,{role:"tablist","aria-orientation":l.orientation,...c,ref:e})})});ne.displayName=ae;var se="TabsTrigger",ie=a.forwardRef((t,e)=>{const{__scopeTabs:r,value:i,disabled:c=!1,...l}=t,o=U(se,r),d=te(r),m=ue(o.baseId,i),v=le(o.baseId,i),u=i===o.value;return n.jsx(Se,{asChild:!0,...d,focusable:!c,active:u,children:n.jsx(_.button,{type:"button",role:"tab","aria-selected":u,"aria-controls":v,"data-state":u?"active":"inactive","data-disabled":c?"":void 0,disabled:c,id:m,...l,ref:e,onMouseDown:K(t.onMouseDown,s=>{!c&&s.button===0&&s.ctrlKey===!1?o.onValueChange(i):s.preventDefault()}),onKeyDown:K(t.onKeyDown,s=>{[" ","Enter"].includes(s.key)&&o.onValueChange(i)}),onFocus:K(t.onFocus,()=>{const s=o.activationMode!=="manual";!u&&!c&&s&&o.onValueChange(i)})})})});ie.displayName=se;var oe="TabsContent",ce=a.forwardRef((t,e)=>{const{__scopeTabs:r,value:i,forceMount:c,children:l,...o}=t,d=U(oe,r),m=ue(d.baseId,i),v=le(d.baseId,i),u=i===d.value,s=a.useRef(u);return a.useEffect(()=>{const p=requestAnimationFrame(()=>s.current=!1);return()=>cancelAnimationFrame(p)},[]),n.jsx(be,{present:c||u,children:({present:p})=>n.jsx(_.div,{"data-state":u?"active":"inactive","data-orientation":d.orientation,role:"tabpanel","aria-labelledby":m,hidden:!p,id:v,tabIndex:0,...o,ref:e,style:{...t.style,animationDuration:s.current?"0s":void 0},children:p&&l})})});ce.displayName=oe;function ue(t,e){return`${t}-trigger-${e}`}function le(t,e){return`${t}-content-${e}`}var Ae=re,de=ne,fe=ie,me=ce;const Ke=Ae,ke=a.forwardRef(({className:t,...e},r)=>n.jsx(de,{ref:r,className:x("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...e}));ke.displayName=de.displayName;const Ee=a.forwardRef(({className:t,...e},r)=>n.jsx(fe,{ref:r,className:x("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-xs focus-visible:outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",t),...e}));Ee.displayName=fe.displayName;const Ie=a.forwardRef(({className:t,...e},r)=>n.jsx(me,{ref:r,className:x("mt-2 ring-offset-background focus-visible:outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...e}));Ie.displayName=me.displayName;const V={enabledByDefault:!0,debounceMs:1200,retryMax:2,retryBaseMs:1500},C={debounceMs:{min:300,max:1e4},retryMax:{min:0,max:5},retryBaseMs:{min:300,max:1e4}},Fe=(t,e,r)=>Math.min(r,Math.max(e,t)),pe=(t,e)=>{if(typeof t=="boolean")return t;const r=String(t??"").trim().toLowerCase();return r?["1","true","yes","on"].includes(r)?!0:["0","false","no","off"].includes(r)?!1:e:e},q=(t,e,r,i)=>{const c=Number(t);return Number.isFinite(c)?Fe(Math.round(c),r,i):e},qe={enabledByDefault:pe("true",V.enabledByDefault),debounceMs:q("1200",V.debounceMs,C.debounceMs.min,C.debounceMs.max),retryMax:q("2",V.retryMax,C.retryMax.min,C.retryMax.max),retryBaseMs:q("1500",V.retryBaseMs,C.retryBaseMs.min,C.retryBaseMs.max)},He={pages:"dashboard.autosave.pages.enabled",settings:"dashboard.autosave.settings.enabled"},Ue=(t,e)=>{if(typeof window>"u")return e;try{const r=window.localStorage.getItem(t);return r===null?e:pe(r,e)}catch{return e}},Je=(t,e)=>{if(!(typeof window>"u"))try{window.localStorage.setItem(t,String(!!e))}catch{}},Z=t=>{if(t===void 0)return"undefined";try{return JSON.stringify(t)}catch{return String(t)}},Be=t=>new Promise(e=>{window.setTimeout(e,Math.max(0,t))}),Qe=({value:t,onSave:e,isReady:r=!0,enabled:i=!0,debounceMs:c=1200,retryMax:l=2,retryBaseMs:o=1500,serialize:d=Z,onSaved:m,onError:v})=>{const[u,s]=a.useState("idle"),[p,g]=a.useState(null),[y,L]=a.useState(null),[R,z]=a.useState(!!i),N=a.useCallback(f=>{try{return d(f)}catch{return Z(f)}},[d]),A=a.useMemo(()=>N(t),[N,t]),M=a.useRef(t),b=a.useRef(A),h=a.useRef(null),F=a.useRef(null),S=a.useRef(!1),k=a.useRef(!1),$=a.useRef(!!i),j=a.useRef(!0),B=a.useRef(0);M.current=t,b.current=A;const T=a.useCallback(()=>{F.current!==null&&(window.clearTimeout(F.current),F.current=null)},[]),J=a.useCallback(async f=>{let w=0;const D=Math.max(0,l)+1;for(;w<D;)try{return await e(f)}catch(I){if(w+=1,w>=D)throw I;const O=Math.max(0,o)*2**(w-1);await Be(O)}throw new Error("autosave_unreachable")},[e,o,l]),E=a.useCallback(async f=>{if(!r||f==="auto"&&!$.current)return!1;if(T(),h.current===null)return h.current=b.current,j.current&&(s("idle"),g(null)),!1;if(b.current===h.current)return j.current&&!S.current&&(s("idle"),g(null)),!0;if(S.current)return k.current=!0,j.current&&s("pending"),!1;S.current=!0,k.current=!1,j.current&&(s("saving"),g(null));const w=M.current;try{const O=await J(w)??w;h.current=N(O),B.current=0;const Q=Date.now();j.current&&(L(Q),s("saved"),g(null)),m?.({source:f,savedAt:Q})}catch(I){B.current+=1,j.current&&(s("error"),g(I)),v?.(I,{source:f,consecutiveErrors:B.current})}finally{S.current=!1}const D=k.current&&$.current&&b.current!==h.current;return k.current=!1,D&&E("auto"),b.current===h.current},[T,r,v,m,J,N]);a.useEffect(()=>{if(!r)return;if(h.current===null){h.current=b.current,s("idle"),g(null),B.current=0;return}if(T(),!(b.current!==h.current)){S.current||s(w=>w==="saved"?w:"idle");return}if(!R){S.current||s("pending");return}if(S.current){k.current=!0,s("pending");return}return s("pending"),F.current=window.setTimeout(()=>{E("auto")},Math.max(0,c)),()=>{T()}},[T,c,R,r,E,A]),a.useEffect(()=>(j.current=!0,()=>{j.current=!1,T()}),[T]);const G=a.useCallback(f=>{$.current=!!f,z(!!f)},[]);a.useEffect(()=>{G(i)},[i,G]);const he=r&&h.current!==null&&b.current!==h.current,ve=a.useCallback(async()=>E("manual"),[E]);return{status:u,isDirty:he,lastSavedAt:y,error:p,enabled:R,setEnabled:G,flushNow:ve}};export{Oe as D,Y as S,Ke as T,qe as a,ke as b,Ee as c,Ie as d,He as e,Ue as r,Qe as u,Je as w};
