import{r}from"./react-core-BcR2_z_l.js";const d=e=>{const n=Number.parseFloat(e);return Number.isFinite(n)?n:0},M=(e,n)=>Math.max(0,Math.min(e,n)),T=(e,n)=>{const y=Object.keys(e),f=Object.keys(n);return y.length!==f.length?!1:y.every(t=>e[t]===n[t])},k=({enabled:e,keys:n,maxLines:y=3,scopeRef:f,selectors:t,resizeDebounceMs:g=80})=>{const q=r.useRef(null),c=f??q,l=r.useRef(null),[R,w]=r.useState({}),h=r.useMemo(()=>n.join("||"),[n]),s=r.useMemo(()=>({column:t?.column||'[data-synopsis-role="column"]',title:t?.title||'[data-synopsis-role="title"]',synopsis:t?.synopsis||'[data-synopsis-role="synopsis"]',badges:t?.badges||'[data-synopsis-role="badges"]'}),[t?.badges,t?.column,t?.synopsis,t?.title]),u=r.useCallback(()=>{const i=c.current;if(!e||!i){w({});return}const a={};i.querySelectorAll(s.column).forEach(o=>{const S=String(o.dataset.synopsisKey||"");if(!S)return;const b=o.querySelector(s.title),v=o.querySelector(s.synopsis),x=o.querySelector(s.badges);if(!b||!v)return;const p=window.getComputedStyle(v),E=d(p.lineHeight),A=d(p.fontSize),H=E>0?E:A*1.2;if(!H)return;const z=d(p.marginTop),F=o.clientHeight-b.offsetHeight-(x?.offsetHeight||0)-z,K=M(Math.floor(F/H),y);a[S]=K}),w(o=>T(o,a)?o:a)},[e,y,s.badges,s.column,s.synopsis,s.title,c]);return r.useEffect(()=>(l.current!==null&&window.cancelAnimationFrame(l.current),l.current=window.requestAnimationFrame(u),()=>{l.current!==null&&(window.cancelAnimationFrame(l.current),l.current=null)}),[e,h,u]),r.useEffect(()=>{if(!e||!c.current)return;let i=null;const a=()=>{i!==null&&window.clearTimeout(i),i=window.setTimeout(u,g)};window.addEventListener("resize",a,{passive:!0});const m=new ResizeObserver(()=>u());return c.current.querySelectorAll(s.column).forEach(o=>{m.observe(o)}),u(),()=>{i!==null&&window.clearTimeout(i),window.removeEventListener("resize",a),m.disconnect()}},[e,h,u,g,s.column,c]),{rootRef:c,lineByKey:R}};export{k as u};
