import{k as me,r as a,j as e,L as m}from"./react-core-BcR2_z_l.js";import{D as ue}from"./DashboardShell-BZQMplB5.js";import{B as h}from"./badge-CX6RuieY.js";import{B as v}from"./button-C7iHbTqw.js";import{g as xe,d as u}from"./index-ntR5v_s2.js";import{a as G}from"./date-D79tpn1j.js";import{u as pe}from"./use-page-meta-ewLab265.js";import"./ThemedSvgLogo-CGFMwyp6.js";import"./createLucideIcon-M1JG7EBz.js";import"./url-safety-Py24cS-5.js";import"./Footer-C9y59CM9.js";import"./avatar-CVZSwVae.js";import"./index-Xj-Q384k.js";import"./shield-DlmGTLiS.js";import"./index-BMIt2_cw.js";import"./index-DZ2Ey5_7.js";import"./index-CHWtszJ3.js";import"./chevron-right-CrdESc7p.js";import"./check-Cyy403AY.js";import"./users-ok7q4J4c.js";import"./info-BTb-jBiG.js";import"./book-open-CG_mViAI.js";import"./ThemedSvgMaskIcon-B_IYD_H5.js";import"./globe-CRGpuS2E.js";import"./message-circle-qqsIJunn.js";import"./x-BpqL4Bns.js";import"./use-toast-DeMRPCeJ.js";import"./index-CwaKb5FF.js";import"./mui-WkDK9qS1.js";import"./input-BfSJiKKQ.js";import"./separator-CDy1CE57.js";import"./skeleton-DbpZ9Rjt.js";import"./search-ranking-cq4don08.js";import"./use-dynamic-synopsis-clamp-DpjBDBPb.js";import"./access-control-C6qZ0ZhA.js";const Ke=()=>{pe({title:"Dashboard",noIndex:!0});const W=me(),[x,N]=a.useState(null),[b,Z]=a.useState(!0),[c,w]=a.useState([]),[g,P]=a.useState([]),[$,A]=a.useState([]),[J,D]=a.useState(0),[V,k]=a.useState([]),[K,C]=a.useState(0),[Q,S]=a.useState(0),[X,L]=a.useState(0),n=xe();a.useEffect(()=>{(async()=>{try{const t=await u(n,"/api/me",{auth:!0});if(!t.ok){N(null);return}const r=await t.json();N(r)}catch{N(null)}finally{Z(!1)}})()},[n]),a.useEffect(()=>{let s=!0;return(async()=>{try{const[r,i,d,l]=await Promise.all([u(n,"/api/analytics/overview?range=7d&type=all",{auth:!0}),u(n,"/api/analytics/overview?range=7d&type=project",{auth:!0}),u(n,"/api/analytics/overview?range=7d&type=post",{auth:!0}),u(n,"/api/analytics/timeseries?range=7d&type=all&metric=views",{auth:!0})]);if(!s)return;if(!r.ok||!i.ok||!d.ok||!l.ok){C(0),S(0),L(0),k([]);return}const[j,o,p,q]=await Promise.all([r.json(),i.json(),d.json(),l.json()]);if(!s)return;C(Number(j?.metrics?.views||0)),S(Number(o?.metrics?.views||0)),L(Number(p?.metrics?.views||0)),k(Array.isArray(q?.series)?q.series||[]:[])}catch{if(!s)return;C(0),S(0),L(0),k([])}})(),()=>{s=!1}},[n]),a.useEffect(()=>{(async()=>{try{const t=await u(n,"/api/projects",{auth:!0});if(!t.ok){w([]);return}const r=await t.json();w(Array.isArray(r.projects)?r.projects:[])}catch{w([])}})()},[n]),a.useEffect(()=>{let s=!0;return(async()=>{try{const r=await u(n,"/api/posts",{auth:!0});if(!r.ok){s&&P([]);return}const i=await r.json();s&&P(Array.isArray(i.posts)?i.posts:[])}catch{s&&P([])}})(),()=>{s=!1}},[n]),a.useEffect(()=>{let s=!0;return(async()=>{try{const r=await u(n,"/api/comments/recent?limit=3",{auth:!0});if(!r.ok){s&&(A([]),D(0));return}const i=await r.json();s&&(A(Array.isArray(i.comments)?i.comments.map(d=>({id:d.id,author:d.name,message:d.content,page:d.targetLabel,createdAt:d.createdAt,url:d.targetUrl,status:d.status||"approved"})):[]),D(Number.isFinite(i.pendingCount)?i.pendingCount:0))}catch{s&&(A([]),D(0))}})(),()=>{s=!1}},[n]);const Y=a.useMemo(()=>b?"Carregando usuário...":x?.name??"Usuário não conectado",[x,b]),ee=a.useMemo(()=>b?"Aguarde":x?`@${x.username}`:"OAuth Discord pendente",[x,b]),E=a.useMemo(()=>{const s=[],t=new Date;for(let r=6;r>=0;r-=1){const i=new Date(t);i.setDate(t.getDate()-r),s.push(i.toISOString().slice(0,10))}return s},[]),R=c.length,U=c.reduce((s,t)=>s+(t.episodeDownloads?.length||0),0),M=c.filter(s=>{const t=s.status.toLowerCase();return t.includes("andamento")||t.includes("produ")}).length,B=c.filter(s=>{const t=s.status.toLowerCase();return t.includes("complet")||t.includes("lan")}).length,T=c.reduce((s,t)=>s+(t.views??0),0),_=g.reduce((s,t)=>s+(t.views??0),0),se=T+_,te=Q,re=X,z=K;g.filter(s=>s.status!=="published").length;const ae="/dashboard/analytics?range=30d&type=all",oe="/dashboard/analytics?range=30d&type=project",ie="/dashboard/analytics?range=30d&type=post",O=c.map(s=>({...s,views:s.views??0})).filter(s=>s.views>0).sort((s,t)=>t.views-s.views),de=O.length>0,f=z>0,ne=a.useMemo(()=>E.map(s=>V.find(t=>t.date===s)?.value??0),[V,E]),F=a.useMemo(()=>g.slice().sort((s,t)=>{const r=new Date(s.updatedAt||s.publishedAt).getTime();return new Date(t.updatedAt||t.publishedAt).getTime()-r}).slice(0,3),[g]),I=100,y=40,H=f?ne.map((s,t,r)=>{const i=Math.max(...r.map(j=>j)),d=I/Math.max(r.length-1,1)*t,l=y-s/Math.max(i,1)*(y-6)-3;return`${d},${l}`}).join(" "):"",le=f?`M0,${y} L${H} L${I},${y} Z`:"",ce=()=>{const s=o=>{const p=String(o??"");return p.includes('"')||p.includes(",")||p.includes(`
`)?`"${p.replace(/"/g,'""')}"`:p},t=[];t.push("Resumo"),t.push(`Total de projetos,${R}`),t.push(`Total de mídias,${U}`),t.push(`Projetos ativos,${M}`),t.push(`Projetos finalizados,${B}`),t.push(`Acessos em projetos,${T}`),t.push(`Acessos em posts,${_}`),t.push(`Acessos totais,${se}`),t.push(""),t.push("Projetos"),t.push("id,titulo,status,views,comentarios,atualizado_em"),c.forEach(o=>{t.push([s(o.id),s(o.title),s(o.status),s(o.views??0),s(o.commentsCount??0),s(o.updatedAt??"")].join(","))}),t.push(""),t.push("Posts"),t.push("id,slug,titulo,status,views,comentarios,publicado_em,atualizado_em"),g.forEach(o=>{t.push([s(o.id),s(o.slug),s(o.title),s(o.status),s(o.views??0),s(o.commentsCount??0),s(o.publishedAt??""),s(o.updatedAt??"")].join(","))});const r=`\uFEFF${t.join(`
`)}`,i=new Blob([r],{type:"text/csv;charset=utf-8;"}),d=window.URL.createObjectURL(i),l=document.createElement("a");l.href=d;const j=new Date().toISOString().slice(0,10);l.download=`relatorio-dashboard-${j}.csv`,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(d)};return e.jsx(ue,{currentUser:x,isLoadingUser:b,userLabel:Y,userSubLabel:ee,onUserCardClick:()=>W("/dashboard/usuarios?edit=me"),children:e.jsx("main",{className:"pt-24",children:e.jsxs("section",{className:"mx-auto w-full max-w-6xl px-6 pb-20 md:px-10 reveal","data-reveal":!0,children:[e.jsxs("header",{className:"flex flex-col gap-6 lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"inline-flex items-center gap-3 rounded-full border border-border/60 bg-card/60 px-4 py-2 text-xs uppercase tracking-[0.3em] text-muted-foreground animate-fade-in",children:"Dashboard Interna"}),e.jsx("h1",{className:"text-3xl font-semibold lg:text-4xl animate-slide-up",children:"Painel de controle da comunidade"}),e.jsx("p",{className:"max-w-2xl text-sm text-muted-foreground animate-slide-up opacity-0",style:{animationDelay:"0.2s"},children:"Visão geral dos projetos e do conteúdo. Assim que as integrações de analytics e comentários estiverem ativas, os dados aparecem aqui automaticamente."})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(h,{className:"bg-card/80 text-muted-foreground",children:"Acesso restrito"}),x?e.jsx(v,{variant:"outline",className:"border-border/70 bg-card/60 px-4 text-muted-foreground hover:text-foreground",onClick:ce,children:"Exportar relatório"}):e.jsx(m,{to:"/login",children:e.jsx(v,{variant:"outline",className:"border-border/70 bg-card/60 px-4 text-muted-foreground hover:text-foreground",children:"Fazer login"})})]})]}),e.jsxs("div",{className:"mt-10 grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{className:"rounded-2xl border border-border/60 bg-linear-to-br from-card/70 to-background/60 p-5 animate-slide-up opacity-0",style:{animationDelay:"0ms"},children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Projetos cadastrados"}),e.jsx("div",{className:"mt-3 text-2xl font-semibold",children:R}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"Catálogo completo do site."})]}),e.jsxs("div",{className:"rounded-2xl border border-border/60 bg-linear-to-br from-card/70 to-background/60 p-5 animate-slide-up opacity-0",style:{animationDelay:"80ms"},children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Mídias disponíveis"}),e.jsx("div",{className:"mt-3 text-2xl font-semibold",children:U}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"Downloads ativos nos projetos."})]}),e.jsxs("div",{className:"rounded-2xl border border-border/60 bg-linear-to-br from-card/70 to-background/60 p-5 animate-slide-up opacity-0",style:{animationDelay:"160ms"},children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Projetos ativos"}),e.jsx("div",{className:"mt-3 text-2xl font-semibold",children:M}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"Em andamento ou produção."})]}),e.jsxs("div",{className:"rounded-2xl border border-border/60 bg-linear-to-br from-card/70 to-background/60 p-5 animate-slide-up opacity-0",style:{animationDelay:"240ms"},children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Projetos finalizados"}),e.jsx("div",{className:"mt-3 text-2xl font-semibold",children:B}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"Completo ou lançado."})]})]}),e.jsxs("section",{className:"mt-10 grid gap-6 lg:grid-cols-[minmax(0,2fr)_minmax(0,1fr)] reveal","data-reveal":!0,children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"rounded-3xl border border-border/60 bg-card/60 p-6 shadow-[0_20px_60px_-40px_rgba(0,0,0,0.8)] animate-slide-up opacity-0",style:{animationDelay:"120ms"},children:e.jsxs("div",{className:"flex flex-col gap-6 lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Analytics de acessos"}),f?e.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[e.jsx("span",{className:"text-3xl font-semibold",children:z}),e.jsx(h,{className:"bg-card/80 text-muted-foreground",children:"Últimos 7 dias"})]}):e.jsx("p",{className:"mt-3 text-sm text-muted-foreground",children:"Nenhum dado de acesso foi coletado ainda."}),f?e.jsxs("p",{className:"mt-2 text-xs text-muted-foreground",children:[te," em projetos e ",re," em posts"]}):null,e.jsx("div",{className:"mt-4",children:e.jsx(v,{variant:"outline",className:"border-border/70 bg-card/60 px-4 text-muted-foreground hover:text-foreground",asChild:!0,children:e.jsx(m,{to:ae,children:"Ver analytics completos"})})})]}),e.jsx("div",{className:"w-full max-w-xs",children:e.jsx("div",{className:"h-32 rounded-2xl border border-border/60 bg-linear-to-br from-card/70 to-background/60 p-4",children:f?e.jsxs("svg",{viewBox:"0 0 100 40",className:"h-full w-full",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"visits-gradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"hsl(var(--accent))",stopOpacity:"0.7"}),e.jsx("stop",{offset:"100%",stopColor:"hsl(var(--accent))",stopOpacity:"0"})]})}),e.jsx("path",{d:le,fill:"url(#visits-gradient)"}),e.jsx("polyline",{points:H,fill:"none",stroke:"hsl(var(--accent))",strokeWidth:"2.5",strokeLinejoin:"round",strokeLinecap:"round"})]}):e.jsxs("div",{className:"flex h-full flex-col items-center justify-center text-center text-xs text-muted-foreground",children:[e.jsx("span",{children:"Gráfico indisponível"}),e.jsx("span",{children:"Sem dados de projetos ainda"})]})})})]})}),e.jsxs("div",{className:"rounded-3xl border border-border/60 bg-card/60 p-6 animate-slide-up opacity-0",style:{animationDelay:"200ms"},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Projetos mais acessados"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ranking por projetos individuais"})]}),e.jsx(v,{variant:"outline",className:"border-border/70 bg-card/60 px-4 text-muted-foreground hover:text-foreground",asChild:!0,children:e.jsx(m,{to:oe,children:"Ver analytics de projetos"})})]}),de?e.jsx("div",{className:"mt-6 space-y-4",children:O.slice(0,3).map(s=>e.jsx(m,{to:`/projeto/${s.id}`,className:"block rounded-2xl border border-border/60 bg-card/60 p-4 transition hover:border-primary/40 hover:bg-primary/5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:s.title}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[e.jsxs("span",{children:[s.views," acessos"]}),e.jsx(h,{className:"bg-card/80 text-muted-foreground",children:s.status})]})]})},s.id))}):e.jsx("div",{className:"mt-6 rounded-2xl border border-dashed border-border/60 bg-card/60 px-4 py-8 text-center text-sm text-muted-foreground",children:"Conecte o backend de analytics para ver o ranking de acesso por projeto."})]}),e.jsxs("div",{className:"rounded-3xl border border-border/60 bg-card/60 p-6 animate-slide-up opacity-0",style:{animationDelay:"280ms"},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Posts mais recentes"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Publicações e visualizações"})]}),e.jsx(v,{variant:"outline",className:"border-border/70 bg-card/60 px-4 text-muted-foreground hover:text-foreground",asChild:!0,children:e.jsx(m,{to:ie,children:"Ver analytics de posts"})})]}),F.length===0?e.jsx("div",{className:"mt-6 rounded-2xl border border-dashed border-border/60 bg-card/60 px-4 py-8 text-center text-sm text-muted-foreground",children:"Nenhum post publicado ainda."}):e.jsx("div",{className:"mt-6 space-y-4",children:F.map(s=>e.jsxs(m,{to:`/postagem/${s.slug}`,className:"flex flex-col gap-3 rounded-2xl border border-border/60 bg-card/60 p-4 transition hover:border-primary/40 hover:bg-primary/5 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.title}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Status: ",s.status]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:[s.views," visualizações"]}),e.jsx(h,{className:"bg-card/80 text-muted-foreground",children:G(s.updatedAt||s.publishedAt)})]})]},s.id))})]})]}),e.jsxs("aside",{className:"space-y-6",children:[e.jsxs("div",{className:"rounded-3xl border border-border/60 bg-card/60 p-6 animate-slide-up opacity-0",style:{animationDelay:"360ms"},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Comentários recentes"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Sistema por página"})]}),e.jsxs(h,{className:"bg-card/80 text-muted-foreground",children:[J," pendentes"]})]}),$.length===0?e.jsx("div",{className:"mt-6 rounded-2xl border border-dashed border-border/60 bg-card/60 px-4 py-8 text-center text-sm text-muted-foreground",children:"Nenhum comentário registrado ainda."}):e.jsx("div",{className:"mt-6 space-y-4",children:$.slice(0,3).map(s=>e.jsxs("a",{href:s.url,className:"block rounded-2xl border border-border/60 bg-card/60 p-4 transition hover:border-primary/40 hover:bg-primary/5",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:s.author}),e.jsx("span",{children:G(s.createdAt)})]}),e.jsx("p",{className:"mt-2 text-sm text-foreground",children:s.message}),e.jsxs("p",{className:"mt-2 text-xs text-muted-foreground",children:["Em: ",s.page]})]},s.id))})]}),e.jsxs("div",{className:"rounded-3xl border border-border/60 bg-card/60 p-6 overflow-hidden animate-slide-up opacity-0",style:{animationDelay:"440ms"},children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Projetos cadastrados"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Acesso rápido ao catálogo."}),e.jsxs("div",{className:"mt-5 space-y-3",children:[c.slice(0,3).map(s=>e.jsxs(m,{to:`/projeto/${s.id}`,className:"flex items-center justify-between rounded-2xl border border-border/60 bg-card/60 px-4 py-3 text-sm transition hover:border-primary/40 hover:bg-primary/5",children:[e.jsx("span",{className:"font-medium",children:s.title}),e.jsx(h,{className:"bg-card/80 text-muted-foreground",children:s.status})]},s.id)),c.length>3&&e.jsx(m,{to:"/projetos",className:"block w-full rounded-xl border border-border/60 bg-card/60 px-4 py-3 text-center text-sm text-muted-foreground transition hover:border-primary/40 hover:bg-primary/5 hover:text-foreground",children:"Ver todos os projetos"})]})]})]})]})]})})})};export{Ke as default};
