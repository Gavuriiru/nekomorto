import{k as E,r as a,j as e}from"./react-core-BcR2_z_l.js";import{D as B}from"./DashboardShell-BZQMplB5.js";import{A as L,a as T,b as S,c as I,d as U,e as M,f as O,g as q}from"./alert-dialog-ugflDUIb.js";import{B as g}from"./button-C7iHbTqw.js";import{C as z,a as P}from"./card-VD61BBwz.js";import{B as y}from"./badge-CX6RuieY.js";import{t as i}from"./use-toast-DeMRPCeJ.js";import{g as $,d as m}from"./index-ntR5v_s2.js";import{a as F}from"./date-D79tpn1j.js";import{u as H}from"./use-page-meta-ewLab265.js";import{C as V}from"./circle-check-CShtuJ1s.js";import{T as R}from"./trash-2-CSrjaLTp.js";import{c as _}from"./createLucideIcon-M1JG7EBz.js";import"./ThemedSvgLogo-CGFMwyp6.js";import"./url-safety-Py24cS-5.js";import"./Footer-C9y59CM9.js";import"./avatar-CVZSwVae.js";import"./index-Xj-Q384k.js";import"./shield-DlmGTLiS.js";import"./index-BMIt2_cw.js";import"./index-DZ2Ey5_7.js";import"./index-CHWtszJ3.js";import"./chevron-right-CrdESc7p.js";import"./check-Cyy403AY.js";import"./users-ok7q4J4c.js";import"./info-BTb-jBiG.js";import"./book-open-CG_mViAI.js";import"./ThemedSvgMaskIcon-B_IYD_H5.js";import"./globe-CRGpuS2E.js";import"./message-circle-qqsIJunn.js";import"./x-BpqL4Bns.js";import"./index-CwaKb5FF.js";import"./mui-WkDK9qS1.js";import"./input-BfSJiKKQ.js";import"./separator-CDy1CE57.js";import"./skeleton-DbpZ9Rjt.js";import"./search-ranking-cq4don08.js";import"./use-dynamic-synopsis-clamp-DpjBDBPb.js";import"./access-control-C6qZ0ZhA.js";const G=_("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),Se=()=>{H({title:"Comentários",noIndex:!0});const o=$(),C=E(),[p,n]=a.useState([]),[N,v]=a.useState(!0),[D,u]=a.useState(null),[x,h]=a.useState(null),[l,c]=a.useState({}),[d,j]=a.useState(!1),b=a.useCallback(async()=>{try{v(!0);const t=await m(o,"/api/comments/pending",{auth:!0});if(!t.ok){n([]);return}const r=await t.json();n(Array.isArray(r.comments)?r.comments:[])}catch{n([])}finally{v(!1)}},[o]);a.useEffect(()=>{b()},[b]),a.useEffect(()=>{(async()=>{try{const r=await m(o,"/api/me",{auth:!0});if(!r.ok){u(null);return}const s=await r.json();u(s)}catch{u(null)}})()},[o]);const w=async t=>{if(!l[t]){c(r=>({...r,[t]:"approve"}));try{(await m(o,`/api/comments/${t}/approve`,{method:"POST",auth:!0})).ok?(n(s=>s.filter(f=>f.id!==t)),i({title:"Comentário aprovado",description:"O comentário já está visível publicamente.",intent:"success"})):i({title:"Não foi possível aprovar o comentário",variant:"destructive"})}catch{i({title:"Não foi possível aprovar o comentário",variant:"destructive"})}finally{c(r=>{const s={...r};return delete s[t],s})}}},A=t=>{h(t)},k=async()=>{if(!x||d)return;const t=x.id;c(r=>({...r,[t]:"delete"})),j(!0);try{(await m(o,`/api/comments/${t}`,{method:"DELETE",auth:!0})).ok?(n(s=>s.filter(f=>f.id!==t)),i({title:"Comentário excluído",description:"O comentário foi removido da moderação.",intent:"success"}),h(null)):i({title:"Não foi possível excluir o comentário",variant:"destructive"})}catch{i({title:"Não foi possível excluir o comentário",variant:"destructive"})}finally{c(r=>{const s={...r};return delete s[t],s}),j(!1)}};return e.jsxs(B,{currentUser:D,onUserCardClick:()=>C("/dashboard/usuarios?edit=me"),children:[e.jsx("main",{className:"px-6 pb-20 pt-24 md:px-10",children:e.jsxs("div",{className:"mx-auto flex w-full max-w-6xl flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-foreground animate-slide-up",children:"Comentários pendentes"}),e.jsx("p",{className:"text-sm text-muted-foreground animate-slide-up opacity-0",style:{animationDelay:"0.2s"},children:"Aprove ou exclua comentários enviados pelos visitantes."})]}),e.jsxs(y,{variant:"secondary",className:"text-xs uppercase animate-fade-in",children:[p.length," pendentes"]})]}),N?e.jsx("div",{className:"rounded-2xl border border-border/60 bg-card/60 p-6 text-sm text-muted-foreground",children:"Carregando comentários..."}):p.length===0?e.jsx("div",{className:"rounded-2xl border border-dashed border-border/60 bg-card/40 p-8 text-center text-sm text-muted-foreground animate-slide-up opacity-0",style:{animationDelay:"120ms"},children:"Nenhum comentário aguardando aprovação."}):e.jsx("div",{className:"grid gap-4",children:p.map((t,r)=>e.jsx(z,{className:"border-border/60 bg-card/80 shadow-lg animate-slide-up opacity-0",style:{animationDelay:`${r*60}ms`},children:e.jsxs(P,{className:"space-y-4 p-6",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(y,{variant:"outline",className:"text-[10px] uppercase",children:t.targetType}),e.jsx("span",{children:F(t.createdAt)})]}),e.jsx("p",{className:"text-sm font-semibold text-foreground",children:t.name}),e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-line",children:t.content})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(g,{size:"sm",variant:"secondary",disabled:!!l[t.id],onClick:()=>w(t.id),children:[e.jsx(V,{className:"mr-2 h-4 w-4"}),l[t.id]==="approve"?"Aprovando...":"Aprovar"]}),e.jsxs(g,{size:"sm",variant:"destructive",disabled:!!l[t.id],onClick:()=>A(t),children:[e.jsx(R,{className:"mr-2 h-4 w-4"}),l[t.id]==="delete"?"Excluindo...":"Excluir"]}),e.jsx(g,{size:"sm",variant:"outline",asChild:!0,children:e.jsxs("a",{href:t.targetUrl,target:"_blank",rel:"noreferrer",children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),"Ver página"]})})]})]}),e.jsx("div",{className:"rounded-xl border border-border/50 bg-background/60 px-3 py-2 text-xs text-muted-foreground",children:t.targetLabel})]})},t.id))})]})}),e.jsx(L,{open:!!x,onOpenChange:t=>{!t&&!d&&h(null)},children:e.jsxs(T,{children:[e.jsxs(S,{children:[e.jsx(I,{children:"Excluir comentário?"}),e.jsx(U,{children:"Esta ação remove o comentário permanentemente."})]}),e.jsxs(M,{children:[e.jsx(O,{disabled:d,children:"Cancelar"}),e.jsx(q,{className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:d,onClick:t=>{t.preventDefault(),k()},children:d?"Excluindo...":"Excluir"})]})]})})]})};export{Se as default};
