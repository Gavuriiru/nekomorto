import{r as i,j as n}from"./react-core-BcR2_z_l.js";import{f as y,o as f,D as d,j as p}from"./lexical-CVusBMfS.js";import{S as w,F as b,T as E,E as S}from"./playground-overrides-BL6rcNro.js";import{P,T as R}from"./PlaygroundNodes-ChCl_XRL.js";import{t as V}from"./PlaygroundEditorTheme-nA-I7k_h.js";import{S as g}from"./ContentEditable-BX3pcmlG.js";import{P as v}from"./PollContext-CEXjjzNp.js";import{g as C,d as $}from"./index-ntR5v_s2.js";import"./ImageLibraryDialog-BbbI0q6f.js";import"./index-CHWtszJ3.js";import"./index-BMIt2_cw.js";import"./createLucideIcon-M1JG7EBz.js";import"./index-DZ2Ey5_7.js";import"./chevron-right-CrdESc7p.js";import"./check-Cyy403AY.js";import"./accordion-DHuEXPng.js";import"./chevron-down-Mfh0mWaz.js";import"./button-C7iHbTqw.js";import"./index-Xj-Q384k.js";import"./index-CwaKb5FF.js";import"./mui-WkDK9qS1.js";import"./dialog-CLWEkP9q.js";import"./input-BfSJiKKQ.js";import"./x-BpqL4Bns.js";import"./label-BwT1z_RF.js";import"./use-toast-DeMRPCeJ.js";import"./index-DVZfbOhf.js";import"./trash-2-CSrjaLTp.js";import"./color-picker-Q1yTfexr.js";import"./floating-ui.react-BugR93ss.js";const m="rainbow_poll_voter_id",I=()=>{if(typeof window>"u")return"local";const t=window.localStorage.getItem(m);if(t)return t;const r=typeof window.crypto?.randomUUID=="function"?window.crypto.randomUUID():`guest-${Math.random().toString(36).slice(2,10)}${Date.now().toString(36)}`;return window.localStorage.setItem(m,r),r},h=t=>{if(!t)return null;try{const r=JSON.parse(t);if(r&&typeof r=="object")return t}catch{return null}return null},M=({value:t})=>{const[r]=f(),e=i.useRef(null),a=i.useRef(null),c=i.useRef(!1);return i.useEffect(()=>{if(t===e.current||(a.current=t,c.current))return;c.current=!0,(typeof queueMicrotask=="function"?queueMicrotask:s=>Promise.resolve().then(s))(()=>{c.current=!1;const s=a.current;if(a.current=null,s==null||s===e.current)return;if(!s){r.update(()=>{const o=d();o.clear(),o.append(p())},{discrete:!0}),e.current=s;return}const u=h(s);if(!u){r.update(()=>{const o=d();o.clear(),o.append(p())},{discrete:!0}),e.current=s;return}try{const o=r.parseEditorState(u);r.setEditorState(o),e.current=s}catch{r.update(()=>{const o=d();o.clear(),o.append(p())},{discrete:!0}),e.current=s}})},[r,t]),null},N=()=>{const[t]=f();return i.useEffect(()=>{t.setEditable(!1)},[t]),null},ue=({value:t,className:r,pollTarget:e})=>{const a=C(),c=i.useMemo(()=>I(),[]),l=i.useCallback(async o=>{if(!e)return;const x=e.type==="post"?`/api/public/posts/${e.slug}/polls/vote`:`/api/public/projects/${e.projectId}/chapters/${e.chapterNumber}/polls/vote`,j=e.type==="chapter"&&Number.isFinite(e.volume)?`?volume=${e.volume}`:"";try{await $(a,`${x}${j}`,{method:"POST",json:{...o,voterId:c}})}catch{}},[a,e,c]),s=i.useMemo(()=>({target:e,voterId:c,persistVote:e?l:void 0}),[l,e,c]),u=i.useRef({namespace:"RainbowLexicalViewer",theme:V,nodes:P,onError:o=>{console.error(o)},editable:!1,editorState:h(t)||void 0}).current;return n.jsx(w,{children:n.jsx(b,{children:n.jsx(v,{value:s,children:n.jsx(y,{initialConfig:u,children:n.jsx(g,{children:n.jsx(E,{children:n.jsxs(R,{children:[n.jsx("div",{className:`lexical-playground ${r||""}`,children:n.jsx("div",{className:"editor-shell editor-shell--read-only",children:n.jsx(S,{hideToolbar:!0,placeholder:""})})}),n.jsx(M,{value:t}),n.jsx(N,{})]})})})})})})})};export{ue as default};
