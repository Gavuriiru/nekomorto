import{r as m,j as i}from"./react-core-BcR2_z_l.js";import{o as S,aj as w,al as z,as as D,an as X,ag as R,h as E}from"./lexical-CVusBMfS.js";import{u as _,L as P}from"./ContentEditable-BX3pcmlG.js";import{t as Y}from"./PlaygroundEditorTheme-nA-I7k_h.js";import{f as x}from"./PlaygroundNodes-ChCl_XRL.js";import"./index-ntR5v_s2.js";import"./mui-WkDK9qS1.js";const B={...Y,paragraph:"StickyEditorTheme__paragraph"};function y(p,l){const u=p.style,d=l.rootElementRect,h=d!==null?d.left:0,c=d!==null?d.top:0;u.top=c+l.y+"px",u.left=h+l.x+"px"}function U({x:p,y:l,nodeKey:u,color:d,caption:h}){const[c]=S(),a=m.useRef(null),f=m.useRef({isDragging:!1,offsetX:0,offsetY:0,rootElementRect:null,x:0,y:0});m.useEffect(()=>{const t=f.current;t.x=p,t.y=l;const n=a.current;n!==null&&y(n,t)},[p,l]),m.useLayoutEffect(()=>{const t=f.current,n=new ResizeObserver(s=>{for(let r=0;r<s.length;r++){const g=s[r],{target:N}=g;t.rootElementRect=N.getBoundingClientRect();const v=a.current;v!==null&&y(v,t)}}),e=c.registerRootListener((s,r)=>{r!==null&&n.unobserve(r),s!==null&&n.observe(s)}),o=()=>{const s=c.getRootElement(),r=a.current;s!==null&&r!==null&&(t.rootElementRect=s.getBoundingClientRect(),y(r,t))};return window.addEventListener("resize",o),()=>{window.removeEventListener("resize",o),e()}},[c]),m.useEffect(()=>{const t=a.current;t!==null&&setTimeout(()=>{t.style.setProperty("transition","top 0.3s ease 0s, left 0.3s ease 0s")},500)},[]);const C=t=>{const n=a.current,e=f.current,o=e.rootElementRect,s=R(n);n!==null&&e.isDragging&&o!==null&&(e.x=t.pageX/s-e.offsetX-o.left,e.y=t.pageY/s-e.offsetY-o.top,y(n,e))},k=t=>{const n=a.current,e=f.current;n!==null&&(e.isDragging=!1,n.classList.remove("dragging"),c.update(()=>{const o=E(u);x(o)&&o.setPosition(e.x,e.y)})),document.removeEventListener("pointermove",C),document.removeEventListener("pointerup",k)},L=()=>{c.update(()=>{const t=E(u);x(t)&&t.remove()})},b=()=>{c.update(()=>{const t=E(u);x(t)&&t.toggleColor()})},{historyState:j}=_();return i.jsx("div",{ref:a,className:"sticky-note-container",children:i.jsxs("div",{className:`sticky-note ${d}`,onPointerDown:t=>{const n=a.current;if(n==null||t.button===2||t.target!==n.firstChild)return;const e=n,o=f.current;if(e!==null){const{top:s,left:r}=e.getBoundingClientRect(),g=R(e);o.offsetX=t.clientX/g-r,o.offsetY=t.clientY/g-s,o.isDragging=!0,e.classList.add("dragging"),document.addEventListener("pointermove",C),document.addEventListener("pointerup",k),t.preventDefault()}},children:[i.jsx("button",{onClick:L,className:"delete","aria-label":"Excluir nota adesiva",title:"Excluir",children:"X"}),i.jsx("button",{onClick:b,className:"color","aria-label":"Alterar cor da nota adesiva",title:"Cor",children:i.jsx("i",{className:"bucket"})}),i.jsxs(w,{initialEditor:h,initialTheme:B,children:[i.jsx(z,{externalHistoryState:j}),i.jsx(D,{contentEditable:i.jsx(P,{placeholder:"What's up?",placeholderClassName:"StickyNode__placeholder",className:"StickyNode__contentEditable"}),ErrorBoundary:X})]})]})})}export{U as default};
