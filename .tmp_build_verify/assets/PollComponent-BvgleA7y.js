import{r as _,j as t}from"./react-core-BcR2_z_l.js";import{o as b,P as S,ab as O,a as I,S as y,V as $,c as E,h as R,ae as B}from"./lexical-CVusBMfS.js";import{u as k,B as D,j as g}from"./PollContext-CEXjjzNp.js";import{d as T,e as w}from"./PlaygroundNodes-ChCl_XRL.js";import"./index-ntR5v_s2.js";import"./mui-WkDK9qS1.js";function A(o){return o.reduce((n,l)=>n+l.votes.length,0)}function U({option:o,index:n,options:l,totalVotes:d,withPollNode:u,isEditable:x,onVote:h}){const m=k().voterId||"local",P=_.useRef(null),N=o.votes,r=N.indexOf(m)!==-1,c=N.length,C=o.text;return t.jsxs("div",{className:"PollNode__optionContainer",children:[t.jsx("div",{className:g("PollNode__optionCheckboxWrapper",r&&"PollNode__optionCheckboxChecked"),children:t.jsx("input",{ref:P,className:"PollNode__optionCheckbox",type:"checkbox",onChange:i=>{const s=i.target.checked;u(e=>{e.toggleVote(o,m)}),h?.(o,s)},checked:r})}),t.jsxs("div",{className:"PollNode__optionInputWrapper",children:[t.jsx("div",{className:"PollNode__optionInputVotes",style:{width:`${c===0?0:c/d*100}%`}}),t.jsx("span",{className:"PollNode__optionInputVotesCount",children:c>0&&(c===1?"1 voto":`${c} votos`)}),t.jsx("input",{className:"PollNode__optionInput",type:"text",value:C,readOnly:!x,onChange:x?i=>{const s=i.target,e=s.value,a=s.selectionStart,p=s.selectionEnd;u(f=>{f.setOptionText(o,e)},()=>{s.selectionStart=a,s.selectionEnd=p})}:void 0,placeholder:`Opção ${n+1}`})]}),x?t.jsx("button",{disabled:l.length<3,className:g("PollNode__optionDelete",l.length<3&&"PollNode__optionDeleteDisabled"),"aria-label":"Remover",onClick:()=>{u(i=>{i.deleteOption(o)})}}):null]})}function G({question:o,options:n,nodeKey:l}){const[d]=b(),u=k(),x=_.useMemo(()=>A(n),[n]),[h,v,m]=S(l),[P,N]=_.useState(null),j=_.useRef(null),r=O();_.useEffect(()=>I(d.registerUpdateListener(({editorState:e})=>{N(e.read(()=>E()))}),d.registerCommand(y,e=>{const a=e;return a.target===j.current?(a.shiftKey||m(),v(!h),!0):!1},$)),[m,d,h,l,v]);const c=(e,a)=>{d.update(()=>{const p=R(l);T(p)&&e(p)},{onUpdate:a})},C=()=>{c(e=>{e.addOption(w())})},i=B(P)&&h,s=!r&&!!u.persistVote;return t.jsx("div",{className:`PollNode__container ${i?"focused":""} ${r?"":"readonly"}`,ref:j,children:t.jsxs("div",{className:"PollNode__inner",children:[t.jsx("h2",{className:"PollNode__heading",children:o}),n.map((e,a)=>{const p=e.uid;return t.jsx(U,{withPollNode:c,option:e,index:a,options:n,totalVotes:x,isEditable:r,onVote:(f,V)=>{s&&u.persistVote?.({question:o,optionUid:f.uid,optionText:f.text,checked:V})}},p)}),r?t.jsx("div",{className:"PollNode__footer",children:t.jsx(D,{onClick:C,small:!0,children:"Adicionar opção"})}):null]})})}export{G as default};
