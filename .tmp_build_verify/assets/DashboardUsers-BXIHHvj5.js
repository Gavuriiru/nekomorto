const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ImageLibraryDialog-BbbI0q6f.js","assets/react-core-BcR2_z_l.js","assets/index-CHWtszJ3.js","assets/index-ntR5v_s2.js","assets/mui-WkDK9qS1.js","assets/index-yv2-JTMp.css","assets/index-BMIt2_cw.js","assets/createLucideIcon-M1JG7EBz.js","assets/index-DZ2Ey5_7.js","assets/chevron-right-CrdESc7p.js","assets/check-Cyy403AY.js","assets/accordion-DHuEXPng.js","assets/chevron-down-Mfh0mWaz.js","assets/button-C7iHbTqw.js","assets/index-Xj-Q384k.js","assets/index-CwaKb5FF.js","assets/dialog-CLWEkP9q.js","assets/input-BfSJiKKQ.js","assets/x-BpqL4Bns.js","assets/label-BwT1z_RF.js","assets/use-toast-DeMRPCeJ.js","assets/ImageLibraryDialog-B3TEaj-8.css"])))=>i.map(i=>d[i]);
import{g as ws,b as Cs,d as $,_ as Ss}from"./index-ntR5v_s2.js";import{k as ks,i as As,r as i,j as s}from"./react-core-BcR2_z_l.js";import{D as Ds}from"./DashboardShell-BZQMplB5.js";import{B as D}from"./badge-CX6RuieY.js";import{B as N}from"./button-C7iHbTqw.js";import{D as Pe,a as Le,b as Be,c as _e,d as Me}from"./dialog-CLWEkP9q.js";import{I as re}from"./input-BfSJiKKQ.js";import{L as w}from"./label-BwT1z_RF.js";import{S as $e,a as Fe,b as ze,c as Ve,d as Ge}from"./select-BOMyCGLP.js";import{S as Ke}from"./switch-D-C3W2Iz.js";import{T as Is}from"./textarea-BwWmg86h.js";import{u as Us}from"./use-page-meta-ewLab265.js";import{t as P}from"./use-toast-DeMRPCeJ.js";import{T as Os}from"./ThemedSvgLogo-CGFMwyp6.js";import{G as Rs}from"./grip-vertical-nFrNlQ4M.js";import{G as ve}from"./globe-CRGpuS2E.js";import{M as We}from"./message-circle-qqsIJunn.js";import{Y as Es,I as Ts}from"./ThemedSvgMaskIcon-B_IYD_H5.js";import{X as Ye}from"./x-BpqL4Bns.js";import{U as Ps}from"./Footer-C9y59CM9.js";import{P as Ls,B as Bs,C as _s}from"./palette-E5OClIhR.js";import{C as Ms}from"./clock--Oqs7kqe.js";import{V as $s,L as Fs,P as zs,a as Vs,b as Gs}from"./video-CwWZofV8.js";import{S as Ks}from"./sparkles-CtpH76yt.js";import{C as Ws}from"./check-Cyy403AY.js";import"./mui-WkDK9qS1.js";import"./avatar-CVZSwVae.js";import"./createLucideIcon-M1JG7EBz.js";import"./index-Xj-Q384k.js";import"./index-CwaKb5FF.js";import"./separator-CDy1CE57.js";import"./skeleton-DbpZ9Rjt.js";import"./search-ranking-cq4don08.js";import"./use-dynamic-synopsis-clamp-DpjBDBPb.js";import"./url-safety-Py24cS-5.js";import"./access-control-C6qZ0ZhA.js";import"./index-CHWtszJ3.js";import"./index-DZ2Ey5_7.js";import"./chevron-down-Mfh0mWaz.js";import"./shield-DlmGTLiS.js";import"./index-BMIt2_cw.js";import"./chevron-right-CrdESc7p.js";import"./users-ok7q4J4c.js";import"./info-BTb-jBiG.js";import"./book-open-CG_mViAI.js";const Ys=i.lazy(()=>Ss(()=>import("./ImageLibraryDialog-BbbI0q6f.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21]))),he=({avatarUrl:m,name:p,sizeClassName:l,frameClassName:n,fallbackClassName:v,fallbackText:L})=>{const[b,C]=i.useState(!1),f=!!m&&!b;return i.useEffect(()=>{C(!1)},[m]),f?s.jsx("div",{className:`${l} ${n} relative shrink-0 overflow-hidden rounded-full`,children:s.jsx("img",{src:String(m),alt:p,referrerPolicy:"no-referrer",crossOrigin:"anonymous",className:"h-full w-full object-cover",onError:()=>C(!0)})}):s.jsx("div",{className:v,children:L})},qe={id:"",name:"",phrase:"",bio:"",avatarUrl:"",socials:[],status:"active",accessRole:"normal",permissions:[],roles:[]},be=[{id:"posts",label:"Posts"},{id:"projetos",label:"Projetos"},{id:"comentarios",label:"Comentários"},{id:"paginas",label:"Páginas"},{id:"uploads",label:"Uploads"},{id:"analytics",label:"Analytics"},{id:"usuarios_basico",label:"Usuários (básico)"},{id:"usuarios_acesso",label:"Usuários (acesso)"},{id:"configuracoes",label:"Configurações"},{id:"audit_log",label:"Audit Log"},{id:"integracoes",label:"Integrações"}],ae=m=>m.filter(p=>p.trim().toLowerCase()!=="dono"),qs=[{id:"normal",label:"Normal"},{id:"admin",label:"Admin"}],Hs=["Tradutor","Revisor","Typesetter","Qualidade","Desenvolvedor","Cleaner","Redrawer","Encoder","K-Timer","Logo Maker","K-Maker"],Js={instagram:Ts,twitter:Ye,x:Ye,youtube:Es,discord:We,"message-circle":We,globe:ve,site:ve},Xs=m=>m?m.startsWith("http")||m.startsWith("data:")||m.startsWith("/uploads/"):!1,Qs=(m,p)=>{const l=String(m||"").trim();if(!l)return"";if(l.startsWith("/uploads/")){const n=new URL(l,"http://localhost");return n.searchParams.set("v",String(p)),`${n.pathname}${n.search}${n.hash}`}try{const n=new URL(l);return n.pathname.startsWith("/uploads/")?(n.searchParams.set("v",String(p)),n.toString()):l}catch{return l}},Zs=(m,p,l)=>{if(p===l||p<0||l<0||p>=m.length||l>=m.length)return m;const n=[...m],[v]=n.splice(p,1);return typeof v>"u"?m:(n.splice(l,0,v),n)},He=m=>{const p=m.filter(n=>n.status==="active").sort((n,v)=>n.order-v.order).map(n=>n.id),l=m.filter(n=>n.status==="retired").sort((n,v)=>n.order-v.order).map(n=>n.id);return{activeIds:p,retiredIds:l}},er=(m,p)=>{const l=He(m),n=He(p);return l.activeIds.length!==n.activeIds.length||l.retiredIds.length!==n.retiredIds.length||l.activeIds.some((L,b)=>L!==n.activeIds[b])?!0:l.retiredIds.some((L,b)=>L!==n.retiredIds[b])},sr={languages:Gs,check:Ws,"pen-tool":Vs,sparkles:Ks,code:_s,paintbrush:zs,layers:Fs,video:$s,clock:Ms,badge:Bs,palette:Ls,user:Ps},Yr=()=>{Us({title:"Usuários",noIndex:!0});const m=ks(),[p]=As(),l=ws(),{settings:n}=Cs(),v=i.useMemo(()=>{const e=n.teamRoles.map(r=>r.label).filter(Boolean);return e.length?e:Hs},[n.teamRoles]),L=i.useMemo(()=>new Map(n.teamRoles.map(e=>[e.label,e.icon])),[n.teamRoles]),[b,C]=i.useState([]),[f,te]=i.useState([]),[x,Je]=i.useState(null),[Xe,Qe]=i.useState(!0),[O,G]=i.useState(null),[je,K]=i.useState(null),[Ze,W]=i.useState(null),[ye,Ne]=i.useState(null),[we,oe]=i.useState(null),[ie,F]=i.useState(!1),[d,Ce]=i.useState(null),[c,g]=i.useState(qe),[ne,X]=i.useState(!1),[B,Q]=i.useState(null),[es,Se]=i.useState(!1),[ke,ss]=i.useState(0),[Ae,rs]=i.useState([]),as=i.useMemo(()=>[{id:"instagram",label:"Instagram",icon:"instagram"},{id:"x",label:"X",icon:"x"},{id:"youtube",label:"YouTube",icon:"youtube"},{id:"discord",label:"Discord",icon:"message-circle"},{id:"site",label:"Site",icon:"globe"}],[]),ts=i.useMemo(()=>["users"],[]),Y=i.useMemo(()=>String(x?.primaryOwnerId||f[0]||""),[x?.primaryOwnerId,f]),le=i.useCallback(e=>e?e.id===Y?"owner_primary":f.includes(e.id)?"owner_secondary":e.accessRole==="admin"?"admin":"normal":"normal",[f,Y]),de=i.useMemo(()=>x?x.id===Y?"owner_primary":f.includes(x.id)?"owner_secondary":x.accessRole==="admin"?"admin":"normal":"normal",[x,f,Y]),_=de==="owner_primary",z=de==="owner_secondary",ce=de==="admin",De=x?.grants?.usuarios_basico===!0,me=x?.grants?.usuarios_acesso===!0,S=(_||z)&&me,Z=_,q=i.useCallback(e=>e?f.includes(e.id):!1,[f]),H=x&&b.find(e=>e.id===x.id)||null,V=i.useCallback(()=>{Ne(null),oe(null)},[]),ue=i.useCallback(()=>{ss(e=>e+1)},[]),pe=i.useCallback(e=>Qs(e,ke),[ke]),os=i.useCallback(e=>{Se(e),e||ue()},[ue]),is=()=>{Se(!0)},ns=i.useCallback(({urls:e})=>{const r=e[0]||"";g(a=>({...a,avatarUrl:r}))},[]),fe=i.useCallback(e=>{const r=Array.from(new Set((Array.isArray(e.permissions)?e.permissions:[]).map(o=>String(o||"").trim()).filter(o=>be.some(k=>k.id===o)))),a=ae(Array.isArray(e.roles)?e.roles:[]),t=le(e);Ce(e),g({id:e.id,name:e.name,phrase:e.phrase,bio:e.bio,avatarUrl:e.avatarUrl||"",socials:e.socials?[...e.socials]:[],status:e.status,accessRole:t==="admin"?"admin":"normal",permissions:r,roles:a?[...a]:[]}),X(q(e)),V(),F(!0)},[V,q,le]),R=i.useMemo(()=>b.filter(e=>e.status==="active").sort((e,r)=>e.order-r.order),[b]),E=i.useMemo(()=>b.filter(e=>e.status==="retired").sort((e,r)=>e.order-r.order),[b]),j=d?q(d):!1,ee=d?d.id===Y:!1,ls=i.useMemo(()=>Array.from(new Set(c.permissions)),[c.permissions]),Ie=e=>le(e)==="admin",ds=c.accessRole==="admin",Ue=!!(d&&x&&d.id===x.id),xe=S,h=d?Ue||De&&(_||z&&!j||ce&&!j):xe,ge=d?me&&(_||z&&!j):xe,T=d?me&&(_||z&&!j):xe,Oe=T&&!Ue&&!ee,cs=!!(d&&h&&!T);i.useEffect(()=>{(async()=>{try{const[r,a,t]=await Promise.all([$(l,"/api/users",{auth:!0}),$(l,"/api/me",{auth:!0}),$(l,"/api/link-types")]);if(r.ok){const o=await r.json();C(o.users||[]),te(Array.isArray(o.ownerIds)?o.ownerIds:[])}if(a.ok){const o=await a.json();Je(o)}if(t.ok){const o=await t.json();rs(Array.isArray(o.items)?o.items:[])}}finally{Qe(!1)}})()},[l]),i.useEffect(()=>{p.get("edit")==="me"&&(!H||ie||(fe(H),m("/dashboard/usuarios",{replace:!0})))},[H,ie,m,fe,p]);const ms=()=>{Ce(null),g({...qe,accessRole:"normal",permissions:[]}),X(!1),V(),F(!0)},us=e=>x?x.id===e.id?!0:De?_?!0:z||ce?!q(e):!1:!1:!1,J=e=>{us(e)&&fe(e)},ps=async()=>{if(!h)return;const e=Array.from(new Set(c.permissions)),r=ne?"owner_secondary":c.accessRole==="admin"?"admin":"normal",a={id:c.id.trim(),name:c.name.trim(),phrase:c.phrase.trim(),bio:c.bio.trim(),avatarUrl:c.avatarUrl.trim()||null,socials:c.socials.filter(A=>A.label.trim()&&A.href.trim()),roles:ae(c.roles),accessRole:r,status:Oe?c.status:"active",permissions:T?e:[]},t=!d||T?a:{name:a.name,phrase:a.phrase,bio:a.bio,avatarUrl:a.avatarUrl,socials:a.socials};if(!d&&(!a.id||!a.name))return;const o=d?"PUT":"POST",y=d?_||z||ce?`/api/users/${d.id}`:"/api/users/self":"/api/users",u=await $(l,y,{method:o,auth:!0,json:t});if(u.ok){const A=await u.json(),I=d?d.id:A.user?.id||a.id,Ns=!!(d&&f.includes(d.id)),se=!!ne;if(Z&&I){const U=se?Array.from(new Set([...f,I])):f.filter(M=>M!==I);if(U.join(",")!==f.join(",")){const M=await $(l,"/api/owners",{method:"PUT",headers:{"Content-Type":"application/json"},auth:!0,body:JSON.stringify({ownerIds:U})});if(M.ok){const Te=await M.json();te(Array.isArray(Te.ownerIds)?Te.ownerIds:U),se||X(!1)}else P({title:se?"Não foi possível promover para dono":"Não foi possível rebaixar o dono",variant:"destructive"})}}C(d?U=>U.map(M=>M.id===d.id?A.user:M):U=>[...U,A.user]),Ns&&!se&&g(U=>({...U,accessRole:"normal"})),ue(),F(!1),P({title:d?"Usuário atualizado":"Usuário criado",description:"As alterações foram salvas com sucesso.",intent:"success"});return}P({title:"Não foi possível salvar o usuário",variant:"destructive"})},fs=e=>{T&&g(r=>{const a=r.permissions,t=a.includes(e);return{...r,permissions:t?a.filter(o=>o!==e):[...a,e]}})},xs=async()=>{if(!B)return;const e=await $(l,`/api/users/${B.id}`,{method:"DELETE",auth:!0});if(!e.ok){P({title:"Não foi possível excluir o usuário",variant:"destructive"});return}const r=await e.json();C(a=>a.filter(t=>t.id!==B.id)),Array.isArray(r.ownerIds)&&te(r.ownerIds),d&&d.id===B.id&&F(!1),Q(null),P({title:"Usuário excluído"})},gs=e=>{ge&&g(r=>{const a=r.roles.includes(e);return{...r,roles:a?r.roles.filter(t=>t!==e):[...r.roles,e]}})},hs=(e,r)=>{h&&(Ne(r),oe(r),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",String(r)))},bs=(e,r)=>{!h||ye===null||(e.preventDefault(),e.dataTransfer.dropEffect="move",we!==r&&oe(r))},vs=(e,r)=>{e.preventDefault();const a=ye;if(!h||a===null||a===r){V();return}g(t=>({...t,socials:Zs(t.socials,a,r)})),V()},Re=(e,r)=>{C(a=>{const t=new Map(a.filter(u=>u.status==="active").map(u=>[u.id,u])),o=new Map(a.filter(u=>u.status==="retired").map(u=>[u.id,u])),k=e.map((u,A)=>{const I=t.get(u);return I?{...I,order:A}:null}).filter(Boolean),y=r.map((u,A)=>{const I=o.get(u);return I?{...I,order:e.length+A}:null}).filter(Boolean);return[...k,...y]})},js=(e,r)=>{if(!S||!O||je!=="active"||O===r)return;e.preventDefault();const a=R.map(u=>u.id),t=E.map(u=>u.id),o=a.indexOf(O),k=a.indexOf(r);if(o===-1||k===-1)return;const y=[...a];y.splice(o,1),y.splice(k,0,O),Re(y,t)},ys=(e,r)=>{if(!S||!O||je!=="retired"||O===r)return;e.preventDefault();const a=R.map(u=>u.id),t=E.map(u=>u.id),o=t.indexOf(O),k=t.indexOf(r);if(o===-1||k===-1)return;const y=[...t];y.splice(o,1),y.splice(k,0,O),Re(a,y)},Ee=async()=>{if(!S){G(null),K(null),W(null);return}const e=Ze;if(!(e?er(e,b):!1)){G(null),K(null),W(null);return}const a=R.map(o=>o.id),t=E.map(o=>o.id);try{(await $(l,"/api/users/reorder",{method:"PUT",headers:{"Content-Type":"application/json"},auth:!0,body:JSON.stringify({orderedIds:a,retiredIds:t})})).ok?P({title:"Ordem dos usuários atualizada",description:"A nova ordenação foi salva.",intent:"success"}):(e&&C(e),P({title:"Não foi possível salvar a nova ordem",description:"A lista foi restaurada para a ordem anterior.",variant:"destructive"}))}catch{e&&C(e),P({title:"Não foi possível salvar a nova ordem",description:"A lista foi restaurada para a ordem anterior.",variant:"destructive"})}G(null),K(null),W(null)};return s.jsxs(s.Fragment,{children:[s.jsx(Ds,{currentUser:x,onUserCardClick:H?()=>J(H):void 0,children:s.jsx("main",{className:"pt-24",children:s.jsxs("section",{className:"mx-auto w-full max-w-6xl px-6 pb-20 md:px-10",children:[s.jsxs("header",{className:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between",children:[s.jsxs("div",{children:[s.jsx("div",{className:"inline-flex items-center gap-3 rounded-full border border-border/60 bg-card/60 px-4 py-2 text-xs uppercase tracking-[0.3em] text-muted-foreground animate-fade-in",children:"Usuários"}),s.jsx("h1",{className:"mt-4 text-3xl font-semibold lg:text-4xl animate-slide-up",children:"Gestão de Usuários"}),s.jsx("p",{className:"mt-2 text-sm text-muted-foreground animate-slide-up opacity-0",style:{animationDelay:"0.2s"},children:"Reordene arrastando para refletir a ordem na página pública."})]}),S&&s.jsx(N,{className:"bg-primary text-primary-foreground hover:bg-primary/90",onClick:ms,children:"Adicionar usuário"})]}),s.jsxs("div",{className:"mt-10",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h2",{className:"text-lg font-semibold",children:"Usuários ativos"}),s.jsx(D,{className:"bg-card/80 text-muted-foreground",children:R.length})]}),Xe?s.jsx("div",{className:"mt-6 rounded-2xl border border-border/60 bg-card/60 px-4 py-8 text-sm text-muted-foreground",children:"Carregando usuários..."}):R.length===0?s.jsx("div",{className:"mt-6 rounded-2xl border border-dashed border-border/60 bg-card/60 px-4 py-8 text-sm text-muted-foreground",children:"Nenhum usuário ativo no momento."}):s.jsx("div",{className:"mt-6 grid gap-4 md:grid-cols-2",children:R.map((e,r)=>{const a=R.length%2===1&&r===R.length-1;return s.jsx("div",{className:`relative rounded-2xl border border-border/60 bg-card/60 p-5 transition hover:border-primary/40 hover:bg-primary/5 animate-slide-up opacity-0 ${a?"md:col-span-2 md:mx-auto md:w-[calc(50%-0.5rem)]":""}`,style:{animationDelay:`${r*60}ms`},draggable:S,onDragStart:()=>{W(t=>t||b.map(o=>({...o}))),G(e.id),K("active")},onDragOver:t=>js(t,e.id),onDragEnd:Ee,onClick:()=>J(e),role:"button",tabIndex:0,onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),J(e))},children:s.jsx("div",{className:"flex items-start justify-between gap-4",children:s.jsxs("div",{className:"flex gap-4",children:[s.jsx(he,{avatarUrl:pe(e.avatarUrl),name:e.name,sizeClassName:"h-14 w-14",frameClassName:"border border-border/60 bg-card/60",fallbackClassName:"flex h-14 w-14 items-center justify-center rounded-full border border-border/60 bg-card/80 text-sm text-foreground",fallbackText:e.name.slice(0,2).toUpperCase()}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("h3",{className:"text-lg font-semibold",children:e.name}),f.includes(e.id)&&s.jsx(D,{className:"bg-primary/20 text-primary",children:"Dono"}),!f.includes(e.id)&&Ie(e)&&s.jsx(D,{className:"bg-card/80 text-muted-foreground",children:"Administrador"})]}),s.jsx("p",{className:"text-sm text-muted-foreground",children:e.phrase||"-"}),s.jsx("p",{className:"mt-2 text-xs text-muted-foreground line-clamp-2",children:e.bio||"Sem biografia cadastrada."}),e.roles&&e.roles.length>0&&s.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:(f.includes(e.id)?e.roles:ae(e.roles)).map(t=>s.jsx(D,{variant:"secondary",className:"text-[10px] uppercase",children:t},t))})]})]})})},e.id)})}),E.length>0&&s.jsxs("div",{className:"mt-12",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h2",{className:"text-lg font-semibold",children:"Usuários aposentados"}),s.jsx(D,{className:"bg-card/80 text-muted-foreground",children:E.length})]}),s.jsx("div",{className:"mt-6 grid gap-4 md:grid-cols-2",children:E.map((e,r)=>{const a=E.length%2===1&&r===E.length-1;return s.jsx("div",{className:`rounded-2xl border border-border/60 bg-card/60 p-5 animate-slide-up opacity-0 ${a?"md:col-span-2 md:mx-auto md:w-[calc(50%-0.5rem)]":""}`,style:{animationDelay:`${r*60}ms`},draggable:S,onDragStart:()=>{W(t=>t||b.map(o=>({...o}))),G(e.id),K("retired")},onDragOver:t=>ys(t,e.id),onDragEnd:Ee,onClick:()=>J(e),role:"button",tabIndex:0,onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),J(e))},children:s.jsx("div",{className:"flex items-start justify-between gap-4",children:s.jsxs("div",{className:"flex gap-4",children:[s.jsx(he,{avatarUrl:pe(e.avatarUrl),name:e.name,sizeClassName:"h-14 w-14",frameClassName:"border border-border/60 bg-card/60",fallbackClassName:"flex h-14 w-14 items-center justify-center rounded-full border border-border/60 bg-card/80 text-sm text-foreground",fallbackText:e.name.slice(0,2).toUpperCase()}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("h3",{className:"text-lg font-semibold",children:e.name}),s.jsx(D,{className:"bg-card/80 text-muted-foreground",children:"Aposentado"}),Ie(e)&&s.jsx(D,{className:"bg-card/80 text-muted-foreground",children:"Administrador"})]}),s.jsx("p",{className:"text-sm text-muted-foreground",children:e.phrase||"-"}),s.jsx("p",{className:"mt-2 text-xs text-muted-foreground line-clamp-2",children:e.bio||"Sem biografia cadastrada."}),e.roles&&e.roles.length>0&&s.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:(f.includes(e.id)?e.roles:ae(e.roles)).map(t=>s.jsx(D,{variant:"secondary",className:"text-[10px] uppercase",children:t},t))})]})]})})},e.id)})})]})]})]})})}),s.jsx(i.Suspense,{fallback:null,children:s.jsx(Ys,{open:es,onOpenChange:os,apiBase:l,description:"Selecione uma imagem já enviada para reutilizar ou envie um novo arquivo.",uploadFolder:"users",listFolders:ts,listAll:!1,allowDeselect:!0,mode:"single",cropAvatar:!0,cropTargetFolder:"users",cropSlot:c.id?`avatar-${c.id}`:void 0,onSave:({urls:e})=>ns({urls:e})})}),s.jsx(Pe,{open:ie,onOpenChange:F,children:s.jsxs(Le,{className:"w-[92vw] max-h-[90vh] max-w-xl overflow-y-auto",overlayClassName:"backdrop-blur-xs",children:[s.jsxs(Be,{children:[s.jsx(_e,{children:d?"Editar usuário":"Adicionar usuário"}),s.jsx(Me,{children:d?"Atualize as informações e permissões do usuário.":"Cadastre um novo usuário autorizado."})]}),cs&&s.jsx("div",{className:"rounded-2xl border border-border/60 bg-card/60 px-4 py-3 text-xs text-muted-foreground",children:"Você só pode alterar informações básicas deste usuário."}),s.jsxs("div",{className:"grid gap-4",children:[s.jsxs("div",{className:"grid gap-2",children:[s.jsx(w,{htmlFor:"user-id",children:"ID do Discord"}),s.jsx(re,{id:"user-id",value:c.id,onChange:e=>g(r=>({...r,id:e.target.value})),placeholder:"Ex.: 380305493391966208",disabled:!!d||!S})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(w,{htmlFor:"user-name",children:"Nome"}),s.jsx(re,{id:"user-name",value:c.name,onChange:e=>g(r=>({...r,name:e.target.value})),placeholder:"Nome exibido",disabled:!h})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(w,{htmlFor:"user-phrase",children:"Frase"}),s.jsx(re,{id:"user-phrase",value:c.phrase,onChange:e=>g(r=>({...r,phrase:e.target.value})),placeholder:"Frase curta",disabled:!h})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(w,{htmlFor:"user-bio",children:"Bio"}),s.jsx(Is,{id:"user-bio",value:c.bio,onChange:e=>g(r=>({...r,bio:e.target.value})),placeholder:"Texto da bio",rows:4,disabled:!h})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(w,{children:"Avatar"}),s.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[c.avatarUrl?s.jsx(he,{avatarUrl:pe(c.avatarUrl),name:c.name||"Avatar",sizeClassName:"h-12 w-12",frameClassName:"border border-border/60 bg-card/60",fallbackClassName:"flex h-12 w-12 items-center justify-center rounded-full border border-border/60 bg-card/60 text-xs text-foreground",fallbackText:(c.name||"U").slice(0,1).toUpperCase()}):s.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full border border-dashed border-border/60 text-[10px] text-muted-foreground",children:"Sem imagem"}),s.jsx(N,{type:"button",size:"sm",variant:"outline",onClick:is,disabled:!h,children:"Biblioteca"})]})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(w,{children:"Links e redes"}),s.jsxs("div",{className:"grid gap-3",children:[c.socials.length===0?s.jsx("p",{className:"text-xs text-muted-foreground",children:"Nenhum link adicionado."}):null,c.socials.map((e,r)=>s.jsxs("div",{"data-testid":`user-social-row-${r}`,className:`grid items-center gap-2 rounded-xl border p-2 transition md:grid-cols-[auto_1fr_2fr_auto] ${we===r?"border-primary/40 bg-primary/5":"border-transparent"}`,onDragOver:a=>bs(a,r),onDrop:a=>vs(a,r),children:[s.jsx("button",{type:"button",draggable:h,className:"inline-flex h-9 w-9 cursor-grab items-center justify-center rounded-md border border-border/60 bg-background/60 text-muted-foreground transition hover:border-primary/40 hover:text-primary active:cursor-grabbing disabled:cursor-not-allowed disabled:opacity-50","aria-label":`Arrastar rede ${e.label||r+1}`,onDragStart:a=>hs(a,r),onDragEnd:V,disabled:!h,children:s.jsx(Rs,{className:"h-4 w-4"})}),s.jsxs($e,{value:e.label,onValueChange:a=>g(t=>{const o=[...t.socials];return o[r]={...o[r],label:a},{...t,socials:o}}),disabled:!h,children:[s.jsx(Fe,{className:"bg-background/60 justify-start text-left",children:s.jsx(ze,{placeholder:"Selecione a rede"})}),s.jsx(Ve,{align:"start",children:(Ae.length>0?Ae:as).map(a=>{const t=Xs(a.icon),o=t?null:Js[a.icon]||ve;return s.jsx(Ge,{value:a.id,className:"pl-2 pr-2 [&>span:first-child]:hidden",children:s.jsxs("div",{className:"flex items-center gap-2",children:[t?s.jsx(Os,{url:a.icon,label:a.label,className:"h-4 w-4 text-primary"}):s.jsx(o,{className:"h-4 w-4"}),s.jsx("span",{children:a.label})]})},a.id)})})]}),s.jsx(re,{value:e.href,onChange:a=>g(t=>{const o=[...t.socials];return o[r]={...o[r],href:a.target.value},{...t,socials:o}}),placeholder:"https://",disabled:!h}),s.jsx(N,{type:"button",variant:"ghost",className:"justify-start md:justify-center",onClick:()=>g(a=>({...a,socials:a.socials.filter((t,o)=>o!==r)})),disabled:!h,children:"Remover"})]},`${e.label}-${r}`)),s.jsx(N,{type:"button",variant:"outline",onClick:()=>g(e=>({...e,socials:[...e.socials,{label:"",href:""}]})),disabled:!h,children:"Adicionar link"})]})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(w,{children:"Funções"}),!ge&&s.jsx("p",{className:"text-xs text-muted-foreground",children:"Apenas donos com permissão de acesso podem alterar funções de equipe."}),s.jsx("div",{className:"flex flex-wrap gap-2",children:v.map(e=>{const r=c.roles.includes(e),a=L.get(e),t=a?sr[String(a).toLowerCase()]:null;return s.jsxs(N,{type:"button",variant:r?"default":"outline",className:r?"bg-primary text-primary-foreground hover:bg-primary/90":"",onClick:()=>gs(e),disabled:!ge,children:[t?s.jsx(t,{className:"h-4 w-4"}):null,e]},e)})}),j&&s.jsx("p",{className:"text-xs text-muted-foreground",children:"A badge de dono é automática."})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(w,{children:"Papel de acesso"}),s.jsxs($e,{value:c.accessRole,onValueChange:e=>g(r=>({...r,accessRole:e==="admin"?"admin":"normal",permissions:e==="admin"?be.filter(a=>["posts","projetos","comentarios","paginas","uploads","analytics","usuarios_basico"].includes(a.id)).map(a=>a.id):r.permissions})),disabled:!T||j,children:[s.jsx(Fe,{children:s.jsx(ze,{placeholder:"Selecione um papel"})}),s.jsx(Ve,{children:qs.map(e=>s.jsx(Ge,{value:e.id,children:e.label},e.id))})]}),j?s.jsx("p",{className:"text-xs text-muted-foreground",children:"O papel de dono é definido pela governança de owners."}):null]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(w,{children:"Permissões"}),j&&s.jsx(D,{className:"w-fit bg-primary/20 text-primary",children:"Acesso total"}),!j&&ds&&s.jsx(D,{className:"w-fit bg-card/80 text-muted-foreground",children:"Administrador"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:be.map(e=>{const r=ls.includes(e.id);return s.jsx(N,{type:"button",variant:r?"default":"outline",className:r?"bg-primary text-primary-foreground hover:bg-primary/90":"",onClick:()=>fs(e.id),disabled:!T||j,children:e.label},e.id)})}),!T&&s.jsx("p",{className:"text-xs text-muted-foreground",children:"Apenas donos com permissão de acesso podem alterar permissões de acesso."})]}),S?s.jsxs("div",{className:"grid gap-2",children:[s.jsx(w,{children:"Dono"}),s.jsxs("div",{className:"flex items-center justify-between gap-4 rounded-2xl border border-border/60 bg-card/60 px-4 py-3",children:[s.jsx("span",{className:"text-sm text-muted-foreground",children:"Permite acesso total ao painel e às configurações críticas."}),s.jsx(Ke,{checked:ne,onCheckedChange:X,disabled:!Z||ee})]}),Z?null:s.jsx("p",{className:"text-xs text-muted-foreground",children:"Apenas o primeiro dono pode promover ou rebaixar outros donos."}),ee?s.jsx("p",{className:"text-xs text-muted-foreground",children:"O primeiro dono não pode ser rebaixado."}):null]}):null,s.jsxs("div",{className:"grid gap-2",children:[s.jsx(w,{children:"Status"}),s.jsxs("div",{className:"flex items-center justify-between gap-4 rounded-2xl border border-border/60 bg-card/60 px-4 py-3",children:[s.jsx("span",{className:"text-sm text-muted-foreground",children:c.status==="active"?"Ativo":"Aposentado"}),s.jsx(Ke,{checked:c.status==="active",onCheckedChange:e=>g(r=>({...r,status:e?"active":"retired"})),disabled:!Oe})]})]}),s.jsxs("div",{className:"flex justify-end gap-3",children:[d?s.jsx(N,{variant:"destructive",onClick:()=>Q(d),disabled:!S||ee||d.id===x?.id||j&&!Z,children:"Excluir"}):null,s.jsx(N,{variant:"outline",onClick:()=>F(!1),children:"Cancelar"}),s.jsx(N,{className:"bg-primary text-primary-foreground hover:bg-primary/90",onClick:ps,children:"Salvar"})]})]})]})}),s.jsx(Pe,{open:!!B,onOpenChange:e=>{e||Q(null)},children:s.jsxs(Le,{className:"max-w-md",children:[s.jsxs(Be,{children:[s.jsx(_e,{children:"Excluir usuário?"}),s.jsx(Me,{children:B?`Excluir "${B.name}"? Esta ação não pode ser desfeita.`:""})]}),s.jsxs("div",{className:"flex justify-end gap-3",children:[s.jsx(N,{variant:"ghost",onClick:()=>Q(null),children:"Cancelar"}),s.jsx(N,{variant:"destructive",onClick:xs,children:"Excluir"})]})]})})]})};export{Yr as default};
